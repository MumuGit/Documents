<!DOCTYPE html>
<!-- saved from url=(0038)http://www.tuicool.com/articles/AfIv6v -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="authenticity_token" name="csrf-param">
<meta content="KOoj9QjouuHGrYLJxSGmMxpHFdOvO7GVc76lnrQWEJg=" name="csrf-token">
    <title>
            Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷
   </title>
    <meta name="description" content="Java多线程（六）之Deque与LinkedBlockingDeque深入分析">
  <link rel="shortcut icon" href="http://static0.tuicool.com/favicon.ico" type="image/x-icon">
  <link href="http://static0.tuicool.com/images/icon114.png" rel="Bookmark">
  <link rel="apple-touch-icon" sizes="57x57" href="http://static1.tuicool.com/images/icon57.png"> 
  <link rel="apple-touch-icon" sizes="72x72" href="http://static2.tuicool.com/images/icon72.png">  
  <link rel="apple-touch-icon" sizes="114x114" href="http://static0.tuicool.com/images/icon114.png">    
  <link rel="apple-touch-icon" sizes="144x144" href="http://static1.tuicool.com/images/icon144.png">
  <link href="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/pub.css" rel="stylesheet">
  <link href="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/application-e90ef7ce56579081ef4f956c640f005f.css" media="screen" rel="stylesheet" type="text/css">
  <link href="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/font-awesome.min.css" rel="stylesheet">
  <script src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/ca-pub-7054762349007490.js.下载"></script><script type="text/javascript" src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/pub.js.下载"></script>
  <script src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/application-f8dd22e38da72b470d036c6151afa4cc.js.下载" type="text/javascript"></script>
  
      <style type="text/css">
      .btn-large {
        padding: 0;
      }
      .load-fail {
        display: none;
      }
    </style>

</head>
<body class="  pace-done"><div class="pace  pace-inactive"><div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div></div>
  
  <div id="header" class="navbar-fixed-top">
    <div class="container">
      <div class="navbar">
        <div class="navbar-inner">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> 
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span> 
          </a>
          <a href="http://www.tuicool.com/" class="brand">推酷</a>        
        <nav class="nav-collapse collapse">
            <ul class="nav navbar primary-nav">                            
              <li class="active">
                <a href="http://www.tuicool.com/ah">
                  文章
                </a>
              </li>              
              <li class="">
                <a href="http://www.tuicool.com/sites/hot">
                  站点
                </a>
              </li>
              <li class="">
                <a href="http://www.tuicool.com/topics">
                  主题
                </a>
              </li>
              <li class="">
                <a href="http://huodong.tuicool.com/">
                  活动
                </a>
              </li>
              <li class="">
                <a href="http://www.tuicool.com/mobile">
                  APP
                    <sup style="font-size:0.8em;color: #16A085;">荐</sup>
                </a>
              </li>
              <li class="dropdown">
                <a href="http://www.tuicool.com/articles/AfIv6v#" class="dropdown-toggle" data-toggle="dropdown">周刊 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.tuicool.com/mags">编程狂人</a></li>
                  <li><a href="http://www.tuicool.com/mags/design">设计匠艺</a></li> 
                  <li><a href="http://www.tuicool.com/mags/startup">创业周刊</a></li> 
                  <li><a href="http://www.tuicool.com/mags/tech">科技周刊</a></li>      
                  <li><a href="http://www.tuicool.com/articles/weekly">一周拾遗</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="http://www.tuicool.com/articles/AfIv6v#" class="dropdown-toggle" data-toggle="dropdown">更多 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://course.tuicool.com/">
                    公开课
                  </a>
                  </li>
                  <li><a href="http://www.tuicool.com/daily_news">今日酷闻</a></li>
                  <li><a href="http://www.tuicool.com/bbs/go/issues">意见反馈</a></li>
                </ul>
              </li>
              </ul>
            <form class="navbar-search pull-left" action="http://www.tuicool.com/search">
              <input type="text" class="search-query span2" name="kw" placeholder="搜索">
            </form>
            <ul class="nav pull-right">
                <li><a href="http://www.tuicool.com/login">登录</a></li>
            </ul>
          </nav>
        </div>
      </div>
  </div>   
</div>
  <div id="flash_container" class="noPrint">    
  </div>
  
  <div class="container-fluid">  
      
<div class="row-fluid article_row_fluid">
    <div class="span8 contant article_detail_bg">
        <h1>Java多线程（六）之Deque与LinkedBlockingDeque深入分析</h1>
        <div class="article_meta">
            <div style="margin-bottom: 5px;">
            <span class="timestamp">时间&nbsp;2012-12-07 00:11:34
            </span>
            <span class="from">
                <i class="icon-globe"></i>
                    <a class="cut cut28 from" href="http://www.tuicool.com/sites/JfmQBf" target="_blank">郑雪峰的专栏
                    </a>
            </span>
            </div>
            <div class="source">
                <i style="float:left;">原文</i>&nbsp; 
                <a class="cut cut70" href="http://blog.csdn.net/a511596982/article/details/8267541?utm_source=tuicool&amp;utm_medium=referral" style="display:inline-block;">http://blog.csdn.net/a511596982/article/details/8267541</a>
            </div>
            <div>
                <span>主题</span>
                <a href="http://www.tuicool.com/topics/11250012" target="_blank">
                    <span class="new-label">多线程</span>
                </a>
                <a href="http://www.tuicool.com/topics/11000072" target="_blank">
                    <span class="new-label">Java</span>
                </a>
                <a href="http://www.tuicool.com/topics/11110005" target="_blank">
                    <span class="new-label">双端队列</span>
                </a>
            </div>
        </div>
        <div class="article_body" id="nei">
            <div>
  <h1>
    <span>
      <span style="font-family:SimSun;">
        一、双向队列
        <span style="font-family:SimSun; line-height:19px; text-indent:20px">Deque</span>
      </span>
    </span>
  </h1>
  <div>
    <span style="font-family:SimSun;">
      <br>
    </span>
  </div>
  <div>
    <p>
      <span style="font-family:SimSun;">Queue除了前面介绍的实现外，还有一种双向的Queue实现Deque。这种队列允许在队列头和尾部进行入队出队操作，因此在功能上比Queue显然要更复杂。下图描述的是Deque的完整体系图。需要说明的是LinkedList也已经加入了Deque的一部分（LinkedList是从jdk1.2 开始就存在数据结构）。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">&nbsp;</span>
    </p>
    <p>
      <img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/2mmMZf.png!web" alt="" style="display: block;">
      <br>
    </p>
    <p>
      <span style="font-family:SimSun;">Deque在Queue的基础上增加了更多的操作方法。</span>
    </p>
    <p>
      <img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/JNZFne.png!web" alt="" style="display: block;">
      <br>
    </p>
    <p>
      <span style="font-family:SimSun;">从上图可以看到，Deque不仅具有FIFO的Queue实现，也有FILO的实现，也就是不仅可以实现队列，也可以实现一个堆栈。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">同时在Deque的体系结构图中可以看到，实现一个Deque可以使用数组（ArrayDeque），同时也可以使用链表（LinkedList），还可以同实现一个支持阻塞的线程安全版本队列LinkedBlockingDeque。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </p>
    <h2>
      <span style="font-family:SimSun;">1、ArrayDeque实现Deque</span>
    </h2>
    <p></p>
    <div>
      <span style="font-family:SimSun;">
        <img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/3URnaa.png!web" alt="">
        <br>
      </span>
    </div>
    <p></p>
    <p>
      <span style="font-family:SimSun;">对于数组实现的Deque来说，数据结构上比较简单，只需要一个存储数据的数组以及头尾两个索引即可。由于数组是固定长度的，所以很容易就得到数组的头和尾，那么对于数组的操作只需要移动头和尾的索引即可。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">特别说明的是ArrayDeque并不是一个固定大小的队列，每次队列满了以后就将队列容量扩大一倍（doubleCapacity()），因此加入一个元素总是能成功，而且也不会抛出一个异常。也就是说ArrayDeque是一个没有容量限制的队列。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">同样继续性能的考虑，使用System.arraycopy复制一个数组比循环设置要高效得多。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </p>
    <h3>
      <span style="font-family:SimSun;">1.1、ArrayDeque的源码解析</span>
    </h3>
    <div>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </div>
    <pre class="prettyprint hljs java"><span class="hljs-comment">//数组双端队列ArrayDeque的源码解析</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayDeque</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractCollection</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Deque</span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">Cloneable</span>, <span class="hljs-title">Serializable</span></span>{
    <span class="hljs-comment">/**
     * 存放队列元素的数组，数组的长度为“2的指数”
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> E[] elements;
    <span class="hljs-comment">/**
     *队列的头部索引位置，（被remove（）或pop（）操作的位置），当为空队列时，首尾index相同
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> head;
    <span class="hljs-comment">/**
     * 队列的尾部索引位置，(被 addLast(E), add(E), 或 push(E)操作的位置).
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> tail;
    <span class="hljs-comment">/**
     * 队列的最小容量（大小必须为“2的指数”）
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MIN_INITIAL_CAPACITY = <span class="hljs-number">8</span>;
    <span class="hljs-comment">// ******  Array allocation and resizing utilities ******</span>
    <span class="hljs-comment">/**
     * 根据所给的数组长度，得到一个比该长度大的最小的2^p的真实长度，并建立真实长度的空数组
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">allocateElements</span><span class="hljs-params">(<span class="hljs-keyword">int</span> numElements)</span> </span>{
        <span class="hljs-keyword">int</span> initialCapacity = MIN_INITIAL_CAPACITY;
        <span class="hljs-keyword">if</span> (numElements &gt;= initialCapacity) {
            initialCapacity = numElements;
            initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">1</span>);
            initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">2</span>);
            initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">4</span>);
            initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">8</span>);
            initialCapacity |= (initialCapacity &gt;&gt;&gt; <span class="hljs-number">16</span>);
            initialCapacity++;
            <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)   <span class="hljs-comment">// Too many elements, must back off</span>
                initialCapacity &gt;&gt;&gt;= <span class="hljs-number">1</span>;<span class="hljs-comment">// Good luck allocating 2 ^ 30 elements</span>
        }
        elements = (E[]) <span class="hljs-keyword">new</span> Object[initialCapacity];
    }
    <span class="hljs-comment">/**
     * 当队列首尾指向同一个引用时，扩充队列的容量为原来的两倍，并对元素重新定位到新数组中
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doubleCapacity</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">assert</span> head == tail;
        <span class="hljs-keyword">int</span> p = head;
        <span class="hljs-keyword">int</span> n = elements.length;
        <span class="hljs-keyword">int</span> r = n - p; <span class="hljs-comment">// number of elements to the right of p</span>
        <span class="hljs-keyword">int</span> newCapacity = n &lt;&lt; <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (newCapacity &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"Sorry, deque too big"</span>);
        Object[] a = <span class="hljs-keyword">new</span> Object[newCapacity];
        System.arraycopy(elements, p, a, <span class="hljs-number">0</span>, r);
        System.arraycopy(elements, <span class="hljs-number">0</span>, a, r, p);
        elements = (E[])a;
        head = <span class="hljs-number">0</span>;
        tail = n;
    }
    <span class="hljs-comment">/**
     * 拷贝队列中的元素到新数组中
     */</span>
    <span class="hljs-keyword">private</span> &lt;T&gt; T[] copyElements(T[] a) {
        <span class="hljs-keyword">if</span> (head &lt; tail) {
            System.arraycopy(elements, head, a, <span class="hljs-number">0</span>, size());
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (head &gt; tail) {
            <span class="hljs-keyword">int</span> headPortionLen = elements.length - head;
            System.arraycopy(elements, head, a, <span class="hljs-number">0</span>, headPortionLen);
            System.arraycopy(elements, <span class="hljs-number">0</span>, a, headPortionLen, tail);
        }
        <span class="hljs-keyword">return</span> a;
    }
    <span class="hljs-comment">/**
     * 默认构造队列，初始化一个长度为16的数组
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayDeque</span><span class="hljs-params">()</span> </span>{
        elements = (E[]) <span class="hljs-keyword">new</span> Object[<span class="hljs-number">16</span>];
    }
    <span class="hljs-comment">/**
     * 指定元素个数的构造方法
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayDeque</span><span class="hljs-params">(<span class="hljs-keyword">int</span> numElements)</span> </span>{
        allocateElements(numElements);
    }
    <span class="hljs-comment">/**
     * 用一个集合作为参数的构造方法
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayDeque</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> </span>{
        allocateElements(c.size());
        addAll(c);
    }
    <span class="hljs-comment">//插入和删除的方法主要是： addFirst(),addLast(), pollFirst(), pollLast()。</span>
    <span class="hljs-comment">//其他的方法依赖于这些实现。</span>
    <span class="hljs-comment">/**
     * 在双端队列的前端插入元素,元素为null抛异常
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addFirst</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
        elements[head = (head - <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>)] = e;
        <span class="hljs-keyword">if</span> (head == tail)
            doubleCapacity();
    }
    <span class="hljs-comment">/**
     *在双端队列的末端插入元素，元素为null抛异常
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addLast</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
        elements[tail] = e;
        <span class="hljs-keyword">if</span> ( (tail = (tail + <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>)) == head)
            doubleCapacity();
    }
    <span class="hljs-comment">/**
     * 在前端插入，调用addFirst实现，返回boolean类型
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offerFirst</span><span class="hljs-params">(E e)</span> </span>{
        addFirst(e);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    <span class="hljs-comment">/**
     * 在末端插入，调用addLast实现，返回boolean类型
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offerLast</span><span class="hljs-params">(E e)</span> </span>{
        addLast(e);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    <span class="hljs-comment">/**
     * 删除前端，调用pollFirst实现
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">removeFirst</span><span class="hljs-params">()</span> </span>{
        E x = pollFirst();
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-comment">/**
     * 删除后端，调用pollLast实现
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">removeLast</span><span class="hljs-params">()</span> </span>{
        E x = pollLast();
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-comment">//前端出对（删除前端）</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pollFirst</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">int</span> h = head;
        E result = elements[h]; <span class="hljs-comment">// Element is null if deque empty</span>
        <span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        elements[h] = <span class="hljs-keyword">null</span>;     <span class="hljs-comment">// Must null out slot</span>
        head = (h + <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> result;
    }
    <span class="hljs-comment">//后端出对（删除后端）</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pollLast</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">int</span> t = (tail - <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>);
        E result = elements[t];
        <span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        elements[t] = <span class="hljs-keyword">null</span>;
        tail = t;
        <span class="hljs-keyword">return</span> result;
    }
    <span class="hljs-comment">/**
     * 得到前端头元素
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">getFirst</span><span class="hljs-params">()</span> </span>{
        E x = elements[head];
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-comment">/**
     * 得到末端尾元素
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">getLast</span><span class="hljs-params">()</span> </span>{
        E x = elements[(tail - <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>)];
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peekFirst</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> elements[head]; <span class="hljs-comment">// elements[head] is null if deque empty</span>
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peekLast</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> elements[(tail - <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>)];
    }
    <span class="hljs-comment">/**
     * 移除此双端队列中第一次出现的指定元素（当从头部到尾部遍历双端队列时）。
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">removeFirstOccurrence</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">int</span> mask = elements.length - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> i = head;
        E x;
        <span class="hljs-keyword">while</span> ( (x = elements[i]) != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">if</span> (o.equals(x)) {
                delete(i);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            }
            i = (i + <span class="hljs-number">1</span>) &amp; mask;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }
    <span class="hljs-comment">/**
     * 移除此双端队列中最后一次出现的指定元素（当从头部到尾部遍历双端队列时）。
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">removeLastOccurrence</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">int</span> mask = elements.length - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> i = (tail - <span class="hljs-number">1</span>) &amp; mask;
        E x;
        <span class="hljs-keyword">while</span> ( (x = elements[i]) != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">if</span> (o.equals(x)) {
                delete(i);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            }
            i = (i - <span class="hljs-number">1</span>) &amp; mask;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }
    <span class="hljs-comment">// *** 队列方法（Queue methods） ***</span>
    <span class="hljs-comment">/**
     * add方法，添加到队列末端
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
        addLast(e);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    <span class="hljs-comment">/**
     * 同上
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offer</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">return</span> offerLast(e);
    }
    <span class="hljs-comment">/**
     * remove元素，删除队列前端
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> removeFirst();
    }
    <span class="hljs-comment">/**
     * 弹出前端（出对，删除前端）
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">poll</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> pollFirst();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">element</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> getFirst();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peek</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> peekFirst();
    }
    <span class="hljs-comment">// *** 栈 方法（Stack methods） ***</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(E e)</span> </span>{
        addFirst(e);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> removeFirst();
    }
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkInvariants</span><span class="hljs-params">()</span> </span>{ ……    }
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>{   ……   }
    <span class="hljs-comment">// *** 集合方法（Collection Methods） ***</span>
    ……
    <span class="hljs-comment">// *** Object methods ***</span>
    ……
}
整体来说:<span class="hljs-number">1</span>个数组，<span class="hljs-number">2</span>个index（head 索引和tail索引）。实现比较简单，容易理解。</pre>
    <br>
    <br>
    <p>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </p>
    <h2>
      <span style="font-family:SimSun;">2、LinkedList实现Deque</span>
    </h2>
    <div>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </div>
    <p>
      <img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/yQ3ER3.png!web" alt="" style="display: block;">
      <br>
    </p>
    <p>
      <span style="font-family:SimSun;">对于LinkedList本身而言，数据结构就更简单了，除了一个size用来记录大小外，只有head一个元素Entry。对比Map和Queue的其它数据结构可以看到这里的Entry有两个引用，是双向的队列。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">在示意图中，LinkedList总是有一个“傀儡”节点，用来描述队列“头部”，但是并不表示头部元素，它是一个执行null的空节点。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">队列一开始只有head一个空元素，然后从尾部加入E1(add/addLast)，head和E1之间建立双向链接。然后继续从尾部加入E2，E2就在head和E1之间建立双向链接。最后从队列的头部加入E3(push/addFirst)，于是E3就在E1和head之间链接双向链接。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">双向链表的数据结构比较简单，操作起来也比较容易，从事从“傀儡”节点开始，“傀儡”节点的下一个元素就是队列的头部，前一个元素是队列的尾部，换句话说，“傀儡”节点在头部和尾部之间建立了一个通道，是整个队列形成一个循环，这样就可以从任意一个节点的任意一个方向能遍历完整的队列。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">同样LinkedList也是一个没有容量限制的队列，因此入队列（不管是从头部还是尾部）总能成功。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">&nbsp;</span>
    </p>
    <h2>
      <span style="font-family:SimSun;">3、小结&nbsp;</span>
    </h2>
    <div>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </div>
    <p>
      <span style="font-family:SimSun;">上面描述的ArrayDeque和LinkedList是两种不同方式的实现，通常在遍历和节省内存上ArrayDeque更高效（索引更快，另外不需要Entry对象），但是在队列扩容下LinkedList更灵活，因为不需要复制原始的队列，某些情况下可能更高效。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">同样需要注意的上述两个实现都不是线程安全的，因此只适合在单线程环境下使用，下面章节要介绍的LinkedBlockingDeque就是线程安全的可阻塞的Deque。事实上也应该是功能最强大的Queue实现，当然了实现起来也许会复杂一点。</span>
    </p>
  </div>
  <div>
    <span style="font-family:SimSun;">
      <br>
    </span>
  </div>
  <h1>
    <span style="font-family:SimSun;">
      二、
      <span style="font-family:SimSun; line-height:19px; text-indent:20px">双向并发阻塞队列&nbsp;</span>
      LinkedBlockingDeque
    </span>
  </h1>
  <div>
    <br>
  </div>
  <div>
    <h2>
      <span style="font-family:SimSun;">
        <span style="line-height:19px;text-indent:20px;font-family:SimSun;">1、LinkedBlockingDeque数据结构</span>
      </span>
    </h2>
    <div>
      <span style="font-family:SimSun;">
        <span style="line-height:19px;text-indent:20px;font-family:SimSun;">
          <br>
        </span>
      </span>
    </div>
    <p>
      <span style="font-family:SimSun;">双向并发阻塞队列。所谓双向是指可以从队列的头和尾同时操作，并发只是线程安全的实现，阻塞允许在入队出队不满足条件时挂起线程，这里说的队列是指支持FIFO/FILO实现的链表。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">&nbsp;</span>
    </p>
    <p>
      <span style="font-family:SimSun;">首先看下LinkedBlockingDeque的数据结构。通常情况下从数据结构上就能看出这种实现的优缺点，这样就知道如何更好的使用工具了。</span>
    </p>
    <p>
      <img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/eIVvQz.png!web" alt="" style="display: block;">
      <br>
    </p>
    <p>
      <span style="font-family:SimSun;">从数据结构和功能需求上可以得到以下结论：</span>
    </p>
    <ol style="line-height:20px">
      <li>
        <span style="font-family:SimSun;">要想支持阻塞功能，队列的容量一定是固定的，否则无法在入队的时候挂起线程。也就是capacity是final类型的。</span>
      </li>
      <li>
        <span style="font-family:SimSun;">既然是双向链表，每一个结点就需要前后两个引用，这样才能将所有元素串联起来，支持双向遍历。也即需要prev/next两个引用。</span>
      </li>
      <li>
        <span style="font-family:SimSun;">双向链表需要头尾同时操作，所以需要first/last两个节点，当然可以参考LinkedList那样采用一个节点的双向来完成，那样实现起来就稍微麻烦点。</span>
      </li>
      <li>
        <span style="font-family:SimSun;">既然要支持阻塞功能，就需要锁和条件变量来挂起线程。这里使用一个锁两个条件变量来完成此功能。</span>
      </li>
    </ol>
    <div>
      <span style="font-family:SimSun;">
        <span style="line-height:20px">
          <br>
        </span>
      </span>
    </div>
    <h2>
      <span style="font-family:SimSun;">
        2、
        <span style="line-height:19px;text-indent:20px;font-family:SimSun;">LinkedBlockingDeque源码分析</span>
      </span>
    </h2>
    <div>
      <span style="font-family:SimSun;">
        <span style="line-height:19px;text-indent:20px;font-family:SimSun;">
          <br>
        </span>
      </span>
    </div>
    <pre class="prettyprint hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinkedBlockingDeque</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueue</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">BlockingDeque</span>&lt;<span class="hljs-title">E</span>&gt;,  <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>{
    <span class="hljs-comment">/** 包含前驱和后继节点的双向链式结构 */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>&lt;<span class="hljs-title">E</span>&gt; </span>{
 E item;
        Node&lt;E&gt; prev;
        Node&lt;E&gt; next;
        Node(E x, Node&lt;E&gt; p, Node&lt;E&gt; n) {
            item = x;
            prev = p;
            next = n;
        }
    }
    <span class="hljs-comment">/** 头节点 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> Node&lt;E&gt; first;
    <span class="hljs-comment">/** 尾节点 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> Node&lt;E&gt; last;
    <span class="hljs-comment">/** 元素个数*/</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> count;
    <span class="hljs-comment">/** 队列容量 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> capacity;
    <span class="hljs-comment">/** 锁 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();
    <span class="hljs-comment">/** notEmpty条件 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notEmpty = lock.newCondition();
    <span class="hljs-comment">/** notFull条件 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notFull = lock.newCondition();
    <span class="hljs-comment">/** 构造方法 */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LinkedBlockingDeque</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>(Integer.MAX_VALUE);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LinkedBlockingDeque</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>{
        <span class="hljs-keyword">if</span> (capacity &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();
        <span class="hljs-keyword">this</span>.capacity = capacity;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LinkedBlockingDeque</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> </span>{
        <span class="hljs-keyword">this</span>(Integer.MAX_VALUE);
        <span class="hljs-keyword">for</span> (E e : c)
            add(e);
    }

    <span class="hljs-comment">/**
     * 添加元素作为新的头节点
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">linkFirst</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (count &gt;= capacity)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        ++count;
        Node&lt;E&gt; f = first;
        Node&lt;E&gt; x = <span class="hljs-keyword">new</span> Node&lt;E&gt;(e, <span class="hljs-keyword">null</span>, f);
        first = x;
        <span class="hljs-keyword">if</span> (last == <span class="hljs-keyword">null</span>)
            last = x;
        <span class="hljs-keyword">else</span>
            f.prev = x;
        notEmpty.signal();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    <span class="hljs-comment">/**
     * 添加尾元素
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">linkLast</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (count &gt;= capacity)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        ++count;
        Node&lt;E&gt; l = last;
        Node&lt;E&gt; x = <span class="hljs-keyword">new</span> Node&lt;E&gt;(e, l, <span class="hljs-keyword">null</span>);
        last = x;
        <span class="hljs-keyword">if</span> (first == <span class="hljs-keyword">null</span>)
            first = x;
        <span class="hljs-keyword">else</span>
            l.next = x;
        notEmpty.signal();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    <span class="hljs-comment">/**
     * 返回并移除头节点
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> E <span class="hljs-title">unlinkFirst</span><span class="hljs-params">()</span> </span>{
        Node&lt;E&gt; f = first;
        <span class="hljs-keyword">if</span> (f == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        Node&lt;E&gt; n = f.next;
        first = n;
        <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)
            last = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">else</span>
            n.prev = <span class="hljs-keyword">null</span>;
        --count;
        notFull.signal();
        <span class="hljs-keyword">return</span> f.item;
    }
    <span class="hljs-comment">/**
     * 返回并移除尾节点
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> E <span class="hljs-title">unlinkLast</span><span class="hljs-params">()</span> </span>{
        Node&lt;E&gt; l = last;
        <span class="hljs-keyword">if</span> (l == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        Node&lt;E&gt; p = l.prev;
        last = p;
        <span class="hljs-keyword">if</span> (p == <span class="hljs-keyword">null</span>)
            first = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">else</span>
            p.next = <span class="hljs-keyword">null</span>;
        --count;
        notFull.signal();
        <span class="hljs-keyword">return</span> l.item;
    }
    <span class="hljs-comment">/**
     * 移除节点x
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlink</span><span class="hljs-params">(Node&lt;E&gt; x)</span> </span>{
        Node&lt;E&gt; p = x.prev;
        Node&lt;E&gt; n = x.next;
        <span class="hljs-keyword">if</span> (p == <span class="hljs-keyword">null</span>) {<span class="hljs-comment">//x是头的情况</span>
            <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)
                first = last = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">else</span> {
                n.prev = <span class="hljs-keyword">null</span>;
                first = n;
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>) {<span class="hljs-comment">//x是尾的情况</span>
            p.next = <span class="hljs-keyword">null</span>;
            last = p;
        } <span class="hljs-keyword">else</span> {<span class="hljs-comment">//x是中间的情况</span>
            p.next = n;
            n.prev = p;
        }
        --count;
        notFull.signalAll();
    }
    <span class="hljs-comment">//--------------------------------- BlockingDeque 双端阻塞队列方法实现</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addFirst</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (!offerFirst(e))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"Deque full"</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addLast</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (!offerLast(e))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"Deque full"</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offerFirst</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> linkFirst(e);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offerLast</span><span class="hljs-params">(E e)</span> </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> linkLast(e);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">putFirst</span><span class="hljs-params">(E e)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (!linkFirst(e))
                notFull.await();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">putLast</span><span class="hljs-params">(E e)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (!linkLast(e))
                notFull.await();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offerFirst</span><span class="hljs-params">(E e, <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span>
        <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
 <span class="hljs-keyword">long</span> nanos = unit.toNanos(timeout);
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (;;) {
                <span class="hljs-keyword">if</span> (linkFirst(e))
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
                nanos = notFull.awaitNanos(nanos);
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offerLast</span><span class="hljs-params">(E e, <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span>
        <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">if</span> (e == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();
 <span class="hljs-keyword">long</span> nanos = unit.toNanos(timeout);
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (;;) {
                <span class="hljs-keyword">if</span> (linkLast(e))
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
                nanos = notFull.awaitNanos(nanos);
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">removeFirst</span><span class="hljs-params">()</span> </span>{
        E x = pollFirst();
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">removeLast</span><span class="hljs-params">()</span> </span>{
        E x = pollLast();
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pollFirst</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> unlinkFirst();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pollLast</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> unlinkLast();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">takeFirst</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            E x;
            <span class="hljs-keyword">while</span> ( (x = unlinkFirst()) == <span class="hljs-keyword">null</span>)
                notEmpty.await();
            <span class="hljs-keyword">return</span> x;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">takeLast</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            E x;
            <span class="hljs-keyword">while</span> ( (x = unlinkLast()) == <span class="hljs-keyword">null</span>)
                notEmpty.await();
            <span class="hljs-keyword">return</span> x;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pollFirst</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span>
        <span class="hljs-keyword">throws</span> InterruptedException </span>{
 <span class="hljs-keyword">long</span> nanos = unit.toNanos(timeout);
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (;;) {
                E x = unlinkFirst();
                <span class="hljs-keyword">if</span> (x != <span class="hljs-keyword">null</span>)
                    <span class="hljs-keyword">return</span> x;
                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
                nanos = notEmpty.awaitNanos(nanos);
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pollLast</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span>
        <span class="hljs-keyword">throws</span> InterruptedException </span>{
 <span class="hljs-keyword">long</span> nanos = unit.toNanos(timeout);
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (;;) {
                E x = unlinkLast();
                <span class="hljs-keyword">if</span> (x != <span class="hljs-keyword">null</span>)
                    <span class="hljs-keyword">return</span> x;
                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
                nanos = notEmpty.awaitNanos(nanos);
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">getFirst</span><span class="hljs-params">()</span> </span>{
        E x = peekFirst();
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">getLast</span><span class="hljs-params">()</span> </span>{
        E x = peekLast();
        <span class="hljs-keyword">if</span> (x == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();
        <span class="hljs-keyword">return</span> x;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peekFirst</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> (first == <span class="hljs-keyword">null</span>) ? <span class="hljs-keyword">null</span> : first.item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peekLast</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> (last == <span class="hljs-keyword">null</span>) ? <span class="hljs-keyword">null</span> : last.item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">removeFirstOccurrence</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (Node&lt;E&gt; p = first; p != <span class="hljs-keyword">null</span>; p = p.next) {
                <span class="hljs-keyword">if</span> (o.equals(p.item)) {
                    unlink(p);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">removeLastOccurrence</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (Node&lt;E&gt; p = last; p != <span class="hljs-keyword">null</span>; p = p.prev) {
                <span class="hljs-keyword">if</span> (o.equals(p.item)) {
                    unlink(p);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-comment">//---------------------------------- BlockingQueue阻塞队列 方法实现</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
 addLast(e);
 <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offer</span><span class="hljs-params">(E e)</span> </span>{
 <span class="hljs-keyword">return</span> offerLast(e);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(E e)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
 putLast(e);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offer</span><span class="hljs-params">(E e, <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span>
        <span class="hljs-keyword">throws</span> InterruptedException </span>{
 <span class="hljs-keyword">return</span> offerLast(e, timeout, unit);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">return</span> removeFirst();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">poll</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">return</span> pollFirst();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
 <span class="hljs-keyword">return</span> takeFirst();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">poll</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
 <span class="hljs-keyword">return</span> pollFirst(timeout, unit);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">element</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">return</span> getFirst();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">peek</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">return</span> peekFirst();
    }
    <span class="hljs-comment">//------------------------------------------- Stack 方法实现</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(E e)</span> </span>{
 addFirst(e);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">return</span> removeFirst();
    }
    <span class="hljs-comment">//------------------------------------------- Collection 方法实现</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object o)</span> </span>{
 <span class="hljs-keyword">return</span> removeFirstOccurrence(o);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> count;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">contains</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (Node&lt;E&gt; p = first; p != <span class="hljs-keyword">null</span>; p = p.next)
                <span class="hljs-keyword">if</span> (o.equals(p.item))
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">removeNode</span><span class="hljs-params">(Node&lt;E&gt; e)</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (Node&lt;E&gt; p = first; p != <span class="hljs-keyword">null</span>; p = p.next) {
                <span class="hljs-keyword">if</span> (p == e) {
                    unlink(p);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
  ……
}</pre>
    <br>
    <br>
    <h2>
      <span style="font-family:SimSun;">
        3、
        <span style="line-height:19px;text-indent:20px;font-family:SimSun;">LinkedBlockingDeque的优缺点</span>
      </span>
    </h2>
    <div>
      <span style="font-family:SimSun;">
        <span style="line-height:19px;text-indent:20px;font-family:SimSun;">
          <br>
        </span>
      </span>
    </div>
    <p>
      <span style="font-family:SimSun;">有了上面的结论再来研究LinkedBlockingDeque的优缺点。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">优点当然是功能足够强大，同时由于采用一个独占锁，因此实现起来也比较简单。所有对队列的操作都加锁就可以完成。同时独占锁也能够很好的支持双向阻塞的特性。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">凡事有利必有弊。缺点就是由于独占锁，所以不能同时进行两个操作，这样性能上就大打折扣。从性能的角度讲LinkedBlockingDeque要比LinkedBlockingQueue要低很多，比CocurrentLinkedQueue就低更多了，这在高并发情况下就比较明显了。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">前面分析足够多的Queue实现后，LinkedBlockingDeque的原理和实现就不值得一提了，无非是在独占锁下对一个链表的普通操作。</span>
    </p>
    <p>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </p>
    <h2>
      <span style="font-family:SimSun;">4、LinkedBlockingDeque的序列化、反序列化</span>
    </h2>
    <div>
      <span style="font-family:SimSun;">
        <br>
      </span>
    </div>
    <p>
      <span style="font-family:SimSun;">有趣的是此类支持序列化，但是Node并不支持序列化，因此fist/last就不能序列化，那么如何完成序列化/反序列化过程呢？</span>
    </p>
    <p>
      <span style="font-family:SimSun;">清单4 LinkedBlockingDeque的序列化、反序列化</span>
    </p>
    <blockquote style="line-height:20px">
      <p></p>
      <pre class="prettyprint hljs cs"><span style="font-size:14px;"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeObject</span>(<span class="hljs-params">java.io.ObjectOutputStream s</span>)
    throws java.io.IOException </span>{
    <span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// Write out capacity and any hidden stuff</span>
        s.defaultWriteObject();
        <span class="hljs-comment">// Write out all elements in the proper order.</span>
        <span class="hljs-keyword">for</span> (Node&lt;E&gt; p = first; p != <span class="hljs-literal">null</span>; p = p.next)
            s.writeObject(p.item);
        <span class="hljs-comment">// Use trailing null as sentinel</span>
        s.writeObject(<span class="hljs-literal">null</span>);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">lock</span>.unlock();
    }
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readObject</span>(<span class="hljs-params">java.io.ObjectInputStream s</span>)
    throws java.io.IOException, ClassNotFoundException </span>{
    s.defaultReadObject();
    count = <span class="hljs-number">0</span>;
    first = <span class="hljs-literal">null</span>;
    last = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// Read in all elements and place in queue</span>
    <span class="hljs-keyword">for</span> (;;) {
        E item = (E)s.readObject();
        <span class="hljs-keyword">if</span> (item == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">add</span>(item);
    }
}

 </span></pre>
      <br>
    </blockquote>
    <p>
      <span style="font-family:SimSun;">清单4 描述的是LinkedBlockingDeque序列化/反序列化的过程。序列化时将真正的元素写入输出流，最后还写入了一个null。读取的时候将所有对象列表读出来，如果读取到一个null就表示结束。这就是为什么写入的时候写入一个null的原因，因为没有将count写入流，所以就靠null来表示结束，省一个整数空间。</span>
    </p>
  </div>
  <div>
    <span style="font-family:SimSun;">
      <br>
    </span>
  </div>
  <div>
    <span style="font-family:SimSun;">参考内容来源：</span>
  </div>
  <div>
    <span style="font-family:SimSun;">
      <br>
    </span>
  </div>
  <div>
    <span style="font-family:SimSun;">
      集合框架 Queue篇（1）---ArrayDeque
      <br>
      http://hi.baidu.com/yao1111yao/item/1a1346f65a50d9c8521c266d
      <br>
      集合框架 Queue篇（7）---LinkedBlockingDeque
      <br>
      http://hi.baidu.com/yao1111yao/item/b1649cff2cf60be91a111f6d
      <br>
      深入浅出 Java Concurrency (24): 并发容器 part 9 双向队列集合 Deque
      <br>
      http://www.blogjava.net/xylz/archive/2010/08/12/328587.html
      <br>
      深入浅出 Java Concurrency (25): 并发容器 part 10 双向并发阻塞队列 BlockingDeque
      <br>
      http://www.blogjava.net/xylz/archive/2010/08/18/329227.html
      <br>
    </span>
  </div>
  <div>
    <span style="font-family:SimSun;">
      <br>
    </span>
  </div>
  <br>
</div>

        </div>
        <div class="article_social">
         <div class="article_like">
    <div class="circle circle-like" id="my_zan" data_id="AfIv6v">  </div>

</div>
        <div id="share_weixin_image">
            <img width="100px" height="100px" src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/qrcode.php">
        </div>
<div class="article_share_fav">
    <div class="share" id="ckepop">
        <span>分享</span>
        <button class="share_weibo" id="share_weibo_id" title="分享到新浪微博"></button>
        <button class="share_qq" id="share_qq_id" title="分享到QQ空间"></button>
        <button class="share_weixin" id="share_weixin_id"></button>
    </div>
    <div class="fav_correct">
        <button id="my_fav" data_id="AfIv6v">
            <i class="icon icon-star-empty"></i> <span id="fav_tip">收藏</span>
        </button>
        <button id="article-correct" data_id="AfIv6v" uid="0">
            <i class="icon icon-warning-sign"></i>
            <span>纠错</span>
        </button>
    </div>
</div>
<script type="text/javascript">
$("#share_weibo_id").click( function() {
   window.open("http://share.baidu.com/s?type=text&searchPic=0&sign=on&to=tsina&url=http://www.tuicool.com/articles/AfIv6v&title=Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E5%85%AD%EF%BC%89%E4%B9%8BDeque%E4%B8%8ELinkedBlockingDeque%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90++%28%E5%88%86%E4%BA%AB%E8%87%AA+%40%E6%8E%A8%E9%85%B7%E7%BD%91%29&key=3113829255");
});
$("#share_qq_id").click( function() {
   window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.tuicool.com/articles/AfIv6v&title=Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%88%E5%85%AD%EF%BC%89%E4%B9%8BDeque%E4%B8%8ELinkedBlockingDeque%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90&desc=&summary=&site=");
});
$("#share_weixin_id").click( function() {
  $("#share_weixin_image").toggle();
});
</script>


            <div class="bottom_plink huodong-detail-plink-banner clearfix">
                    <a href="http://bird.so/" target="_blank"><img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/bird700.jpg"></a>

            </div>
        </div>
        <div id="site_articles" style="clear:both;">
              <div class="article-part-title">
                <span>推荐文章</span>
              </div>
          <ul class="side_article_list">
                <li class="side_article_list_item">
                    1.<a href="http://www.tuicool.com/articles/uU7JvaU" target="_blank" title="Redis基础学习笔记">
                    Redis基础学习笔记
                    </a>
                </li>
                <li class="side_article_list_item">
                    2.<a href="http://www.tuicool.com/articles/Mruyyin" target="_blank" title="Redis在京东到家的订单中的使用">
                    Redis在京东到家的订单中的使用
                    </a>
                </li>
                <li class="side_article_list_item">
                    3.<a href="http://www.tuicool.com/articles/UvAJjin" target="_blank" title="一个Redis Cache实现">
                    一个Redis Cache实现
                    </a>
                </li>
                <li class="side_article_list_item">
                    4.<a href="http://www.tuicool.com/articles/uYfyq2Z" target="_blank" title="有关缓存高可用性的思考">
                    有关缓存高可用性的思考
                    </a>
                </li>
                <li class="side_article_list_item">
                    5.<a href="http://www.tuicool.com/articles/eUryI3q" target="_blank" title="踩了 Laravel Cache 的一个坑">
                    踩了 Laravel Cache 的一个坑
                    </a>
                </li>
                <li class="side_article_list_item">
                    6.<a href="http://www.tuicool.com/articles/2myQFrU" target="_blank" title="使用JavaScript和MQTT开发物联网应用">
                    使用JavaScript和MQTT开发物联网应用
                    </a>
                </li>
          </ul>
        </div>
        <div id="kan_articles"> <div class="article-part-title"> <span>相关推刊</span></div><div class="kan-list-container"><ul class="kan-list clearfix">          <li class="kan-item">            <a href="http://www.tuicool.com/kans/1267481742" target="_blank" class="kan-item-head">              <small>by 西经无缺</small>              <img class="kan-cover" src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/default_kan_cover.png">            </a>            <span class="kan-detail">              <a href="http://www.tuicool.com/kans/1267481742" target="_blank">《多线程》</a>              <i class="kan-num">20</i>            </span>          </li>        </ul></div><i class="clearfix"></i></div>
        <div id="article_weibo" style="display:none;">
            <div class="article-part-title">
                <span>相关微博</span>
                <sub>
                    <a href="http://www.tuicool.com/articles/weibo_list/AfIv6v" target="_blank">(<i id="weibo_num"></i>)</a> 
               </sub>
            </div>
            <div class="related-weibo-list"></div>
        </div>
        <div class="comments">
    <div class="comments-area">
    <div class="comments-header">
        <h5>我来评几句</h5>
        <div class="alert comment-alert alert-error" style="display:none;">
            错误
        </div>
            <textarea cols="60" rows="5" id="comment-body" placeholder="请输入评论内容..." style="resize: none;"></textarea>
            <span class="btn btn-medium btn-submit" id="comment-submit">登录后评论</span>
        <p style="margin-top: 5px;margin-left:10px;">
            已发表评论数(<span class="comment_cnt">0</span>)
        </p>
    </div>
    <div class="comments-list">
        <div class="empty-cmts alert alert-success" style="display:none;">
            没有更多评论了^^
        </div>
    </div>
    <div class="more-comments" style="display:none;">
        <a href="http://www.tuicool.com/articles/AfIv6v">更多评论</a>
    </div>
    <div class="load-fail" style="display:none;">
        评论加载失败，<a href="javascript:reload_comments(&#39;AfIv6v&#39;,1,0,-1);">重新加载</a>
    </div>
    </div>
</div>

    </div>
        <div class="span4 article_right_side">
            <div class="right_top">
    <div class="article_related_site article_detail_bg">
    <h4 class="article-part-title">相关站点</h4>
    <div class="article_related_site_body clearfix">
        <div class="logo">
            <img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/JfmQBf.png">
        </div>
        <div class="name">
            <div>
                <a href="http://www.tuicool.com/sites/JfmQBf" target="_blank"> 郑雪峰的专栏</a>
            </div>
            <div>
                <div class="btn btn-success right_site_follow" id="my_follow" data_id="JfmQBf">＋订阅</div>
            </div>
        </div>
    </div>
</div>

<div id="right_site_articles" class="article_detail_bg">
    <div class="article-part-title">
        <span>热门文章</span>
    </div>
    <ul class="side_article_list">
        <li class="side_article_list_item">
            1.<a href="http://www.tuicool.com/articles/uU7JvaU" target="_blank" title="Redis基础学习笔记"> Redis基础学习笔记 </a>
        </li>
        <li class="side_article_list_item">
            2.<a href="http://www.tuicool.com/articles/Mruyyin" target="_blank" title="Redis在京东到家的订单中的使用"> Redis在京东到家的订单中的使用 </a>
        </li>
        <li class="side_article_list_item">
            3.<a href="http://www.tuicool.com/articles/uYfyq2Z" target="_blank" title="有关缓存高可用性的思考"> 有关缓存高可用性的思考 </a>
        </li>
        <li class="side_article_list_item">
            4.<a href="http://www.tuicool.com/articles/eUryI3q" target="_blank" title="踩了 Laravel Cache 的一个坑"> 踩了 Laravel Cache 的一个坑 </a>
        </li>
        <li class="side_article_list_item">
            5.<a href="http://www.tuicool.com/articles/2myQFrU" target="_blank" title="使用JavaScript和MQTT开发物联网应用"> 使用JavaScript和MQTT开发物联网应用 </a>
        </li>
    </ul>
</div>


      <div class="right-link">
                <a href="http://bird.so/" target="_blank"><img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/bird300.jpg"></a>

      </div>
      <div class="right-link" style="margin-top: 5px">
                <a href="https://dami.ksyun.com/?ch=00033.00018" target="_blank"><img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/ksyun335.jpg"></a>

      </div>
      <div class="right-link" style="margin-top: 5px">
                <a href="http://www.w3cschool.cn/welcome?tnid=1002" target="_blank"><img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/w3cschool302.jpg"></a>

      </div>
<div class="right-link" style="margin-top: 5px">
        <a href="http://www.yomail.com/?f=tuicool" target="_blank"><img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/yomail300.jpg"></a>

</div>
      <div class="right-link" style="margin-top: 5px">
                <a href="http://click.aliyun.com/m/17039/" target="_blank"><img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/aliyun311.jpg"></a>

      </div>
</div>
<div class="operate_zone" style="position: fixed; top: 50px;">
      <div class="right-link" style="margin-top: 0px">
                <a href="https://www.mtyun.com/activity-anniversary?site=tuicool&amp;campaign=20170601sales" target="_blank"><img src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/meituan308.jpg"></a>

      </div>
        <div class="frd_pos">
        <script async="" src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/adsbygoogle.js.下载"></script>
<ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-7054762349007490" data-ad-slot="5705695566" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:300px;height:250px;" src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/saved_resource.html"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
</div>
         </div>
</div>

<div>
   <!-- add_article to kan -->
<div id="add-article-to-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <span class="add-title">收藏到推刊</span>
    <a href="http://www.tuicool.com/articles/AfIv6v#new-kan" class="btn pull-right" data-toggle="modal">创建推刊</a>
    <i class="clearfix"></i>
  </div>
  <div class="modal-body">
    <ul id="add-kan-list">
    </ul>
  </div>
  <div class="modal-footer">
    <input type="hidden" value="AfIv6v" class="article-id"> 
    <button class="btn btn-primary pull-left add-to-btn">  收 藏  </button>
    <button class="btn" data-dismiss="modal" aria-hidden="true" style="margin-right: 15px">取消</button>
  </div>
</div>

   <div id="new-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-body">
    <input type="text" name="name" id="new-kan-name" placeholder="推刊名(必填)" required="" data-validation-required-message="请填写推刊名">
    <span class="new-ness-name">请填写推刊名</span>
    <br>
    <textarea name="desc" id="desc" rows="6" placeholder="推刊描述"></textarea>
    <span class="new-ness-desc">描述不能大于100个字符!</span>
    <br>
    权限设置：<input type="radio" name="type" value="1" checked="checked"> 公开
    <input type="radio" name="type" value="0"> 仅自己可见
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary pull-left create-kan-btn" disabled="">创建</button>
    <button class="btn dismiss-new-kan" data-dismiss="modal" aria-hidden="true">取消</button>
  </div>
</div>


</div>
<div id="article-correct-modal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
        </button>
        <h3>文章纠错</h3>
    </div>
    <div class="modal-body">
        <input type="hidden" value="AfIv6v" id="article-correct-source">
        <div>
            <label for="article-correct-email">
                邮箱地址
            </label>
            <input type="email" id="article-correct-email" class="input-large">
        </div>
        <div>
            <label for="article-correct-select">
                错误类型
            </label>
            <select id="article-correct-select">
                <option value="正文不准确">正文不准确</option>
                <option value="标题不准确">标题不准确</option>
                <option value="排版有问题">排版有问题</option>
                <option value="排版有问题">主题不准确</option>
                <option value="没有分页内容">没有分页内容</option>
                <option value="图片无法显示">图片无法显示</option>
                <option value="视频无法显示">视频无法显示</option>
                <option value="与原文不一致">与原文不一致</option>
            </select>
        </div>
        <div>
            <label for="article-correct-other">
                补充信息
            </label>
            <textarea id="article-correct-other" class="span4"></textarea>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary pull-right huodong_correct_submit" id="article-correct-submit">
            &nbsp;&nbsp;提交&nbsp;&nbsp;
        </button>
    </div>
</div>
      <link rel="stylesheet" href="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/highlight.default.css">
      <script src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/highlight.pack.js.下载"></script>
<script type="text/javascript">
    $('table').each(function(i) {
        var size = $(this).children().size();
        if (size > 1) {
            $(this).attr('class',"table table-bordered");
        } else if (size == 1) {
            var e11 = $(this).children(":first");
            var e1 = e11[0];
            var name = e1.nodeName.toLowerCase();
            if ("tbody" == name) {
                if (e1.children.length > 1) {
                    $(this).attr('class',"table table-bordered");
                } else if (e1.children.length == 1){
                    var e12 = e1.children[0];
                    var name2 = e12.nodeName.toLowerCase();
                    if ("tr" == name2) {
                       if (e12.children.length > 1) {
                         $(this).attr('class',"table table-bordered");
                       }
                    }
                }
            }
        }
    });
            related_kan("AfIv6v");
        window.page = 0;
        window.last = 0;    
        window.first = true;
        resize_article_image('#nei', 550);
                load_comments("AfIv6v",1,0,-1);
                window.uid = -1;
        open_add_article_to_kan("false");
        async_do_zan_article();
      $('pre').each(function(i, e) {
        hljs.highlightBlock(e, "<span class='indent'>  </span>", false)
      });
          
       handle_follow_site("#my_follow","已订阅","+ 订阅");
</script>


    <div class="loader-inner ball-pulse ball-loading-center" id="page-loading" style="display: none">
      <div></div>
      <div></div>
      <div></div>
    </div>
    <div class="read-later-alert"></div>
  </div>

        <div class="footer">
      <div class="footer-inner" style="padding-top: 50px;padding-bottom: 50px">
        <a href="http://www.tuicool.com/about" target="_blank">关于我们</a>
        <a href="http://www.tuicool.com/mobile" target="_blank">移动应用</a>
        <a href="http://www.tuicool.com/bbs/go/issues" target="_blank">意见反馈</a>
        <a target="_blank" href="http://e.weibo.com/tuicool2012">官方微博</a>
      </div>
    </div>
    <div style="display:none;">
      <script src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/stat.php" language="JavaScript"></script><script src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=5541078" target="_blank" title="站长统计"><img border="0" hspace="0" vspace="0" src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/pic.gif"></a>
    </div>

    <script type="text/javascript" src="./Java多线程（六）之Deque与LinkedBlockingDeque深入分析 - 推酷_files/tip.js.下载" async=""></script>


<div class="return" title="返回顶部" style="display: block;"></div></body></html>