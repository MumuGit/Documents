<!DOCTYPE html>
<!-- saved from url=(0033)https://www.diycode.cc/topics/383 -->
<html class="turbolinks-progress-bar"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode</title>
  
  <link rel="shortcut icon" type="image/x-icon" href="https://diycode.b0.upaiyun.com/assets/favicon-6200a4759942579bd403b10460911e7576be30b6ac3d88b6454a2a2544be70b5.ico">
  <meta name="keywords" content="/">
  <meta name="description" content="/">
  <meta name="apple-mobile-web-app-capable" content="no">
  <meta content="True" name="HandheldFriendly">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="alternate" type="application/rss+xml" title="订阅最新帖" href="https://www.diycode.cc/topics/feed">
  <meta property="wb:webmaster" content="d0ef27f708a14400">
  <link rel="stylesheet" media="screen" href="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/front-b64c4625672b5e1c4398f796ad39f408dd206728481fe2dfc6496aec80daa85f.css" data-turbolinks-track="true">
  <meta name="action-cable-url" content="/cable">
  <script async="" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/analytics.js.下载"></script><script src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/app-eab2e84baf7da2ad5cd02e0772763bee74ad836eab14d1f5bbc2dc56c8aa4fff.js.下载" data-turbolinks-track="true"></script><style>html.turbolinks-progress-bar::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  z-index: 2000;
  background-color: #0076ff;
  height: 3px;
  opacity: 0.99;
  width: 0%;
  transition: width 300ms ease-out, opacity 150ms ease-in;
  transform: translate3d(0,0,0);
}</style>
  <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="w+0xbBksmd4nHoGwbhmYSIT90cC58JZC/YhjFlP9CBN0XNPCEiz2KrU1JQmkuVqcxJGOc3vIz5XF5Um+Arr3tw==">
  <script src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/d3.min.js.下载" data-turbolinks-track="reload" type="text/javascript"></script>
  <script src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/cal-heatmap.min.js.下载" data-turbolinks-track="reload" type="text/javascript"></script>
  <link rel="dns-prefetch" href="https://assets.youhost.com/">

</head>
<body data-controller-name="topics">
  <div class="header">
    <nav class="navbar navbar-inverse navbar-static-top navbar-default">
      <div class="container">
        <div class="navbar-header" id="navbar-header" data-turbolinks-permanent="">
          <a href="https://www.diycode.cc/" class="navbar-brand"><img src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/a616a86eafa8b6c7a43fc7bbc8f041f1.png" alt="A616a86eafa8b6c7a43fc7bbc8f041f1"></a>
        </div>

        <span id="main-nav-menu" data-turbolinks-temporary="">
          <ul class="nav navbar-nav"><li class="active"><a href="https://www.diycode.cc/topics">社区</a></li><li class=""><a href="https://www.diycode.cc/projects">项目</a></li><li class=""><a href="https://www.diycode.cc/news">News</a></li><li class=""><a href="https://www.diycode.cc/trends">Github Ranking</a></li><li class=""><a href="https://www.diycode.cc/wiki">Wiki</a></li><li class=""><a href="https://www.diycode.cc/sites">酷站</a></li></ul>
        </span>

        <ul class="nav user-bar navbar-nav navbar-right">
  <li><a href="https://www.diycode.cc/account/sign_up">注册</a></li>
  <li><a href="https://www.diycode.cc/account/sign_in">登录</a></li>
</ul>


        <ul class="nav navbar-nav navbar-right">
          <li class="nav-search hidden-xs">
            <form class="navbar-form form-search active" action="https://www.diycode.cc/search" method="GET">
              <div class="form-group">
                <input class="form-control" name="q" type="text" value="" placeholder="搜索本站内容">
              </div>
              <i class="fa btn-search fa-search"></i>
            </form>
          </li>
        </ul>
      </div>
    </nav>
  </div>

  <div id="main" class="main-container container">
    
    
    
<div class="row">
  <div class="col-md-9">
    <div class="topic-detail panel panel-default">
      <div class="panel-heading media clearfix">
  <div class="media-body">
    <h1 class="media-heading">Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案</h1>
    <div class="info">
      <a class="node" href="https://www.diycode.cc/topics/node1">Android</a>
       ·
      <a data-author="true" data-name="Barry" class="hacknews_clear" href="https://www.diycode.cc/barryhappy">barryhappy</a>
       ·
      于 <abbr class="timeago" title="2016-10-27T00:11:18+08:00">1 年前</abbr>发布
         ·
        最后由 <a data-name="zcc" class="hacknews_clear" href="https://www.diycode.cc/zcc">zcc</a> 于 <abbr class="timeago" title="2017-08-29T19:43:51+08:00">2 月前</abbr>回复
       ·
      13166 次阅读
    </div>
  </div>
  <div class="avatar media-right">
    <a class="hacknews_clear" href="https://www.diycode.cc/barryhappy"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/2553.jpg" alt="2553"></a>
  </div>
</div>

      <div class="panel-body markdown">
        

        <article>
          <blockquote>
<p>本文由<a href="https://github.com/barryhappy" target="_blank">BarryZhang</a>原创，同时首发于diycode.cc、barryzhang.com 、github.com/barryhappy，非商业转载请注明作者和原文链接。</p>
</blockquote>
<h2 id="前言">前言</h2>
<p>开发做得久了，总免不了会遇到各种坑。<br>
而在Android开发的路上，『软键盘挡住了输入框』这个坑，可谓是一个旷日持久的巨坑——来来来，我们慢慢看。</p>
<h2 id="入门篇">入门篇</h2>
<p><a href="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/eb8116a5ec56ace24d6860a91cc7da77.png" class="zoom-image fluidbox" data-action="zoom"><div class="fluidbox-wrap" style="z-index: 990;"><img src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/eb8116a5ec56ace24d6860a91cc7da77.png" title="" alt="Base" style="opacity: 1;"><div class="fluidbox-ghost" style="width: 686px; height: 597px; top: 0px; left: 0px;"></div></div></a> </p>

<p>最基本的情况，如图所示：在页面底部有一个EditText，如果不做任何处理，那么在软键盘弹出的时候，就有可能会挡住EditText。<br>
对于这种情况的处理其实很简单，只需要在AndroidManifest文件中对activity设置：<code>android:windowSoftInputMode</code>的值<code>adjustPan</code>或者<code>adjustResize</code>即可，像这样：</p>
<pre class="highlight xml"><code><span class="nt">&lt;activity</span>
    <span class="na">android:name=</span><span class="s">".MainActivity"</span>
    <span class="na">android:windowSoftInputMode=</span><span class="s">"adjustPan"</span>  <span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/activity&gt;</span></code></pre>

<p>一般来说，他们都可以解决问题，当然，<code>adjustPan</code>跟<code>adjustResize</code>的效果略有区别。 </p>

<ul>
<li>
<code>adjustPan</code>是把整个界面向上平移，使输入框露出，不会改变界面的布局；</li>
<li>
<code>adjustResize</code>则是重新计算弹出软键盘之后的界面大小，相当于是用更少的界面区域去显示内容，输入框一般自然也就在内了。</li>
</ul>

<p>↑↑↑ OK，这只是入门，基本上地球上所有的Android工程师都能搞定。<br><br>
别急，看下面~</p>
<h2 id="加上WebView试试看？坑来了……">加上WebView试试看？坑来了……</h2>
<p>上面的入门篇中，软键盘是由原生的EditText触发弹出的。而在H5、Hybrid几乎已经成为App标配的时候，我们经常还会碰到的情况是：<strong>软键盘是由WebView中的网页元素所触发弹出的</strong>。  </p>
<h2 id="情况描述">情况描述</h2>
<p>这时候，情况就会变得复杂了: </p>

<ol>
<li>首先，页面是<code>非全屏模式</code>的情况下，给activity设置<code>adjustPan</code>会失效。</li>
<li>其次，页面是<code>全屏模式</code>的情况，<code>adjustPan</code>跟<code>adjustResize</code>都会失效。</li>
</ol>

<p>——解释一下，这里的<code>全屏模式</code>即是页面是全屏的，包括Application或activity使用了Fullscreen主题、使用了『状态色着色』、『沉浸式状态栏』、『Immersive Mode』等等——总之，基本上只要是App自己接管了状态栏的控制，就会产生这种问题。 </p>

<p>下面这个表格可以简单列举了具体的情况。 </p>

<p><a href="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/8be2511f709e5a4e696749c3bb4ba09c.jpg" class="zoom-image fluidbox" data-action="zoom"><div class="fluidbox-wrap" style="z-index: 990;"><img src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/8be2511f709e5a4e696749c3bb4ba09c.jpg" title="" alt="表格" style="opacity: 1;"><div class="fluidbox-ghost" style="width: 781px; height: 181px; top: 0px; left: 0px;"></div></div></a></p>
<h2 id="为什么说它是个坑？">为什么说它是个坑？"issue 5497"</h2>
<p>上面表格的这种情况并非是Google所期望的，理想的情况当然是它们都能正常生效才对——所以这其实是Android系统本身的一个BUG。 </p>

<p>为什么文章开头说这是个坑呢？<br>
——因为这个BUG从Android1.x时代（2009年）就被报告了，而一直到了如今的Android7.0（2016年）还是没有修复……/(ㄒoㄒ)/ <br>
可以说这不仅是个坑，而且还是个官方挖的坑~</p>

<p>"issue 5497"，详情传送门 ☞ <a href="https://code.google.com/p/android/issues/detail?id=5497" target="_blank">Issue 5497 - android -WebView adjustResize windowSoftInputMode breaks when activity is fullscreen - Android Open Source Project - Issue Tracker - Google Project Hosting</a></p>

<p>当然了，不管坑是谁挖的，最终还是要开发者来解决。</p>

<p>遇到坑之后，有两种方法可以过去：躲，或者填。</p>
<h2 id="躲坑姿势">躲坑姿势</h2>
<p>如前文所示，出现坑的条件是：带有WebView的activity使用了<code>全屏模式</code>或者<code>adjustPan</code>模式。<br>
那么躲坑的姿势就很简单了——<br>
    <strong>如果activity中有WebView，就不要使用<code>全屏模式</code>，并且把它的windowSoftInputMode值设为<code>adjustResize</code>就好了嘛</strong></p>

<p>怎么样，是不是很简单？😑 <br>
<a href="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/7f2a78e90fff74b16c3def880ba2c6a7.jpg" class="zoom-image fluidbox" data-action="zoom"><div class="fluidbox-wrap" style="z-index: 990;"><img src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/7f2a78e90fff74b16c3def880ba2c6a7.jpg" title="" alt="20130927092846557" style="opacity: 1;"><div class="fluidbox-ghost" style="width: 461px; height: 336px; top: 0px; left: 0px;"></div></div></a></p>
<h2 id="填坑姿势">填坑姿势</h2>
<p>但总有些时候，是需要<code>全屏模式</code>跟WebView兼得的，这时候，躲坑就不行了，我们需要一个新的填坑的姿势。幸好，开发者的智慧是无穷的，这个坑出现了这么多年，还是有人找到了一些解决方案的。 </p>
<h2 id="AndroidBug5497Workaround">AndroidBug5497Workaround</h2>
<p>我个人认为最好的解决方案是这个：<a href="http://stackoverflow.com/a/19494006" target="_blank">AndroidBug5497Workaround</a>，只需要一个神奇的<code>AndroidBug5497Workaround</code>类。</p>

<p>看名字就知道，它是专门用来对付"5497"问题的，使用步骤也是超级简单：</p>

<ol>
<li>把<code>AndroidBug5497Workaround</code>类复制到项目中</li>
<li>在需要填坑的activity的onCreate方法中添加一句<code>AndroidBug5497Workaround.assistActivity(this)</code>即可。<br>
</li>
</ol>

<p>经过测试，基本在各个Android版本上都可用，效果基本与设置了<code>adjustResize</code>相当。<br>
看一个对比图：</p>

<p><a href="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/4425e2d8092a6714dd89cefa2c7695db.jpg" class="zoom-image fluidbox" data-action="zoom"><div class="fluidbox-wrap" style="z-index: 990;"><img src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/4425e2d8092a6714dd89cefa2c7695db.jpg" title="" alt="效果对比图" style="opacity: 1;"><div class="fluidbox-ghost" style="width: 818px; height: 481px; top: 0px; left: 0px;"></div></div></a></p>

<p>来自我厂App的某个使用WebView的<code>全屏模式</code>Activity页面，从左到右分别是：没有软键盘的样式、软键盘挡住输入框的效果、以及使用AndroidBug5497Workaround之后的最终效果。</p>
<h2 id="它的原理是什么？">它的原理是什么？</h2>
<p>这个炫酷AndroidBug5497Workaround类，其实并不是很复杂，只有几十行代码，先贴在这里：</p>
<pre class="highlight java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AndroidBug5497Workaround</span> <span class="o">{</span>

    <span class="c1">// For more information, see https://code.google.com/p/android/issues/detail?id=5497</span>
    <span class="c1">// To use this class, simply invoke assistActivity() on an Activity that already has its content view set.</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">assistActivity</span> <span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">AndroidBug5497Workaround</span><span class="o">(</span><span class="n">activity</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">View</span> <span class="n">mChildOfContent</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">usableHeightPrevious</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">FrameLayout</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="n">frameLayoutParams</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">AndroidBug5497Workaround</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">FrameLayout</span> <span class="n">content</span> <span class="o">=</span> <span class="o">(</span><span class="n">FrameLayout</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">content</span><span class="o">);</span>
        <span class="n">mChildOfContent</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getViewTreeObserver</span><span class="o">().</span><span class="na">addOnGlobalLayoutListener</span><span class="o">(</span><span class="k">new</span> <span class="n">ViewTreeObserver</span><span class="o">.</span><span class="na">OnGlobalLayoutListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onGlobalLayout</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">possiblyResizeChildOfContent</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">frameLayoutParams</span> <span class="o">=</span> <span class="o">(</span><span class="n">FrameLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">)</span> <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getLayoutParams</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">possiblyResizeChildOfContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">usableHeightNow</span> <span class="o">=</span> <span class="n">computeUsableHeight</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">usableHeightNow</span> <span class="o">!=</span> <span class="n">usableHeightPrevious</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">usableHeightSansKeyboard</span> <span class="o">=</span> <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getRootView</span><span class="o">().</span><span class="na">getHeight</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">heightDifference</span> <span class="o">=</span> <span class="n">usableHeightSansKeyboard</span> <span class="o">-</span> <span class="n">usableHeightNow</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">heightDifference</span> <span class="o">&gt;</span> <span class="o">(</span><span class="n">usableHeightSansKeyboard</span><span class="o">/</span><span class="mi">4</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// keyboard probably just became visible</span>
                <span class="n">frameLayoutParams</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">usableHeightSansKeyboard</span> <span class="o">-</span> <span class="n">heightDifference</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// keyboard probably just became hidden</span>
                <span class="n">frameLayoutParams</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">usableHeightSansKeyboard</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">requestLayout</span><span class="o">();</span>
            <span class="n">usableHeightPrevious</span> <span class="o">=</span> <span class="n">usableHeightNow</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">computeUsableHeight</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Rect</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rect</span><span class="o">();</span>
        <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getWindowVisibleDisplayFrame</span><span class="o">(</span><span class="n">r</span><span class="o">);</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">bottom</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="na">top</span><span class="o">);</span><span class="c1">// 全屏模式下： return r.bottom</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>代码大致是做了这么几件事： </p>
<h3 id="1.找到activity的根View">1.找到activity的根View</h3>
<p>看一下入口的代码：</p>
<pre class="highlight java"><code><span class="n">FrameLayout</span> <span class="n">content</span> <span class="o">=</span> <span class="o">(</span><span class="n">FrameLayout</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">content</span><span class="o">);</span>
<span class="n">mChildOfContent</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre>

<p>其中，第一行中的<code>android.R.id.content</code>所指的View，是Android所有Activity界面上开发者所能控制的区域的根View。</p>

<blockquote>
<ul>
<li>如果Activity是<code>全屏模式</code>，那么android.R.id.content就是占满全部屏幕区域的。</li>
<li>如果Activity是普通的<code>非全屏模式</code>，那么android.R.id.content就是占满除状态栏之外的所有区域。</li>
<li>其他情况，如Activity是弹窗、或者7.0以后的分屏样式等，android.R.id.content也是弹窗的范围或者分屏所在的半个屏幕——这些情况较少，就暂且不考虑了。</li>
</ul>
</blockquote>

<p>我们经常用的setContentView(View view)/setContent(int layRes)其实就是把我们指定的View或者layRes放到android.R.id.content里面，成为它的子View。</p>

<p>所以，然后，第二行content.getChildAt(0)获取到的<code>mChildOfContent</code>，其实也就是用以获取到我们用setContentView放进去的View。</p>
<h3 id="2.设置一个Listener监听View树变化">2.设置一个Listener监听View树变化</h3><pre class="highlight java"><code><span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getViewTreeObserver</span><span class="o">().</span><span class="na">addOnGlobalLayoutListener</span><span class="o">({</span> <span class="c1">//简化了写法</span>
        <span class="n">possiblyResizeChildOfContent</span><span class="o">();</span>
<span class="o">});</span></code></pre>

<p>View.getViewTreeObserver()可以获取一个<code>ViewTreeObserver</code>对象——这个对象是一个观察者，专门用以监听当前View树所发生的一些变化。这里所注册的<code>addOnGlobalLayoutListener</code>，就是会在当前的View树的全局布局（GlobalLayout）发生变化、或者其中的View可视状态有变化时，进行通知回调。</p>

<p>——<strong>『软键盘弹出』，则是会触发这个事件的一个源。</strong> (软键盘弹出会使GlobalLayout发生变化)</p>

<p>也就是说，现在能监听到『软键盘弹出』的事件了。 </p>
<h3 id="3.界面变化之后，获取">3.界面变化之后，获取"可用高度"</h3>
<p>当软键盘弹出了之后，接下来的事情是获取改变之后的界面的<code>可用高度</code>（可以被开发者用以显示内容的高度）。<br>
直接看代码：</p>
<pre class="highlight java"><code>    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">computeUsableHeight</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Rect</span> <span class="n">rect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rect</span><span class="o">();</span>
        <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getWindowVisibleDisplayFrame</span><span class="o">(</span><span class="n">rect</span><span class="o">);</span>
        <span class="c1">// rect.top其实是状态栏的高度，如果是全屏主题，直接 return rect.bottom就可以了</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">rect</span><span class="o">.</span><span class="na">bottom</span> <span class="o">-</span> <span class="n">rect</span><span class="o">.</span><span class="na">top</span><span class="o">);</span>
    <span class="o">}</span></code></pre>

<p>View.getWindowVisibleDisplayFrame(Rect rect)，这行代码能够获取到的Rect——就是界面除去了标题栏、除去了被软键盘挡住的部分，所剩下的矩形区域——如图所示，红框中的区域。 <br>
<a href="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/a080a4da817215be58f6c9a299b23173.jpg" class="zoom-image fluidbox" data-action="zoom"><div class="fluidbox-wrap" style="z-index: 990;"><img src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/a080a4da817215be58f6c9a299b23173.jpg" title="" alt="Rect区域示意图" style="opacity: 1;"><div class="fluidbox-ghost" style="width: 422px; height: 657px; top: 0px; left: 0px;"></div></div></a><br>
↑也可以看出：</p>

<ul>
<li>rect.top值，其实就是标题栏的高度。（实际上，这也常常被用作为获取标题栏高度的方法）</li>
<li>屏幕高度-rect.bottom，是软键盘的高度。（获取软键盘高度的方法也出现了）</li>
</ul>

<p>这时，就有：</p>

<ul>
<li>
<code>全屏模式</code>下，<code>可用高度</code> = rect.bottom </li>
<li>非<code>全屏模式</code>，<code>可用高度</code> = rect.bottom - rect.top</li>
</ul>
<h3 id="4.最后一步，重设高度">4.最后一步，重设高度</h3>
<p>我们计算出的<code>可用高度</code>，是目前在视觉效果上能看到的界面高度。但当前界面的实际高度是比<code>可用高度</code>要多出一个软键盘的距离的。<br>
所以，最后一步，就是把界面高度置为<code>可用高度</code>——大功告成。</p>
<pre class="highlight java"><code>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">possiblyResizeChildOfContent</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">usableHeightNow</span> <span class="o">=</span> <span class="n">computeUsableHeight</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">usableHeightNow</span> <span class="o">!=</span> <span class="n">usableHeightPrevious</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">usableHeightSansKeyboard</span> <span class="o">=</span> <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getRootView</span><span class="o">().</span><span class="na">getHeight</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">heightDifference</span> <span class="o">=</span> <span class="n">usableHeightSansKeyboard</span> <span class="o">-</span> <span class="n">usableHeightNow</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">heightDifference</span> <span class="o">&gt;</span> <span class="o">(</span><span class="n">usableHeightSansKeyboard</span><span class="o">/</span><span class="mi">4</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// keyboard probably just became visible</span>
                <span class="n">frameLayoutParams</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">usableHeightSansKeyboard</span> <span class="o">-</span> <span class="n">heightDifference</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// keyboard probably just became hidden</span>
                <span class="n">frameLayoutParams</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">usableHeightSansKeyboard</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">requestLayout</span><span class="o">();</span>
            <span class="n">usableHeightPrevious</span> <span class="o">=</span> <span class="n">usableHeightNow</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre>

<p>上面的代码里添加了一个"heightDifference &gt; (usableHeightSansKeyboard/4)"的判断，这是为了去除无谓的干扰。因为能触发OnGlobalLayout事件的原因有很多，不止是软键盘的弹出变化，还包括各种子View的隐藏显示变化等，它们对界面高度的影响有限。加上了这个判断之后，只有界面的高度变化超过1/4的屏幕高度，才会进行重新设置高度，基本能保证代码只响应软键盘的弹出。</p>
<h2 id="总结">总结</h2>
<p>总结起来，就是这样：</p>

<ol>
<li>普通Activity（不带WebView），直接使用<code>adjustpan</code>或者<code>adjustResize</code>
</li>
<li>如果带WebView：<br>

<ul>
<li>a) 如果非<code>全屏模式</code>，可以使用<code>adjustResize</code>
</li>
<li>b) 如果是<code>全屏模式</code>，则使用<code>AndroidBug5497Workaround</code>进行处理。</li>
</ul>
</li>
</ol>

<p>OK，以上就是一段关于『软键盘挡住输入框』的爬坑之旅。</p>

<hr>

<p>有用的链接：<br>
<a href="https://code.google.com/p/android/issues/detail?id=5497" rel="nofollow" target="_blank">https://code.google.com/p/android/issues/detail?id=5497</a><br>
<a href="http://stackoverflow.com/a/19494006" rel="nofollow" target="_blank">http://stackoverflow.com/a/19494006</a><br>
<a href="https://developer.android.com/reference/android/view/ViewTreeObserver.html" rel="nofollow" target="_blank">https://developer.android.com/reference/android/view/ViewTreeObserver.html</a></p>

<hr>

<p>关于作者 :<br>
<a href="http://www.barryzhang.com/" rel="nofollow" target="_blank">http://www.barryzhang.com</a> <br>
<a href="https://barryhappy.github.io/" rel="nofollow" target="_blank">https://barryhappy.github.io</a></p>
        </article>


        
      </div>

        <div class="label-awesome">
          <i class="fa fa-diamond awesome"></i> 本帖已被设为精华帖！
        </div>

      <div class="panel-footer clearfix">
        <div class="opts">
  <a class="" href="https://www.diycode.cc/account/sign_in"><i class="fa fa-thumbs-up"></i> <span></span></a>
  
  
  <span class="pull-right opts">
  </span>
</div>

      </div>
    </div>

    

    <div id="replies" class="panel panel-default" data-last-floor="15">
      <div class="total panel-heading">
        共收到 <b>15</b> 条回复
      </div>
      <div class="items panel-body">
        
          <div class="reply" data-id="1925" id="reply1">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/kymjs"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/2372.jpg" alt="2372"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="张涛" class="hacknews_clear" href="https://www.diycode.cc/kymjs">kymjs</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply1">#1</a> · <abbr class="timeago" title="2016-10-27T10:00:35+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1925" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="2372" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1925/edit"></a>
            <a data-floor="1" data-login="kymjs" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>👍 写的很好，应该可以帮到很多人 </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1926" id="reply2">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/wuzheng"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/96.png" alt="96"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="wuzheng" class="hacknews_clear" href="https://www.diycode.cc/wuzheng">wuzheng</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply2">#2</a> · <abbr class="timeago" title="2016-10-27T11:03:57+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1926" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="874" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1926/edit"></a>
            <a data-floor="2" data-login="wuzheng" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>感谢大神分享，请问有遇到过scrollview 嵌套webview的时候,在webview中输入,键盘遮挡Webview的吗？ </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1927" id="reply3">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/barryhappy"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/2553.jpg" alt="2553"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="Barry" class="hacknews_clear" href="https://www.diycode.cc/barryhappy">barryhappy</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply3">#3</a> · <abbr class="timeago" title="2016-10-27T11:12:02+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1927" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="2553" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1927/edit"></a>
            <a data-floor="3" data-login="barryhappy" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p><a href="https://www.diycode.cc/topics/383#reply1" class="at_floor" data-floor="1">#1楼</a> <a href="https://www.diycode.cc/kymjs" class="at_user" title="@kymjs"><i>@</i>kymjs</a>  多谢 </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1928" id="reply4">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/barryhappy"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/2553.jpg" alt="2553"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="Barry" class="hacknews_clear" href="https://www.diycode.cc/barryhappy">barryhappy</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply4">#4</a> · <abbr class="timeago" title="2016-10-27T11:13:02+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1928" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="2553" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1928/edit"></a>
            <a data-floor="4" data-login="barryhappy" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p><a href="https://www.diycode.cc/topics/383#reply2" class="at_floor" data-floor="2">#2楼</a> <a href="https://www.diycode.cc/wuzheng" class="at_user" title="@wuzheng"><i>@</i>wuzheng</a>  还没遇到过，不过你可以试试看AndroidBug5497Workaround这个方法，按理说应该是可以的。 </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1929" id="reply5">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/wuzheng"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/96.png" alt="96"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="wuzheng" class="hacknews_clear" href="https://www.diycode.cc/wuzheng">wuzheng</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply5">#5</a> · <abbr class="timeago" title="2016-10-27T11:21:44+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1929" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="874" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1929/edit"></a>
            <a data-floor="5" data-login="wuzheng" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p><a href="https://www.diycode.cc/topics/383#reply4" class="at_floor" data-floor="4">#4楼</a> <a href="https://www.diycode.cc/barryhappy" class="at_user" title="@barryhappy"><i>@</i>barryhappy</a> 刚试了下还是不行 </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1930" id="reply6">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/icegeneral"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/2143.jpg" alt="2143"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="" class="hacknews_clear" href="https://www.diycode.cc/icegeneral">icegeneral</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply6">#6</a> · <abbr class="timeago" title="2016-10-27T11:26:58+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="1" data-state="" data-type="Reply" data-id="1930" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span>1 个赞</span></a>
            <a class="edit fa fa-pencil" data-uid="2143" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1930/edit"></a>
            <a data-floor="6" data-login="icegeneral" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>写得很好，详细易懂。要是有办法能让键盘刚好是在输入框的底下，就更好了 </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1931" id="reply7">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/piasy"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/653.jpg" alt="653"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="Piasy" class="hacknews_clear" href="https://www.diycode.cc/piasy">piasy</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply7">#7</a> · <abbr class="timeago" title="2016-10-27T11:34:29+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1931" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="653" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1931/edit"></a>
            <a data-floor="7" data-login="piasy" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>写得不错，之前我也填过键盘弹起的坑，场景不同，大家也可以看看：<a href="http://blog.piasy.com/2016/02/24/Android-Multiple-Fragment-Layer/" rel="nofollow" target="_blank">http://blog.piasy.com/2016/02/24/Android-Multiple-Fragment-Layer/</a> </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1932" id="reply8">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/piasy"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/653.jpg" alt="653"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="Piasy" class="hacknews_clear" href="https://www.diycode.cc/piasy">piasy</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply8">#8</a> · <abbr class="timeago" title="2016-10-27T11:35:05+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1932" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="653" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1932/edit"></a>
            <a data-floor="8" data-login="piasy" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p><a href="https://www.diycode.cc/topics/383#reply6" class="at_floor" data-floor="6">#6楼</a> <a href="https://www.diycode.cc/icegeneral" class="at_user" title="@icegeneral"><i>@</i>icegeneral</a> 想一块去了 </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1935" id="reply9">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/barryhappy"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/2553.jpg" alt="2553"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="Barry" class="hacknews_clear" href="https://www.diycode.cc/barryhappy">barryhappy</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply9">#9</a> · <abbr class="timeago" title="2016-10-27T12:07:58+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1935" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="2553" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1935/edit"></a>
            <a data-floor="9" data-login="barryhappy" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p><a href="https://www.diycode.cc/topics/383#reply5" class="at_floor" data-floor="5">#5楼</a> <a href="https://www.diycode.cc/wuzheng" class="at_user" title="@wuzheng"><i>@</i>wuzheng</a> 贴一下代码？ </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1939" id="reply10">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/immortalz"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/96(1).png" alt="96"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="ImmortalZ" class="hacknews_clear" href="https://www.diycode.cc/immortalz">immortalz</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply10">#10</a> · <abbr class="timeago" title="2016-10-27T18:31:37+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1939" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="2618" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1939/edit"></a>
            <a data-floor="10" data-login="immortalz" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>大家有没有遇到，沉浸式后（不是指游戏的全屏），用buildToolsVersion 24.0.2 编译，弹出的dialog中如果包含了edittext，弹出的软键盘并不会把edittext向上顶（导致edittext被遮挡），<br>
但把24.0.2降低成23版本例如（23.0.3）就没有问题了，感觉好坑，高版本的库不应该是向下兼容的吗</p>
      </div>
    </div>
</div>
<div class="reply" data-id="1941" id="reply11">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/d_clock"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/30.jpg" alt="30"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="D_clock爱吃葱花" class="hacknews_clear" href="https://www.diycode.cc/d_clock">d_clock</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply11">#11</a> · <abbr class="timeago" title="2016-10-27T22:25:50+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="1" data-state="" data-type="Reply" data-id="1941" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span>1 个赞</span></a>
            <a class="edit fa fa-pencil" data-uid="30" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1941/edit"></a>
            <a data-floor="11" data-login="d_clock" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>很赞，之前微信的童鞋也发过一个库，关于输入法这块的，大家可以顺带看看 <a href="https://github.com/Jacksgong/JKeyboardPanelSwitch" rel="nofollow" target="_blank">https://github.com/Jacksgong/JKeyboardPanelSwitch</a> </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1947" id="reply12">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/414081399"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/2079.jpg" alt="2079"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="小云遥" class="hacknews_clear" href="https://www.diycode.cc/414081399">414081399</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply12">#12</a> · <abbr class="timeago" title="2016-10-28T10:31:20+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1947" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="2079" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1947/edit"></a>
            <a data-floor="12" data-login="414081399" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>很棒！ </p>
      </div>
    </div>
</div>
<div class="reply" data-id="1953" id="reply13">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/zubinxiong"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/528.jpg" alt="528"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="熊胖胖" class="hacknews_clear" href="https://www.diycode.cc/zubinxiong">zubinxiong</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply13">#13</a> · <abbr class="timeago" title="2016-10-28T17:07:39+08:00">1 年前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="1953" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="528" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/1953/edit"></a>
            <a data-floor="13" data-login="zubinxiong" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>之前也有遇到过这个问题，都是通过 adjustpan 解决的，暂时没遇到其他的情况。谢谢分享了，可以避免以后踩坑 </p>
      </div>
    </div>
</div>
<div class="reply" data-id="3054" id="reply14">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/l123456789jy"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/96(2).png" alt="96"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="Lazy" class="hacknews_clear" href="https://www.diycode.cc/l123456789jy">l123456789jy</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply14">#14</a> · <abbr class="timeago" title="2017-03-29T16:24:22+08:00">7 月前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="3054" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="1963" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/3054/edit"></a>
            <a data-floor="14" data-login="l123456789jy" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>我是横屏全屏输入框会被遮挡一点，全屏的时候使用</p>
<pre class="highlight java"><code> <span class="n">Full</span> <span class="n">screen</span> <span class="n">please</span> <span class="n">use</span>     
<span class="n">View</span> <span class="n">decorView</span> <span class="o">=</span> <span class="n">getWindow</span><span class="o">().</span><span class="na">getDecorView</span><span class="o">();</span>
<span class="c1">// Hide the status bar.</span>
    <span class="kt">int</span> <span class="n">uiOptions</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="na">SYSTEM_UI_FLAG_FULLSCREEN</span><span class="o">;</span>
    <span class="n">decorView</span><span class="o">.</span><span class="na">setSystemUiVisibility</span><span class="o">(</span><span class="n">uiOptions</span><span class="o">);</span>  </code></pre>

<p>不要使用android:Theme.Light.NoTitleBar.Fullscreen，就解决了</p>
      </div>
    </div>
</div>
<div class="reply" data-id="3981" id="reply15">
    <div class="avatar"><a class="hacknews_clear" href="https://www.diycode.cc/zcc"><img class="media-object avatar-48" style="max-width: 252px;" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/96(3).png" alt="96"></a></div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <a data-name="zcc" class="hacknews_clear" href="https://www.diycode.cc/zcc">zcc</a>
        </span> ·
        <span class="time">
          <a class="reply-floor" href="https://www.diycode.cc/topics/383#reply15">#15</a> · <abbr class="timeago" title="2017-08-29T19:43:51+08:00">2 月前</abbr>
        </span>
        <span class="opts pull-right">
            <a title="赞" data-count="0" data-state="" data-type="Reply" data-id="3981" class="likeable " href="https://www.diycode.cc/topics/383#"><i class="fa fa-thumbs-up"></i> <span></span></a>
            <a class="edit fa fa-pencil" data-uid="5530" title="修改回帖" href="https://www.diycode.cc/topics/383/replies/3981/edit"></a>
            <a data-floor="15" data-login="zcc" title="回复此楼" class="btn-reply fa fa-mail-reply" href="https://www.diycode.cc/topics/383#"></a>
        </span>
      </div>
      <div class="markdown">
        <p>非常感谢，帮我解决了大问题。不过我适配的pad还遇到一些相关的问题，特意记录下来：<a href="http://blog.sina.com.cn/s/blog_be2200300102wyz7.html" rel="nofollow" target="_blank">http://blog.sina.com.cn/s/blog_be2200300102wyz7.html</a></p>
      </div>
    </div>
</div>

      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-body">
        <div id="reply" class="form box">
    <div style="padding:20px;">
    需要 <a class="btn btn-primary" href="https://www.diycode.cc/account/sign_in">登录</a> 后方可回复, 如果你还没有账号请点击这里 <a class="btn btn-danger" href="https://www.diycode.cc/account/sign_up">注册</a>。
    </div>
</div>

      </div>
    </div>
  </div>

  <div class="sidebar hidden-mobile col-md-3">
    <div id="topic-sidebar">
  <div class="panel panel-default">
    <div class="panel-body">
      <a href="https://www.diycode.cc/topics/383#" class="btn btn-block btn-move-page" data-type="top"><i class="fa fa-arrow-up"></i></a>
      <div class="buttons">
        <div class="group likes opts">
          <a class="" href="https://www.diycode.cc/account/sign_in"><i class="fa fa-thumbs-up"></i> <span></span></a>
        </div>
        <div class="group">
          <div class="btn-group" role="group">
            
            
          </div>
        </div>
      </div>
      <hr>
      <div class="group">
        <div class="social-share-button" data-title="Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 via: @diycode_cc " data-img="" data-url="" data-desc="" data-via="">
<a rel="nofollow " data-site="twitter" class="ssb-icon ssb-twitter" onclick="return SocialShareButton.share(this);" title="分享到Twitter" href="https://www.diycode.cc/topics/383#"></a>
<a rel="nofollow " data-site="facebook" class="ssb-icon ssb-facebook" onclick="return SocialShareButton.share(this);" title="分享到Facebook" href="https://www.diycode.cc/topics/383#"></a>
<a rel="nofollow " data-site="google_plus" class="ssb-icon ssb-google_plus" onclick="return SocialShareButton.share(this);" title="分享到Google+" href="https://www.diycode.cc/topics/383#"></a>
<a rel="nofollow " data-site="weibo" class="ssb-icon ssb-weibo" onclick="return SocialShareButton.share(this);" title="分享到新浪微博" href="https://www.diycode.cc/topics/383#"></a>
<a rel="nofollow " data-site="douban" class="ssb-icon ssb-douban" onclick="return SocialShareButton.share(this);" title="分享到豆瓣" href="https://www.diycode.cc/topics/383#"></a>
</div>
      </div>
      <hr>
      <div class="reply-buttons">
        <div class="total">
          共收到 <b>15</b> 条回复
        </div>
        <a href="https://www.diycode.cc/topics/383#reply" class="btn btn-success btn-block btn-focus-reply">参与回复</a>
      </div>
      <hr>
      <div class="group opts">

      </div>
      <a href="https://www.diycode.cc/topics/383#" class="btn btn-block btn-move-page" data-type="bottom"><i class="fa fa-arrow-down"></i></a>
    </div>
  </div>

  <div class="notify-updated">
    <a class="update" href="https://www.diycode.cc/topics/383#"><i class="fa fa-bell-o"></i> <b>有新回复！</b>点击这里立即载入</a>
  </div>
</div>

  </div>
</div>

  </div>

  <footer class="footer" id="footer" data-turbolinks-permanent="">
    <div class="container">
      <div class="media">
  <div class="media-left" style="margin-right:20px;">
    <img class="media-object" src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/ef110d40d2fb44c7f5464bbf121ed9d8.png" style="width:56px;">
  </div>
  
  <div class="media-body">
    <div class="links">
 <a href="https://www.diycode.cc/wiki/about">关于</a> / 
<a href="https://www.diycode.cc/users">活跃会员</a> / 
<a href="https://www.diycode.cc/api">API</a> / 
<a href="https://www.diycode.cc/news">Hacker News</a> /  
<a href="https://www.diycode.cc/tags">tags</a> /  
<a href="https://www.diycode.cc/wiki/followus">关注我们</a>  /  
<a href="https://xiaozhuanlan.com/">小专栏</a> 
    </div>
    <div class="copyright">
    DiyCode由众多开发者共同维护，致力于构建开发工程师高端交流分享社区。<br>
    图片存储由 <a href="https://www.upyun.com/" target="_blank" style="display:inline-block;" rel="twipsy" title="" data-original-title="图片存储由又拍云赞助">又拍云存储</a> 提供。Inspired by RubyChina。<a href="http://www.miitbeian.gov.cn/publish/query/indexFirst.action" target="_blank"> 粤ICP备14008250号</a><br>
    </div>
    <div class="links" style="margin-top:8px" data-no-turbolink="">
       <a href="https://www.diycode.cc/topics/383?locale=zh-CN" rel="nofollow">简体中文</a> / <a href="https://www.diycode.cc/topics/383?locale=zh-TW" rel="nofollow">正體中文</a> / <a href="https://www.diycode.cc/topics/383?locale=en" rel="nofollow">English</a>
    </div>
  </div>
  <div class="media-right" style="width:200px; text-align:right;">
    <a href="http://www.ucloud.cn/" target="_blank" rel="twipsy" title="" style="display:inline-block;margin-right:5px; margin-top: 5px;" data-original-title="本站服务器由 UCloud 赞助"><img src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/60202bb15bf6dc06fc8dd7e8baea061c.png" style="height:24px;"></a>
  </div>

</div>

    </div>

  </footer>

  <script type="text/javascript" data-turbolinks-eval="false">
    App.root_url = "https://www.diycode.cc/";
    App.asset_url = "https://diycode.b0.upaiyun.com";
    App.locale = "zh-CN";
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92073059-1', 'auto');
    ga('send', 'pageview');
  </script>
    <script type="text/javascript">
    Topics.topic_id = 383;
    $(document).ready(function(){
    })
  </script>

  <div style="display:none">
    <script src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/z_stat.php" language="JavaScript"></script><script src="./Android 爬坑之旅：软键盘挡住输入框问题的终极解决方案 - DiyCode_files/core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1258132733" target="_blank" title="站长统计">站长统计</a>
  </div>
  <div class="zoom-overlay"></div>


<div id="atwho-container"></div></body></html>