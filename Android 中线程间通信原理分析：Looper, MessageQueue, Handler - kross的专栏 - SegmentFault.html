<!DOCTYPE html>
<!-- saved from url=(0043)https://segmentfault.com/a/1190000006171396 -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="renderer" content="webkit"><meta property="qc:admins" content="15317273575564615446375"><meta property="og:image" content="https://static.segmentfault.com/v-5954c7a4/global/img/touch-icon.png"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta name="alexaVerifyID" content="LkzCRJ7rPEUwt6fVey2vhxiw1vQ"><meta name="apple-itunes-app" content="app-id=958101793, app-argument="><title>Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault</title><meta name="description" content="转载一篇我之前发在csdn上的博客。 自问自答的两个问题 在我们去讨论Handler，Looper，MessageQueue的关系之前，我们需要先问两个问题： 这一套东西搞出来是为了解决什么问题呢？ 如果让我们来解决这个问题该怎么..."><meta name="keywords" content="android"><link rel="search" type="application/opensearchdescription+xml" href="https://segmentfault.com/opensearch.xml" title="SegmentFault"><link rel="shortcut icon" href="https://static.segmentfault.com/v-5954c7a4/global/img/favicon.ico"><link rel="apple-touch-icon" href="https://static.segmentfault.com/v-5954c7a4/global/img/touch-icon.png"><meta name="msapplication-TileColor" content="#009a61"><meta name="msapplication-square150x150logo" content="https://static.segmentfault.com/v-5954c7a4/global/img/touch-icon.png"><link rel="alternate" type="application/atom+xml" title="SegmentFault 最新问题" href="https://segmentfault.com/feeds/questions"><link rel="alternate" type="application/atom+xml" title="SegmentFault 最新文章" href="https://segmentfault.com/feeds/blogs"><link rel="stylesheet" href="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/global.css"><link rel="stylesheet" href="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/blog.css"><link rel="stylesheet" href="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/responsive.css"></head><body data-mod="blog" class="blog-post "><!--[if lt IE 9]><div class="alert alert-danger topframe" role="alert">你的浏览器实在<strong>太太太太太太旧了</strong>，放学别走，升级完浏览器再说 <a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div><![endif]--><img id="icon4weChat" style="height: 0;width: 0;" data-src="https://static.segmentfault.com/v-5954c7a4/global/img/touch-icon-512.png"><div class="global-nav sf-header sf-header--index"><nav class="container nav"><div class="visible-xs header-response"><a href="https://segmentfault.com/search" style="display:block"><i class="fa fa-search" aria-hidden="true"></i></a><div class="sf-header__logo sf-header__logo--response"><h1><a href="https://segmentfault.com/" style="height:24px; background-size: auto 24px;"></a></h1></div><a href="https://segmentfault.com/user/login" class="pull-right login-btn"><i class="fa fa-user" aria-hidden="true"></i></a><div class="bottom-nav"><div class="opts"><a class="opts-group " href="https://segmentfault.com/questions"><i class="fa fa-comments" aria-hidden="true"></i><span>问答</span></a><a class="opts-group " href="https://segmentfault.com/news"><i class="fa fa-newspaper-o" aria-hidden="true"></i><span>头条</span></a><a class="opts-group active" href="https://segmentfault.com/blogs"><i class="fa fa-pencil-square" aria-hidden="true"></i><span>专栏</span></a><a class="opts-group " href="https://segmentfault.com/lives"><i class="fa fa-play-circle" aria-hidden="true"></i><span>讲堂</span></a><div class="opts-group"><div class="btn-group dropup"><i class="fa fa-bars dropdown hoverDropdown" data-toggle="dropdown" aria-hidden="true"><span>更多</span></i><ul class="dropdown-menu"><li><a href="https://segmentfault.com/jobs">职位</a></li><li><a href="https://segmentfault.com/events">活动</a></li><li><a href="https://segmentfault.com/tags">标签</a></li><li><a href="https://segmentfault.com/badges">徽章</a></li></ul></div></div></div></div></div><div class="row hidden-xs"><div class="col-sm-8 col-md-9 col-lg-9"><div class="sf-header__logo"><h1><a href="https://segmentfault.com/">SegmentFault</a></h1></div><div><ul class="menu list-inline pull-left hidden-xs"><li class="menu__item"><a href="https://segmentfault.com/questions" class="">问答</a></li><li class="menu__item"><a href="https://segmentfault.com/news" class="">头条</a></li><li class="menu__item"><a href="https://segmentfault.com/blogs" class="active-nav">专栏</a></li><li class="menu__item"><a href="https://segmentfault.com/lives" class="">讲堂</a></li><li class="menu__item"><a href="https://segmentfault.com/jobs" class="">职位</a></li><li class="menu__item"><a href="https://segmentfault.com/events" class="">活动</a></li></ul><form action="https://segmentfault.com/search" class="header-search  hidden-sm hidden-xs pull-right"><button class="btn btn-link"><span class="sr-only">搜索</span><span class="glyphicon glyphicon-search"></span></button><input id="searchBox" name="q" type="text" placeholder="搜索问题或关键字" class="form-control" value=""></form></div></div><div class="col-sm-4 col-md-3 col-lg-3 text-right"><ul class="opts list-inline hidden-xs"><li class="opts__item"><a href="https://segmentfault.com/user/login" class="SFLogin btn-signin" style="margin-bottom:2px;">立即登录</a><a href="https://segmentfault.com/user/login" class="SFLogin ml10 btn-signup" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Button&#39;, &#39;Click&#39;, &#39;Login&#39;]);">免费注册</a></li></ul></div></div></nav></div>
    
<input id="articleId" value="1190000006171396" class="hidden">
<div class="wrap" data-blogid="1200000005805457">
    <div class="post-topheader custom-">
        <div class="container">
            <div class="block-for-right-border">
                <div class="row">
                    <div class="col-md-9 col-sm-8 col-xs-12">
                        <div class="post-topheader__info" data-username="Kross" data-userslug="kross" data-useravatar="https://sfault-avatar.b0.upaiyun.com/122/963/1229635323-58bd5e7971f00_big64">

                            <h1 class="h3 post-topheader__info--title" id="articleTitle" data-id="1190000006171396">
                                <a href="https://segmentfault.com/a/1190000006171396"> Android 中线程间通信原理分析：Looper, MessageQueue, Handler</a>
                            </h1>

                            <div class="content__tech">
                                <ul class="taglist--inline inline-block article__title--tag mr10">
                                                                            <li class="tagPopup mb5"><a class="tag" href="https://segmentfault.com/t/android/blogs" data-toggle="popover" data-img="https://sfault-avatar.b0.upaiyun.com/752/833/752833330-1040000000089658_huge256" data-placement="top" data-original-title="android" data-id="1040000000089658">android</a></li>
                                                                    </ul>
                                                                                                <div class="article__author">
                                    <a href="https://segmentfault.com/u/kross" class="mr5 "><strong>Kross</strong></a>
                                    2016年08月04日发布
                                                                                                        </div>
                            </div>

                                                        <form class="form form__tech hidden" data-action="#">
                                <span class="pull-right">
                                    <button class="btn btn-default save-tags-btn" type="button">保存</button>
                                </span>
                                <div class="form-group" style="margin-right: 65px">
                                    <label for="tags" class="sr-only">标签：至少1个，最多5个</label>
                                    <input class="tagsInput form-control hidden" data-init="[{&quot;name&quot;:&quot;android&quot;,&quot;url&quot;:&quot;\/t\/android&quot;,&quot;id&quot;:&quot;1040000000089658&quot;,&quot;thumbnailUrl&quot;:&quot;https:\/\/sfault-avatar.b0.upaiyun.com\/752\/833\/752833330-1040000000089658_huge256&quot;}]" name="tags" type="text" placeholder="标签，如：php 可使用逗号,分号;分隔" data-role="tagsinput"><div class="sf-typeHelper"><span class="sf-typeHelper-item  ">android<span data-role="remove">×</span></span><input type="text" data-role="sf_typeHelper-input" class="sf-typeHelper-input" placeholder="标签，如：php 可使用逗号,分号;分隔" style="width: 20em;"><ul class="sf-typeHelper-list dropdown-menu" style="display: none;"></ul></div>
                                    <div role="tabpanel" class="techTags panel panel-default techTags-panel" data-tech="{&quot;\u5f00\u53d1\u8bed\u8a00&quot;:[{&quot;id&quot;:&quot;1040000000089436&quot;,&quot;name&quot;:&quot;javascript&quot;},{&quot;id&quot;:&quot;1040000000089387&quot;,&quot;name&quot;:&quot;php&quot;},{&quot;id&quot;:&quot;1040000000089434&quot;,&quot;name&quot;:&quot;css&quot;},{&quot;id&quot;:&quot;1040000000089571&quot;,&quot;name&quot;:&quot;html&quot;},{&quot;id&quot;:&quot;1040000000089449&quot;,&quot;name&quot;:&quot;java&quot;},{&quot;id&quot;:&quot;1040000000089534&quot;,&quot;name&quot;:&quot;python&quot;},{&quot;id&quot;:&quot;1040000000089409&quot;,&quot;name&quot;:&quot;html5&quot;},{&quot;id&quot;:&quot;1040000000089918&quot;,&quot;name&quot;:&quot;node.js&quot;},{&quot;id&quot;:&quot;1040000000089741&quot;,&quot;name&quot;:&quot;c++&quot;},{&quot;id&quot;:&quot;1040000000089457&quot;,&quot;name&quot;:&quot;c&quot;},{&quot;id&quot;:&quot;1040000000090209&quot;,&quot;name&quot;:&quot;objective-c&quot;},{&quot;id&quot;:&quot;1040000000089669&quot;,&quot;name&quot;:&quot;shell&quot;},{&quot;id&quot;:&quot;1040000000090203&quot;,&quot;name&quot;:&quot;golang&quot;},{&quot;id&quot;:&quot;1040000000531223&quot;,&quot;name&quot;:&quot;swift&quot;},{&quot;id&quot;:&quot;1040000000089581&quot;,&quot;name&quot;:&quot;c#&quot;},{&quot;id&quot;:&quot;1040000000089699&quot;,&quot;name&quot;:&quot;ruby&quot;},{&quot;id&quot;:&quot;1040000000089686&quot;,&quot;name&quot;:&quot;bash&quot;},{&quot;id&quot;:&quot;1040000000091262&quot;,&quot;name&quot;:&quot;sass&quot;},{&quot;id&quot;:&quot;1040000000090433&quot;,&quot;name&quot;:&quot;asp.net&quot;},{&quot;id&quot;:&quot;1040000000365394&quot;,&quot;name&quot;:&quot;typescript&quot;},{&quot;id&quot;:&quot;1040000000090600&quot;,&quot;name&quot;:&quot;less&quot;},{&quot;id&quot;:&quot;1040000000090228&quot;,&quot;name&quot;:&quot;scala&quot;},{&quot;id&quot;:&quot;1040000000090208&quot;,&quot;name&quot;:&quot;lua&quot;},{&quot;id&quot;:&quot;1040000000161068&quot;,&quot;name&quot;:&quot;coffeescript&quot;},{&quot;id&quot;:&quot;1040000000090194&quot;,&quot;name&quot;:&quot;actionscript&quot;},{&quot;id&quot;:&quot;1040000000090201&quot;,&quot;name&quot;:&quot;erlang&quot;},{&quot;id&quot;:&quot;1040000000089698&quot;,&quot;name&quot;:&quot;perl&quot;},{&quot;id&quot;:&quot;1040000000311191&quot;,&quot;name&quot;:&quot;rust&quot;}],&quot;\u5e73\u53f0\u6846\u67b6&quot;:[{&quot;id&quot;:&quot;1040000000196640&quot;,&quot;name&quot;:&quot;laravel&quot;},{&quot;id&quot;:&quot;1040000000125263&quot;,&quot;name&quot;:&quot;flask&quot;},{&quot;id&quot;:&quot;1040000000089564&quot;,&quot;name&quot;:&quot;django&quot;},{&quot;id&quot;:&quot;1040000000090103&quot;,&quot;name&quot;:&quot;spring&quot;},{&quot;id&quot;:&quot;1040000000166256&quot;,&quot;name&quot;:&quot;express&quot;},{&quot;id&quot;:&quot;1040000000089646&quot;,&quot;name&quot;:&quot;ruby-on-rails&quot;},{&quot;id&quot;:&quot;1040000000090398&quot;,&quot;name&quot;:&quot;yii&quot;},{&quot;id&quot;:&quot;1040000000116331&quot;,&quot;name&quot;:&quot;tornado&quot;},{&quot;id&quot;:&quot;1040000000622042&quot;,&quot;name&quot;:&quot;koa&quot;},{&quot;id&quot;:&quot;1040000000089638&quot;,&quot;name&quot;:&quot;struts&quot;}],&quot;\u670d\u52a1\u5668&quot;:[{&quot;id&quot;:&quot;1040000000089392&quot;,&quot;name&quot;:&quot;linux&quot;},{&quot;id&quot;:&quot;1040000000090145&quot;,&quot;name&quot;:&quot;nginx&quot;},{&quot;id&quot;:&quot;1040000000089761&quot;,&quot;name&quot;:&quot;apache&quot;},{&quot;id&quot;:&quot;1040000000366352&quot;,&quot;name&quot;:&quot;docker&quot;},{&quot;id&quot;:&quot;1040000000090245&quot;,&quot;name&quot;:&quot;ubuntu&quot;},{&quot;id&quot;:&quot;1040000000090249&quot;,&quot;name&quot;:&quot;centos&quot;},{&quot;id&quot;:&quot;1040000000090401&quot;,&quot;name&quot;:&quot;\u7f13\u5b58&quot;},{&quot;id&quot;:&quot;1040000000090117&quot;,&quot;name&quot;:&quot;tomcat&quot;},{&quot;id&quot;:&quot;1040000000090107&quot;,&quot;name&quot;:&quot;\u8d1f\u8f7d\u5747\u8861&quot;},{&quot;id&quot;:&quot;1040000000090646&quot;,&quot;name&quot;:&quot;unix&quot;},{&quot;id&quot;:&quot;1040000000089648&quot;,&quot;name&quot;:&quot;hadoop&quot;},{&quot;id&quot;:&quot;1040000000090609&quot;,&quot;name&quot;:&quot;windows-server&quot;}],&quot;\u6570\u636e\u5e93\u548c\u7f13\u5b58&quot;:[{&quot;id&quot;:&quot;1040000000089439&quot;,&quot;name&quot;:&quot;mysql&quot;},{&quot;id&quot;:&quot;1040000000090049&quot;,&quot;name&quot;:&quot;sql&quot;},{&quot;id&quot;:&quot;1040000000089431&quot;,&quot;name&quot;:&quot;redis&quot;},{&quot;id&quot;:&quot;1040000000089488&quot;,&quot;name&quot;:&quot;mongodb&quot;},{&quot;id&quot;:&quot;1040000000090701&quot;,&quot;name&quot;:&quot;oracle&quot;},{&quot;id&quot;:&quot;1040000000089432&quot;,&quot;name&quot;:&quot;nosql&quot;},{&quot;id&quot;:&quot;1040000000089873&quot;,&quot;name&quot;:&quot;memcached&quot;},{&quot;id&quot;:&quot;1040000000090424&quot;,&quot;name&quot;:&quot;sqlserver&quot;},{&quot;id&quot;:&quot;1040000000090354&quot;,&quot;name&quot;:&quot;sqlite&quot;},{&quot;id&quot;:&quot;1040000000090861&quot;,&quot;name&quot;:&quot;postgresql&quot;}],&quot;\u5f00\u53d1\u5de5\u5177&quot;:[{&quot;id&quot;:&quot;1040000000089459&quot;,&quot;name&quot;:&quot;git&quot;},{&quot;id&quot;:&quot;1040000000091226&quot;,&quot;name&quot;:&quot;github&quot;},{&quot;id&quot;:&quot;1040000000089467&quot;,&quot;name&quot;:&quot;vim&quot;},{&quot;id&quot;:&quot;1040000000089579&quot;,&quot;name&quot;:&quot;xcode&quot;},{&quot;id&quot;:&quot;1040000000126097&quot;,&quot;name&quot;:&quot;sublime-text&quot;},{&quot;id&quot;:&quot;1040000000089509&quot;,&quot;name&quot;:&quot;eclipse&quot;},{&quot;id&quot;:&quot;1040000000090560&quot;,&quot;name&quot;:&quot;intellij-idea&quot;},{&quot;id&quot;:&quot;1040000000089447&quot;,&quot;name&quot;:&quot;svn&quot;},{&quot;id&quot;:&quot;1040000002720957&quot;,&quot;name&quot;:&quot;visual-studio-code&quot;},{&quot;id&quot;:&quot;1040000000090186&quot;,&quot;name&quot;:&quot;maven&quot;},{&quot;id&quot;:&quot;1040000000090473&quot;,&quot;name&quot;:&quot;ide&quot;},{&quot;id&quot;:&quot;1040000000090524&quot;,&quot;name&quot;:&quot;atom&quot;},{&quot;id&quot;:&quot;1040000000090231&quot;,&quot;name&quot;:&quot;visual-studio&quot;},{&quot;id&quot;:&quot;1040000000090216&quot;,&quot;name&quot;:&quot;emacs&quot;},{&quot;id&quot;:&quot;1040000000183694&quot;,&quot;name&quot;:&quot;hg&quot;},{&quot;id&quot;:&quot;1040000000089663&quot;,&quot;name&quot;:&quot;textmate&quot;}],&quot;\u7cfb\u7edf\u8bbe\u5907&quot;:[{&quot;id&quot;:&quot;1040000000089658&quot;,&quot;name&quot;:&quot;android&quot;},{&quot;id&quot;:&quot;1040000000089442&quot;,&quot;name&quot;:&quot;ios&quot;},{&quot;id&quot;:&quot;1040000000089407&quot;,&quot;name&quot;:&quot;chrome&quot;},{&quot;id&quot;:&quot;1040000000089709&quot;,&quot;name&quot;:&quot;windows&quot;},{&quot;id&quot;:&quot;1040000000089498&quot;,&quot;name&quot;:&quot;iphone&quot;},{&quot;id&quot;:&quot;1040000000125504&quot;,&quot;name&quot;:&quot;internet-explorer&quot;},{&quot;id&quot;:&quot;1040000000090217&quot;,&quot;name&quot;:&quot;firefox&quot;},{&quot;id&quot;:&quot;1040000000089499&quot;,&quot;name&quot;:&quot;safari&quot;},{&quot;id&quot;:&quot;1040000000090638&quot;,&quot;name&quot;:&quot;ipad&quot;},{&quot;id&quot;:&quot;1040000000090218&quot;,&quot;name&quot;:&quot;opera&quot;},{&quot;id&quot;:&quot;1040000002871462&quot;,&quot;name&quot;:&quot;apple-watch&quot;}],&quot;\u5176\u5b83&quot;:[{&quot;id&quot;:&quot;1040000000089409&quot;,&quot;name&quot;:&quot;html5&quot;},{&quot;id&quot;:&quot;1040000002893277&quot;,&quot;name&quot;:&quot;react.js&quot;},{&quot;id&quot;:&quot;1040000000090137&quot;,&quot;name&quot;:&quot;\u641c\u7d22\u5f15\u64ce&quot;},{&quot;id&quot;:&quot;1040000000123810&quot;,&quot;name&quot;:&quot;virtualenv&quot;},{&quot;id&quot;:&quot;1040000000090316&quot;,&quot;name&quot;:&quot;lucene&quot;}]}" style="display: none;">
    <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="https://segmentfault.com/a/1190000006171396#开发语言" aria-controls="type" role="tab" data-toggle="tab">开发语言</a>
            </li>
                    <li role="presentation" class=""><a href="https://segmentfault.com/a/1190000006171396#平台框架" aria-controls="type" role="tab" data-toggle="tab">平台框架</a>
            </li>
                    <li role="presentation" class=""><a href="https://segmentfault.com/a/1190000006171396#服务器" aria-controls="type" role="tab" data-toggle="tab">服务器</a>
            </li>
                    <li role="presentation" class=""><a href="https://segmentfault.com/a/1190000006171396#数据库和缓存" aria-controls="type" role="tab" data-toggle="tab">数据库和缓存</a>
            </li>
                    <li role="presentation" class=""><a href="https://segmentfault.com/a/1190000006171396#开发工具" aria-controls="type" role="tab" data-toggle="tab">开发工具</a>
            </li>
                    <li role="presentation" class=""><a href="https://segmentfault.com/a/1190000006171396#系统设备" aria-controls="type" role="tab" data-toggle="tab">系统设备</a>
            </li>
                    <li role="presentation" class=""><a href="https://segmentfault.com/a/1190000006171396#其它" aria-controls="type" role="tab" data-toggle="tab">其它</a>
            </li>
            </ul>
    <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="开发语言">
                <ul class="taglist--inline">
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089436&quot;,&quot;name&quot;:&quot;javascript&quot;}" href="javascript: void(0);">javascript</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089387&quot;,&quot;name&quot;:&quot;php&quot;}" href="javascript: void(0);">php</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089434&quot;,&quot;name&quot;:&quot;css&quot;}" href="javascript: void(0);">css</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089571&quot;,&quot;name&quot;:&quot;html&quot;}" href="javascript: void(0);">html</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089449&quot;,&quot;name&quot;:&quot;java&quot;}" href="javascript: void(0);">java</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089534&quot;,&quot;name&quot;:&quot;python&quot;}" href="javascript: void(0);">python</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089409&quot;,&quot;name&quot;:&quot;html5&quot;}" href="javascript: void(0);">html5</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089918&quot;,&quot;name&quot;:&quot;node.js&quot;}" href="javascript: void(0);">node.js</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089741&quot;,&quot;name&quot;:&quot;c++&quot;}" href="javascript: void(0);">c++</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089457&quot;,&quot;name&quot;:&quot;c&quot;}" href="javascript: void(0);">c</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090209&quot;,&quot;name&quot;:&quot;objective-c&quot;}" href="javascript: void(0);">objective-c</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089669&quot;,&quot;name&quot;:&quot;shell&quot;}" href="javascript: void(0);">shell</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090203&quot;,&quot;name&quot;:&quot;golang&quot;}" href="javascript: void(0);">golang</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000531223&quot;,&quot;name&quot;:&quot;swift&quot;}" href="javascript: void(0);">swift</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089581&quot;,&quot;name&quot;:&quot;c#&quot;}" href="javascript: void(0);">c#</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089699&quot;,&quot;name&quot;:&quot;ruby&quot;}" href="javascript: void(0);">ruby</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089686&quot;,&quot;name&quot;:&quot;bash&quot;}" href="javascript: void(0);">bash</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000091262&quot;,&quot;name&quot;:&quot;sass&quot;}" href="javascript: void(0);">sass</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090433&quot;,&quot;name&quot;:&quot;asp.net&quot;}" href="javascript: void(0);">asp.net</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000365394&quot;,&quot;name&quot;:&quot;typescript&quot;}" href="javascript: void(0);">typescript</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090600&quot;,&quot;name&quot;:&quot;less&quot;}" href="javascript: void(0);">less</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090228&quot;,&quot;name&quot;:&quot;scala&quot;}" href="javascript: void(0);">scala</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090208&quot;,&quot;name&quot;:&quot;lua&quot;}" href="javascript: void(0);">lua</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000161068&quot;,&quot;name&quot;:&quot;coffeescript&quot;}" href="javascript: void(0);">coffeescript</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090194&quot;,&quot;name&quot;:&quot;actionscript&quot;}" href="javascript: void(0);">actionscript</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090201&quot;,&quot;name&quot;:&quot;erlang&quot;}" href="javascript: void(0);">erlang</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089698&quot;,&quot;name&quot;:&quot;perl&quot;}" href="javascript: void(0);">perl</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000311191&quot;,&quot;name&quot;:&quot;rust&quot;}" href="javascript: void(0);">rust</a>
                        </li>
                                    </ul>
            </div>
                    <div role="tabpanel" class="tab-pane " id="平台框架">
                <ul class="taglist--inline">
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000196640&quot;,&quot;name&quot;:&quot;laravel&quot;}" href="javascript: void(0);">laravel</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000125263&quot;,&quot;name&quot;:&quot;flask&quot;}" href="javascript: void(0);">flask</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089564&quot;,&quot;name&quot;:&quot;django&quot;}" href="javascript: void(0);">django</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090103&quot;,&quot;name&quot;:&quot;spring&quot;}" href="javascript: void(0);">spring</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000166256&quot;,&quot;name&quot;:&quot;express&quot;}" href="javascript: void(0);">express</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089646&quot;,&quot;name&quot;:&quot;ruby-on-rails&quot;}" href="javascript: void(0);">ruby-on-rails</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090398&quot;,&quot;name&quot;:&quot;yii&quot;}" href="javascript: void(0);">yii</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000116331&quot;,&quot;name&quot;:&quot;tornado&quot;}" href="javascript: void(0);">tornado</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000622042&quot;,&quot;name&quot;:&quot;koa&quot;}" href="javascript: void(0);">koa</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089638&quot;,&quot;name&quot;:&quot;struts&quot;}" href="javascript: void(0);">struts</a>
                        </li>
                                    </ul>
            </div>
                    <div role="tabpanel" class="tab-pane " id="服务器">
                <ul class="taglist--inline">
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089392&quot;,&quot;name&quot;:&quot;linux&quot;}" href="javascript: void(0);">linux</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090145&quot;,&quot;name&quot;:&quot;nginx&quot;}" href="javascript: void(0);">nginx</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089761&quot;,&quot;name&quot;:&quot;apache&quot;}" href="javascript: void(0);">apache</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000366352&quot;,&quot;name&quot;:&quot;docker&quot;}" href="javascript: void(0);">docker</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090245&quot;,&quot;name&quot;:&quot;ubuntu&quot;}" href="javascript: void(0);">ubuntu</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090249&quot;,&quot;name&quot;:&quot;centos&quot;}" href="javascript: void(0);">centos</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090401&quot;,&quot;name&quot;:&quot;\u7f13\u5b58&quot;}" href="javascript: void(0);">缓存</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090117&quot;,&quot;name&quot;:&quot;tomcat&quot;}" href="javascript: void(0);">tomcat</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090107&quot;,&quot;name&quot;:&quot;\u8d1f\u8f7d\u5747\u8861&quot;}" href="javascript: void(0);">负载均衡</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090646&quot;,&quot;name&quot;:&quot;unix&quot;}" href="javascript: void(0);">unix</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089648&quot;,&quot;name&quot;:&quot;hadoop&quot;}" href="javascript: void(0);">hadoop</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090609&quot;,&quot;name&quot;:&quot;windows-server&quot;}" href="javascript: void(0);">windows-server</a>
                        </li>
                                    </ul>
            </div>
                    <div role="tabpanel" class="tab-pane " id="数据库和缓存">
                <ul class="taglist--inline">
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089439&quot;,&quot;name&quot;:&quot;mysql&quot;}" href="javascript: void(0);">mysql</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090049&quot;,&quot;name&quot;:&quot;sql&quot;}" href="javascript: void(0);">sql</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089431&quot;,&quot;name&quot;:&quot;redis&quot;}" href="javascript: void(0);">redis</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089488&quot;,&quot;name&quot;:&quot;mongodb&quot;}" href="javascript: void(0);">mongodb</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090701&quot;,&quot;name&quot;:&quot;oracle&quot;}" href="javascript: void(0);">oracle</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089432&quot;,&quot;name&quot;:&quot;nosql&quot;}" href="javascript: void(0);">nosql</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089873&quot;,&quot;name&quot;:&quot;memcached&quot;}" href="javascript: void(0);">memcached</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090424&quot;,&quot;name&quot;:&quot;sqlserver&quot;}" href="javascript: void(0);">sqlserver</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090354&quot;,&quot;name&quot;:&quot;sqlite&quot;}" href="javascript: void(0);">sqlite</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090861&quot;,&quot;name&quot;:&quot;postgresql&quot;}" href="javascript: void(0);">postgresql</a>
                        </li>
                                    </ul>
            </div>
                    <div role="tabpanel" class="tab-pane " id="开发工具">
                <ul class="taglist--inline">
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089459&quot;,&quot;name&quot;:&quot;git&quot;}" href="javascript: void(0);">git</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000091226&quot;,&quot;name&quot;:&quot;github&quot;}" href="javascript: void(0);">github</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089467&quot;,&quot;name&quot;:&quot;vim&quot;}" href="javascript: void(0);">vim</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089579&quot;,&quot;name&quot;:&quot;xcode&quot;}" href="javascript: void(0);">xcode</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000126097&quot;,&quot;name&quot;:&quot;sublime-text&quot;}" href="javascript: void(0);">sublime-text</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089509&quot;,&quot;name&quot;:&quot;eclipse&quot;}" href="javascript: void(0);">eclipse</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090560&quot;,&quot;name&quot;:&quot;intellij-idea&quot;}" href="javascript: void(0);">intellij-idea</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089447&quot;,&quot;name&quot;:&quot;svn&quot;}" href="javascript: void(0);">svn</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000002720957&quot;,&quot;name&quot;:&quot;visual-studio-code&quot;}" href="javascript: void(0);">visual-studio-code</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090186&quot;,&quot;name&quot;:&quot;maven&quot;}" href="javascript: void(0);">maven</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090473&quot;,&quot;name&quot;:&quot;ide&quot;}" href="javascript: void(0);">ide</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090524&quot;,&quot;name&quot;:&quot;atom&quot;}" href="javascript: void(0);">atom</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090231&quot;,&quot;name&quot;:&quot;visual-studio&quot;}" href="javascript: void(0);">visual-studio</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090216&quot;,&quot;name&quot;:&quot;emacs&quot;}" href="javascript: void(0);">emacs</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000183694&quot;,&quot;name&quot;:&quot;hg&quot;}" href="javascript: void(0);">hg</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089663&quot;,&quot;name&quot;:&quot;textmate&quot;}" href="javascript: void(0);">textmate</a>
                        </li>
                                    </ul>
            </div>
                    <div role="tabpanel" class="tab-pane " id="系统设备">
                <ul class="taglist--inline">
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089658&quot;,&quot;name&quot;:&quot;android&quot;}" href="javascript: void(0);">android</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089442&quot;,&quot;name&quot;:&quot;ios&quot;}" href="javascript: void(0);">ios</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089407&quot;,&quot;name&quot;:&quot;chrome&quot;}" href="javascript: void(0);">chrome</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089709&quot;,&quot;name&quot;:&quot;windows&quot;}" href="javascript: void(0);">windows</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089498&quot;,&quot;name&quot;:&quot;iphone&quot;}" href="javascript: void(0);">iphone</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000125504&quot;,&quot;name&quot;:&quot;internet-explorer&quot;}" href="javascript: void(0);">internet-explorer</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090217&quot;,&quot;name&quot;:&quot;firefox&quot;}" href="javascript: void(0);">firefox</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089499&quot;,&quot;name&quot;:&quot;safari&quot;}" href="javascript: void(0);">safari</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090638&quot;,&quot;name&quot;:&quot;ipad&quot;}" href="javascript: void(0);">ipad</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090218&quot;,&quot;name&quot;:&quot;opera&quot;}" href="javascript: void(0);">opera</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000002871462&quot;,&quot;name&quot;:&quot;apple-watch&quot;}" href="javascript: void(0);">apple-watch</a>
                        </li>
                                    </ul>
            </div>
                    <div role="tabpanel" class="tab-pane " id="其它">
                <ul class="taglist--inline">
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000089409&quot;,&quot;name&quot;:&quot;html5&quot;}" href="javascript: void(0);">html5</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000002893277&quot;,&quot;name&quot;:&quot;react.js&quot;}" href="javascript: void(0);">react.js</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090137&quot;,&quot;name&quot;:&quot;\u641c\u7d22\u5f15\u64ce&quot;}" href="javascript: void(0);">搜索引擎</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000123810&quot;,&quot;name&quot;:&quot;virtualenv&quot;}" href="javascript: void(0);">virtualenv</a>
                        </li>
                                            <li class="mb5">
                            <a class="tag" data-tag="{&quot;id&quot;:&quot;1040000000090316&quot;,&quot;name&quot;:&quot;lucene&quot;}" href="javascript: void(0);">lucene</a>
                        </li>
                                    </ul>
            </div>
            </div>
</div>

                                </div>
                               
                            </form>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-4 hidden-xs">
                        <ul class="post-topheader__side list-unstyled">
                            <li>
                                                                    <button type="button" class="btn btn-success btn-sm " data-id="1190000006171396" id="sideLike"><i class="fa fa-caret-up fa-lg" aria-hidden="true"></i>
                                            &nbsp;&nbsp;<span class="seprator">|</span>&nbsp;&nbsp;
                                            <span id="sideLikeNum">2</span>
                                    </button>
                                                                                                    <button type="button" id="sideBookmark" class="btn btn-default btn-sm " data-id="1190000006171396" data-type="article">
                                            <span id="sideBookmarkText">收藏</span>&nbsp;&nbsp;<span class="seprator">|</span>&nbsp;&nbsp;<span id="sideBookmarkNum">7</span>
                                    </button>
                                                            </li>
                            <li>
                                <strong class="no-stress">2k</strong> 次浏览
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- end .post-topheader -->

    <div class="container mt30">
        <div class="row">
            <div class="col-xs-12 col-md-9 main ">

                
                <div class="article fmt article__content" data-id="1190000006171396" data-license="nd">
                    
<p>转载一篇我之前发在csdn上的博客。</p>
<h2 id="articleHeader0">自问自答的两个问题</h2>
<p>在我们去讨论Handler，Looper，MessageQueue的关系之前，我们需要先问两个问题：</p>
<ol>
<li><p><strong>这一套东西搞出来是为了解决什么问题呢？</strong></p></li>
<li><p><strong>如果让我们来解决这个问题该怎么做？</strong></p></li>
</ol>
<p>以上者两个问题，是我最近总结出来的，在我们学习了解一个新的技术之前，最好是先能回答这两个问题，这样你才能对你正在学习的东西有更深刻的认识。</p>
<p>第一个问题：google的程序员们搞出这一套东西是为了解决什么问题的？这个问题很显而易见，为了解决线程间通信的问题。我们都知道，Android的UI/View这一套系统是运行在主线程的，并且这个主线程是死循环的，来看看具体的证据吧。</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public final class ActivityThread {
    public static void main(String[] args) {
        
        //...
        
        Looper.loop();

        throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActivityThread</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        
        <span class="hljs-comment">//...</span>
        
        Looper.loop();

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Main thread loop unexpectedly exited"</span>);
    }
}</code></pre>
<p>如上面的代码示例所示，<code>ActivityThread.main()</code>方法作为Android程序的入口，里面我省略了一些初始化的操作，然后就执行了一句<code>Looper.loop()</code>方法，就没了，再下一行就抛异常了。</p>
<p><code>loop()</code>方法里面实际上就是一个死循环，一直在执行着，不断的从一个MQ（MessageQueue，后面我都缩写成MQ了）去取消息，如果有的话，那么就执行它或者让它的发送者去处理它。</p>
<p>一般来说，主线程循环中都是执行着一些快速的UI操作，当你有手touch屏幕的时候，系统会产生事件，UI会处理这些事件，这些事件都会在主线程中执行，并快速的响应着UI的变化。如果主线程上发生一些比较耗时的操作，那么它后面的方法就无法得到执行了，那么就会出现卡顿，不流畅。</p>
<p>因此，<strong>Android并不希望你在主线程去做一些耗时的操作</strong>，这里对“耗时”二字进行朴素的理解就行了，就是执行起来需要消耗的时间比较多的操作。比如读写文件，小的文件也许很快，但你无法预料文件的大小，再比如访问网络，再比如你需要做一些复杂的计算等等。</p>
<p>为了不阻碍主线程流畅的执行，我们就必须在需要的时候把耗时的操作放到其他线程上去，当其他线程完成了工作，再给一个通知（或许还带着数据）给到主线程，让主线程去更新UI什么的，当然了，如果你要的耗时操作只是默默无闻的完成就行了，并不需要通知UI，那么你完全不需要给通知给到UI线程。这就是<strong>线程间的通信</strong>，其他线程做耗时操作，完成了告诉UI线程，让它进行更新。为了解决这个问题，Android系统给我们提供了这样一套方案来解决。</p>
<p>第二个问题：如果让我们来想一套方案来解决这个线程间通信的问题，该怎么做呢？</p>
<p>先看看我们现在已经有的东西，我们有一个一直在循环的主线程，它实现起来大概是这个样子：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public class OurSystem {
    public static void main(String [] args) {
        for (;;) {
            //do something...
        }
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OurSystem</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String [] args)</span> </span>{
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-comment">//do something...</span>
        }
    }
}</code></pre>
<blockquote>
<p>为什么主线程要一直死循环的执行呢？</p>
<p>关于这一点，我个人并没有特别透彻的认知，但我猜测，对于有GUI的系统/程序，应该都有一个不断循环的主线程，因为这个GUI程序肯定是要跟人进行交互的，也就是说，需要等待用户的输入，比如触碰屏幕，动动鼠标，敲敲键盘什么的，这些事件肯定是硬件层先获得一个响应/信号，然后会不断的向上封装传递。</p>
<p>如果说我们一碰屏幕，一碰鼠标，就开启一个新线程去处理UI上的变化，首先，这当然是可以的！UI在什么线程上更新其实都是可以的嘛，并不是说一定要在主线程上更新，这是系统给我设的一个套子。然后，问题也会复杂的多，如果我们快速的点击2下鼠标，那么一瞬间就开启了两个新线程去执行，那么这两个线程的执行顺序呢？两个独立的线程，我们是无法保证说先启动的先执行。</p>
<p>所以第一个问题就是执行顺序的问题。</p>
<p>第二个问题就是同步，几个相互独立的线程如果要处理同一个资源，那么造成的结果都是令人困惑，不受控制的。另一方面强行给所有的操作加上同步锁，在效率上也会有问题。</p>
<p>为了解决顺序执行的问题，非常容易就想到的一种方案是事件队列，各种各样的事件先进入到一个队列中，然后有个东西会不断的从队列中获取，这样第一个事件一定在第二个事件之前被执行，这样就保证了顺序，如果我们把这个“取事件”的步骤放在一个线程中去做，那么也顺便解决了资源同步的问题。</p>
<p>因此，对于GUI程序会有一个一直循环的（主）线程，可能就是这样来的吧。</p>
</blockquote>
<p>这是一个非常纯净的死循环，我们想要做一些事情的话，就得让它从一个队列里面获取一些事情来做，就像打印机一样。因此我们再编写一个消息队列类，来存放消息。消息队列看起来应该是这样：</p>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public class OurMessageQueue() {
    private LinkedList&lt;Message&gt; mQueue = new LinkedList&lt;Message&gt;();
    
    // 放进去一条消息
    public void enQueue() {
        //...
    }
    
    // 取出一条消息
    public Message deQueue() {
        //...
    }
    
    // 判断是否为空队列
    public boolean isEmpty() {
        //...
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">public</span> class <span class="hljs-title">OurMessageQueue</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">private</span> LinkedList&lt;Message&gt; mQueue = <span class="hljs-keyword">new</span> LinkedList&lt;Message&gt;();
    
    <span class="hljs-comment">// 放进去一条消息</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">enQueue</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">//...</span>
    }
    
    <span class="hljs-comment">// 取出一条消息</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Message <span class="hljs-title">deQueue</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">//...</span>
    }
    
    <span class="hljs-comment">// 判断是否为空队列</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">//...</span>
    }
}</code></pre>
<p>接下来我们的循环就需要改造成能从消息队列里获取消息，并能够根据消息来做些事情了：</p>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public class OurSystem {
    public static void main(String [] args) {
        
        // 初始化消息队列
        OurMessageQueue mq = ...
    
        for (;;) {
            if (!mq.isEmpty()) {
                Message msg = mq.deQueue();
                //do something...
            }
        }
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OurSystem</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String [] args)</span> </span>{
        
        <span class="hljs-comment">// 初始化消息队列</span>
        OurMessageQueue mq = ...
    
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-keyword">if</span> (!mq.isEmpty()) {
                Message msg = mq.deQueue();
                <span class="hljs-comment">//do something...</span>
            }
        }
    }
}</code></pre>
<p>现在我们假象一下，我们需要点击一下按钮，然后去下载一个超级大的文件，下载完成后，我们再让主线程显示文件的大小。</p>
<p>首先，按一下按钮，这个事件应该会被触发到主线程来（具体怎么来的我还尚不清楚，但应该是先从硬件开始，然后插入到消息队列中，主线程的循环就能获取到了），然后主线程开启一个新的异步线程来进行下载，下载完成后再通知主线程来更新，代码看上去是这样的：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// 脑补的硬件设备……
public class OurDevice {
    
    // 硬件设备可能有一个回调
    public void onClick() {
    
        // 先拿到同一个消息队列，并把我们要做的事情插入队列中
        OurMessageQueue mq = ...
        Message msg = Message.newInstance(&quot;download a big file&quot;);
        mq.enQueue(msg);
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-comment">// 脑补的硬件设备……</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OurDevice</span> </span>{
    
    <span class="hljs-comment">// 硬件设备可能有一个回调</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">()</span> </span>{
    
        <span class="hljs-comment">// 先拿到同一个消息队列，并把我们要做的事情插入队列中</span>
        OurMessageQueue mq = ...
        Message msg = Message.newInstance(<span class="hljs-string">"download a big file"</span>);
        mq.enQueue(msg);
    }
}</code></pre>
<p>然后，我们的主线程循环获取到了消息：</p>
<div class="widget-codetool" style="display: block;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public class OurSystem {
    public static void main(String [] args) {
        
        // 初始化消息队列
        OurMessageQueue mq = ...
    
        for (;;) {
            if (!mq.isEmpty()) {
                Message msg = mq.deQueue();
                
                // 是一条通知我们下载文件的消息
                if (msg.isDownloadBigFile()) {
                
                    // 开启新线程去下载文件
                    new Thread(new Runnable() {
                        void run() {
                            // download a big file, may cast 1 min...
                            // ...
                            // ok, we finished download task.
                            
                            // 获取到同一个消息队列
                            OurMessageQueue mq = ...
                            
                            // 消息入队
                            mq.enQueue(Message.newInstance(&quot;finished download&quot;));
                        }
                    }).start();
                }
                
                // 是一条通知我们下载完成的消息
                if (msg.isFilishedDownload()) {
                    // update UI!
                }
            }
        }
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OurSystem</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String [] args)</span> </span>{
        
        <span class="hljs-comment">// 初始化消息队列</span>
        OurMessageQueue mq = ...
    
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-keyword">if</span> (!mq.isEmpty()) {
                Message msg = mq.deQueue();
                
                <span class="hljs-comment">// 是一条通知我们下载文件的消息</span>
                <span class="hljs-keyword">if</span> (msg.isDownloadBigFile()) {
                
                    <span class="hljs-comment">// 开启新线程去下载文件</span>
                    <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() {
                        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
                            <span class="hljs-comment">// download a big file, may cast 1 min...</span>
                            <span class="hljs-comment">// ...</span>
                            <span class="hljs-comment">// ok, we finished download task.</span>
                            
                            <span class="hljs-comment">// 获取到同一个消息队列</span>
                            OurMessageQueue mq = ...
                            
                            <span class="hljs-comment">// 消息入队</span>
                            mq.enQueue(Message.newInstance(<span class="hljs-string">"finished download"</span>));
                        }
                    }).start();
                }
                
                <span class="hljs-comment">// 是一条通知我们下载完成的消息</span>
                <span class="hljs-keyword">if</span> (msg.isFilishedDownload()) {
                    <span class="hljs-comment">// update UI!</span>
                }
            }
        }
    }
}</code></pre>
<p>注意，主线程循环获取到消息的时候，显示对消息进行的判断分类，不同的消息应该有不同的处理。在我们获取到一个下载文件的消息时，开启了一个新的线程去执行，耗时操作与主线程就被隔离到不同的执行流中，当完成后，新线程中用同一个消息队列发送了一个通知下载完成的消息，主线程循环获取到后，里面就可以更新UI。</p>
<p>这样就是一个我随意脑补的，简单的跨线程通信的方案。</p>
<p>有如下几点是值得注意的：</p>
<ul>
<li><p>主线程是死循环的从消息队列中获取消息。</p></li>
<li><p>我们要将消息发送到主线程的消息队列，我们需要通过某种方法能获取到主线程的消息队列对象</p></li>
<li><p>消息（Message）的结构应该如何设计呢？</p></li>
</ul>
<h2 id="articleHeader1">Android 中的线程间通信方案</h2>
<h3 id="articleHeader2">Looper</h3>
<blockquote><p><a href="http://www.grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/android/os/Looper.java#Looper" target="_blank">android.os.Looper from Grepcode</a></p></blockquote>
<p>Android中有一个<code>Looper</code>对象，顾名思义，直译过来就是循环的意思，<code>Looper</code>也确实干了维持循环的事情。</p>
<p>Looper的代码是非常简单的，去掉注释也就300多行。在官方文档的注释中，它推荐我们这样来使用它：</p>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="class LooperThread extends Thread {
    public Handler mHandler;

    public void run() {
        Looper.prepare();

        mHandler = new Handler() {
            public void handleMessage(Message msg) {
              // process incoming messages here
            }
        };

        Looper.loop();
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LooperThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span> </span>{
    <span class="hljs-keyword">public</span> Handler mHandler;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        Looper.prepare();

        mHandler = <span class="hljs-keyword">new</span> Handler() {
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span> </span>{
              <span class="hljs-comment">// process incoming messages here</span>
            }
        };

        Looper.loop();
    }
}</code></pre>
<p>先来看看prepare方法干了什么。</p>
<h4><code>Looper.prepare()</code></h4>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public static void prepare() {
    prepare(true);
}

private static void prepare(boolean quitAllowed) {
    if (sThreadLocal.get() != null) {
        throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);
    }
    sThreadLocal.set(new Looper(quitAllowed));
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepare</span><span class="hljs-params">()</span> </span>{
    prepare(<span class="hljs-keyword">true</span>);
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepare</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> quitAllowed)</span> </span>{
    <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Only one Looper may be created per thread"</span>);
    }
    sThreadLocal.set(<span class="hljs-keyword">new</span> Looper(quitAllowed));
}</code></pre>
<p>注意<code>prepare(boolean)</code>方法中，有一个<code>sThreadLocal</code>变量，这个变量有点像一个哈希表，它的key是当前的线程，也就是说，它可以存储一些数据/引用，这些数据/引用是与当前线程是一一对应的，在这里的作用是，它判断一下当前线程是否有<code>Looper</code>这个对象，如果有，那么就报错了，"Only one Looper may be created per thread"，一个线程只允许创建一个<code>Looper</code>，如果没有，就new一个新的塞进这个哈希表中。然后它调用了<code>Looper</code>的构造方法。</p>
<h4>Looper 的构造方法</h4>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="private Looper(boolean quitAllowed) {
    mQueue = new MessageQueue(quitAllowed);
    mThread = Thread.currentThread();
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Looper</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> quitAllowed)</span> </span>{
    mQueue = <span class="hljs-keyword">new</span> MessageQueue(quitAllowed);
    mThread = Thread.currentThread();
}</code></pre>
<p>在<code>Looper</code>的构造方法中，很关键的一句，它new了一个<code>MessageQueue</code>对象，并自己维持了这个MQ的引用。</p>
<p>此时<code>prepare()</code>方法的工作就结束了，接下来需要调用静态方法<code>loop()</code>来启动循环。</p>
<h4><code>Looper.loop()</code></h4>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public static void loop() {
    final Looper me = myLooper();
    if (me == null) {
        throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn&#39;t called on this thread.&quot;);
    }
    final MessageQueue queue = me.mQueue;

    for (;;) {
        Message msg = queue.next(); // might block
        if (msg == null) {
            // No message indicates that the message queue is quitting.
            return;
        }

        msg.target.dispatchMessage(msg);

        //...
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">final</span> Looper me = myLooper();
    <span class="hljs-keyword">if</span> (me == <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);
    }
    <span class="hljs-keyword">final</span> MessageQueue queue = me.mQueue;

    <span class="hljs-keyword">for</span> (;;) {
        Message msg = queue.next(); <span class="hljs-comment">// might block</span>
        <span class="hljs-keyword">if</span> (msg == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// No message indicates that the message queue is quitting.</span>
            <span class="hljs-keyword">return</span>;
        }

        msg.target.dispatchMessage(msg);

        <span class="hljs-comment">//...</span>
    }
}</code></pre>
<p>loop()方法，我做了省略，省去了一些不关心的部分。剩下的部分非常的清楚了，首先调用了静态方法myLooper()获取一个Looper对象。</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public static Looper myLooper() {
    return sThreadLocal.get();
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Looper <span class="hljs-title">myLooper</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> sThreadLocal.get();
}</code></pre>
<p><code>myLooper()</code>同样是静态方法，它是直接从这个<code>ThreadLocal</code>中去获取，这个刚刚说过了，它就类似于一个哈希表，key是当前线程，因为刚刚<code>prepare()</code>的时候，已经往里面set了一个<code>Looper</code>，那么此时应该是可以get到的。拿到当前线程的<code>Looper</code>后，接下来，<code>final MessageQueue queue = me.mQueue;</code>拿到与这个<code>Looper</code>对应的MQ，拿到了MQ后，就开启了死循环，对消息队列进行不停的获取，当获取到一个消息后，它调用了<code>Message.target.dispatchMessage()</code>方法来对消息进行处理。</p>
<p>Looper的代码看完了，我们得到了几个信息：</p>
<ul>
<li><p><code>Looper</code>调用静态方法<code>prepare()</code>来进行初始化，一个线程只能创建一个与之对应的<code>Looper</code>，<code>Looper</code>初始化的时候会创建一个MQ，因此，有了这样的对应关系，一个线程对应一个<code>Looper</code>，一个<code>Looper</code>对应一个MQ。可以说，它们三个是在一条线上的。</p></li>
<li><p><code>Looper</code>调用静态方法<code>loop()</code>开始无限循环的取消息，MQ调用<code>next()</code>方法来获取消息</p></li>
</ul>
<h3 id="articleHeader3">MessageQueue</h3>
<blockquote><p><a href="http://www.grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/android/os/MessageQueue.java#MessageQueue" target="_blank">android.os.MessageQueue from Grepcode</a></p></blockquote>
<p>对于MQ的源码，简单的看一下，构造函数与<code>next()</code>方法就好了。</p>
<h4>MQ的构造方法</h4>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="MessageQueue(boolean quitAllowed) {
    mQuitAllowed = quitAllowed;
    mPtr = nativeInit();
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java">MessageQueue(<span class="hljs-keyword">boolean</span> quitAllowed) {
    mQuitAllowed = quitAllowed;
    mPtr = nativeInit();
}</code></pre>
<p>MQ的构造方法简单的调用了nativeInit()来进行初始化，这是一个jni方法，也就是说，可能是在JNI层维持了它这个消息队列的对象。</p>
<h4><code>MessageQueue.next()</code></h4>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="Message next() {
    
    final long ptr = mPtr;
    if (ptr == 0) {
        return null;
    }

    int nextPollTimeoutMillis = 0;
    for (;;) {
        if (nextPollTimeoutMillis != 0) {
            Binder.flushPendingCommands();
        }

        nativePollOnce(ptr, nextPollTimeoutMillis);

        synchronized (this) {
            // Try to retrieve the next message.  Return if found.
            final long now = SystemClock.uptimeMillis();
            Message prevMsg = null;
            Message msg = mMessages;
            if (msg != null &amp;&amp; msg.target == null) {
                // Stalled by a barrier.  Find the next asynchronous message in the queue.
                do {
                    prevMsg = msg;
                    msg = msg.next;
                } while (msg != null &amp;&amp; !msg.isAsynchronous());
            }
            if (msg != null) {
                if (now &lt; msg.when) {
                    // Next message is not ready.  Set a timeout to wake up when it is ready.
                    nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE);
                } else {
                    // Got a message.
                    mBlocked = false;
                    if (prevMsg != null) {
                        prevMsg.next = msg.next;
                    } else {
                        mMessages = msg.next;
                    }
                    msg.next = null;
                    if (false) Log.v(&quot;MessageQueue&quot;, &quot;Returning message: &quot; + msg);
                    return msg;
                }
            } else {
                // No more messages.
                nextPollTimeoutMillis = -1;
            }
        }

    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function">Message <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>{
    
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> ptr = mPtr;
    <span class="hljs-keyword">if</span> (ptr == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-keyword">int</span> nextPollTimeoutMillis = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-keyword">if</span> (nextPollTimeoutMillis != <span class="hljs-number">0</span>) {
            Binder.flushPendingCommands();
        }

        nativePollOnce(ptr, nextPollTimeoutMillis);

        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) {
            <span class="hljs-comment">// Try to retrieve the next message.  Return if found.</span>
            <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> now = SystemClock.uptimeMillis();
            Message prevMsg = <span class="hljs-keyword">null</span>;
            Message msg = mMessages;
            <span class="hljs-keyword">if</span> (msg != <span class="hljs-keyword">null</span> &amp;&amp; msg.target == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span>
                <span class="hljs-keyword">do</span> {
                    prevMsg = msg;
                    msg = msg.next;
                } <span class="hljs-keyword">while</span> (msg != <span class="hljs-keyword">null</span> &amp;&amp; !msg.isAsynchronous());
            }
            <span class="hljs-keyword">if</span> (msg != <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">if</span> (now &lt; msg.when) {
                    <span class="hljs-comment">// Next message is not ready.  Set a timeout to wake up when it is ready.</span>
                    nextPollTimeoutMillis = (<span class="hljs-keyword">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// Got a message.</span>
                    mBlocked = <span class="hljs-keyword">false</span>;
                    <span class="hljs-keyword">if</span> (prevMsg != <span class="hljs-keyword">null</span>) {
                        prevMsg.next = msg.next;
                    } <span class="hljs-keyword">else</span> {
                        mMessages = msg.next;
                    }
                    msg.next = <span class="hljs-keyword">null</span>;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span>) Log.v(<span class="hljs-string">"MessageQueue"</span>, <span class="hljs-string">"Returning message: "</span> + msg);
                    <span class="hljs-keyword">return</span> msg;
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// No more messages.</span>
                nextPollTimeoutMillis = -<span class="hljs-number">1</span>;
            }
        }

    }
}</code></pre>
<p><code>next()</code>方法的代码有些长，我作了一些省略，请注意到，这个方法也有一个死循环，这样做的效果就是，在<code>Looper</code>的死循环中，调用了<code>next()</code>，而<code>next()</code>这里也在死循环，表面上看起来，方法就阻塞在<code>Looper</code>的死循环中的那一行了，知道<code>next()</code>方法能返回一个<code>Message</code>对象出来。</p>
<p>简单浏览MQ的代码，我们得到了这些信息：</p>
<ul>
<li><p>MQ的初始化是交给JNI去做的</p></li>
<li><p>MQ的<code>next()</code>方法是个死循环，在不停的访问MQ，从中获取消息出来返回给<code>Looper</code>去处理。</p></li>
</ul>
<h3 id="articleHeader4">Message</h3>
<blockquote><p><a href="http://www.grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/android/os/Message.java#Message" target="_blank">android.os.Message from Grepcode</a></p></blockquote>
<p><code>Message</code>对象是MQ中队列的element，也是<code>Handler</code>发送，接收处理的一个对象。对于它，我们需要了解它的几个成员属性即可。</p>
<p><code>Message</code>的成员变量可以分为三个部分：</p>
<ul>
<li><p>数据部分：它包括<code>what(int)</code>, <code>arg1(int)</code>, <code>arg2(int)</code>, <code>obj(Object)</code>, <code>data(Bundle)</code>等，一般用这些来传递数据。</p></li>
<li><p>发送者（target）：它有一个成员变量叫<code>target</code>，它的类型是<code>Handler</code>的，这个成员变量很重要，它标记了这个<code>Message</code>对象本身是谁发送的，最终也会交给谁去处理。</p></li>
<li><p>callback：它有一个成员变量叫<code>callback</code>，它的类型是<code>Runnable</code>，可以理解为一个可以被执行的代码片段。</p></li>
</ul>
<h3 id="articleHeader5">Handler</h3>
<blockquote><p><a href="http://www.grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/android/os/Handler.java#Handler" target="_blank">android.os.Handler from Grepcode</a></p></blockquote>
<p><code>Handler</code>对象是在API层面供给开发者使用最多的一个类，我们主要通过这个类来进行发送消息与处理消息。</p>
<h4>Handler的构造方法（初始化）</h4>
<p>通常我们调用没有参数的构造方法来进行初始化，使用起来大概是这样的：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="Handler mHandler = new Handler() {
    handleMessage(Message msg) {
        //...
    }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java">Handler mHandler = <span class="hljs-keyword">new</span> Handler() {
    handleMessage(Message msg) {
        <span class="hljs-comment">//...</span>
    }
}</code></pre>
<p>没有参数的构造方法最终调用了一个两个参数的构造方法，它的部分源码如下：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public Handler(Callback callback, boolean async) {
    //...
    mLooper = Looper.myLooper();
    if (mLooper == null) {
        throw new RuntimeException(
            &quot;Can&#39;t create handler inside thread that has not called Looper.prepare()&quot;);
    }
    mQueue = mLooper.mQueue;
    mCallback = callback;
    mAsynchronous = async;
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Handler</span><span class="hljs-params">(Callback callback, <span class="hljs-keyword">boolean</span> async)</span> </span>{
    <span class="hljs-comment">//...</span>
    mLooper = Looper.myLooper();
    <span class="hljs-keyword">if</span> (mLooper == <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
            <span class="hljs-string">"Can't create handler inside thread that has not called Looper.prepare()"</span>);
    }
    mQueue = mLooper.mQueue;
    mCallback = callback;
    mAsynchronous = async;
}</code></pre>
<p>注意到，它对<code>mLooper</code>成员变量进行了赋值，通过<code>Looper.myLooper()</code>方法获取到当前线程对应的<code>Looper</code>对象。上面已经提到过，如果<code>Looper</code>调用过<code>prepare()</code>方法，那么这个线程对应了一个<code>Looper</code>实例，这个<code>Looper</code>实例也对应了一个MQ，它们三者之间是一一对应的关系。</p>
<p>然后它通过<code>mLooper</code>对象，获取了一个MQ，存在自己的<code>mQueue</code>成员变量中。</p>
<p><code>Handler</code>的初始化代码说明了一点，<code>Handler</code>所初始化的地方（所在的线程），就是从将这个线程对应的<code>Looper</code>的引用赋值给<code>Handler</code>，让<code>Handler</code>也持有</p>
<p>对于主线程来说，我们在主线程的执行流中，new一个<code>Handler</code>对象，Handler对象都是持有主线程的<code>Looper</code>（也就是<code>Main Looper</code>）对象的。</p>
<p>同样的，如果我们在一个新线程，不调用<code>Looper.prepare()</code>方法去启动一个<code>Looper</code>，直接new一个<code>Handler</code>对象，那么它就会报错。像这样</p>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="new Thread(new Runnable() {
        @Override
        public void run() {
            //Looper.prepare(); 

            //因为Looper没有初始化，所以Looper.myLooper()不能获取到一个Looper对象
            Handler h = new Handler();
            h.sendEmptyMessage(112);

        }
     }).start();" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-comment">//Looper.prepare(); </span>

            <span class="hljs-comment">//因为Looper没有初始化，所以Looper.myLooper()不能获取到一个Looper对象</span>
            Handler h = <span class="hljs-keyword">new</span> Handler();
            h.sendEmptyMessage(<span class="hljs-number">112</span>);

        }
     }).start();</code></pre>
<p>以上代码运行后会报错：</p>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="java.lang.RuntimeException: Can&#39;t create handler inside thread that has not called Looper.prepare()" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs sql"><code style="word-break: break-word; white-space: initial;">java.lang.RuntimeException: Can't <span class="hljs-keyword">create</span> <span class="hljs-keyword">handler</span> inside <span class="hljs-keyword">thread</span> that has <span class="hljs-keyword">not</span> called Looper.prepare()</code></pre>
<p><strong>小结</strong>：<code>Handler</code>的初始化会获取到当前线程的<code>Looper</code>对象，并通过<code>Looper</code>拿到对应的MQ对象，如果当前线程的执行流并没有执行过<code>Looper.prepare()</code>，则无法创建Handler对象</p>
<h4><code>Handler.sendMessage()</code></h4>
<p><code>sendMessage</code>消息有各种各样的形式或重载，最终会调用到这个方法：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public boolean sendMessageAtTime(Message msg, long uptimeMillis) {
    MessageQueue queue = mQueue;
    if (queue == null) {
        RuntimeException e = new RuntimeException(
                this + &quot; sendMessageAtTime() called with no mQueue&quot;);
        Log.w(&quot;Looper&quot;, e.getMessage(), e);
        return false;
    }
    return enqueueMessage(queue, msg, uptimeMillis);
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">sendMessageAtTime</span><span class="hljs-params">(Message msg, <span class="hljs-keyword">long</span> uptimeMillis)</span> </span>{
    MessageQueue queue = mQueue;
    <span class="hljs-keyword">if</span> (queue == <span class="hljs-keyword">null</span>) {
        RuntimeException e = <span class="hljs-keyword">new</span> RuntimeException(
                <span class="hljs-keyword">this</span> + <span class="hljs-string">" sendMessageAtTime() called with no mQueue"</span>);
        Log.w(<span class="hljs-string">"Looper"</span>, e.getMessage(), e);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }
    <span class="hljs-keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);
}</code></pre>
<p>它又调用了<code>enqueueMessage</code>方法：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {
    msg.target = this;
    if (mAsynchronous) {
        msg.setAsynchronous(true);
    }
    return queue.enqueueMessage(msg, uptimeMillis);
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">enqueueMessage</span><span class="hljs-params">(MessageQueue queue, Message msg, <span class="hljs-keyword">long</span> uptimeMillis)</span> </span>{
    msg.target = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">if</span> (mAsynchronous) {
        msg.setAsynchronous(<span class="hljs-keyword">true</span>);
    }
    <span class="hljs-keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);
}</code></pre>
<p>注意到它对<code>Message</code>的<code>target</code>属性进行了赋值，这样这条消息就知道自己是被谁发送的了。然后将消息加入到队列中。</p>
<h4><code>Handler.dispatchMessage()</code></h4>
<p><code>Message</code>对象进入了MQ后，很快的会被MQ的<code>next()</code>方法获取到，这样<code>Looper</code>的死循环中就能得到一个<code>Message</code>对象，回顾一下，接下来，就调用了<code>Message.target.dispatchMessage()</code>方法对这条消息进行了处理。</p>
<div class="widget-codetool" style="display: none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="public void dispatchMessage(Message msg) {
    if (msg.callback != null) {
        handleCallback(msg);
    } else {
        if (mCallback != null) {
            if (mCallback.handleMessage(msg)) {
                return;
            }
        }
        handleMessage(msg);
    }
}

private static void handleCallback(Message message) {
    message.callback.run();
}

public void handleMessage(Message msg) {
    //这个方法是空实现，让客户端程序员去覆写实现自己的逻辑
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre><code class="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dispatchMessage</span><span class="hljs-params">(Message msg)</span> </span>{
    <span class="hljs-keyword">if</span> (msg.callback != <span class="hljs-keyword">null</span>) {
        handleCallback(msg);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">if</span> (mCallback.handleMessage(msg)) {
                <span class="hljs-keyword">return</span>;
            }
        }
        handleMessage(msg);
    }
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleCallback</span><span class="hljs-params">(Message message)</span> </span>{
    message.callback.run();
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span> </span>{
    <span class="hljs-comment">//这个方法是空实现，让客户端程序员去覆写实现自己的逻辑</span>
}</code></pre>
<p><code>dispatchMessage</code>方法有两个分支，如果<code>callback</code>（<code>Runnable</code>）不是<code>null</code>，则直接执行<code>callback.run()</code>方法，如果<code>callback</code>是<code>null</code>，则将<code>msg</code>作为参数传给<code>handleMessage()</code>方法去处理，这样就是我们常见的处理方法了。</p>
<h4><code>Message.target与Handler</code></h4>
<p>特别需要注意<code>Message</code>中的<code>target</code>成员变量，它是指向自己的发送者，这一点意味着什么呢？</p>
<p>意味着：一个有<code>Looper</code>的线程可以有很多个<code>Handler</code>，这些<code>Handler</code>都是不同的对象，但是它们都可以将<code>Message</code>对象发送到同一个MQ中，<code>Looper</code>不断的从MQ中获取这些消息，并将消息交给它们的发送者去处理。一个MQ是可以对应多个<code>Handler</code>的（多个<code>Handler</code>都可以往同一个MQ中消息入队）</p>
<p>下图可以简要的概括下它们之间的关系。</p>
<p><span class="img-wrap"><img data-src="https://segmentfault.com/image?src=http://img.blog.csdn.net/20160316115827197&amp;objectId=1190000006171396&amp;token=c086fff9d18d88a762bec85ed4155350" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/image" style="cursor: pointer; display: inline;"></span></p>
<h2 id="articleHeader6">总结</h2>
<ul>
<li><p><code>Looper</code>调用<code>prepare()</code>进行初始化，创建了一个与当前线程对应的<code>Looper</code>对象（通过<code>ThreadLocal</code>实现），并且初始化了一个与当前<code>Looper</code>对应的<code>MessageQueue</code>对象。</p></li>
<li><p><code>Looper</code>调用静态方法<code>loop()</code>开始消息循环，通过<code>MessageQueue.next()</code>方法获取<code>Message</code>对象。</p></li>
<li><p>当获取到一个<code>Message</code>对象时，让<code>Message</code>的发送者（<code>target</code>）去处理它。</p></li>
<li><p><code>Message</code>对象包括数据，发送者（<code>Handler</code>），可执行代码段（<code>Runnable</code>）三个部分组成。</p></li>
<li><p><code>Handler</code>可以在一个已经<code>Looper.prepare()</code>的线程中初始化，如果线程没有初始化<code>Looper</code>，创建<code>Handler</code>对象会失败</p></li>
<li><p>一个线程的执行流中可以构造多个<code>Handler</code>对象，它们都往同一个MQ中发消息，消息也只会分发给对应的<code>Handler</code>处理。</p></li>
<li><p><code>Handler</code>将消息发送到MQ中，<code>Message</code>的<code>target</code>域会引用自己的发送者，<code>Looper</code>从MQ中取出来后，再交给发送这个<code>Message</code>的<code>Handler</code>去处理。</p></li>
<li><p><code>Message</code>可以直接添加一个<code>Runnable</code>对象，当这条消息被处理的时候，直接执行<code>Runnable.run()</code>方法。</p></li>
</ul>

                </div>
                                                
                <div class="clearfix mt10">
                    <ul class="article-operation list-inline pull-left"><li><a href="https://segmentfault.com/a/1190000006171396">2016年08月04日发布</a></li><li class="dropdown js__content-ops" data-module="article" data-id="1190000006171396" data-typetext="文章"><a href="javascript:void(0);" class="dropdown-toggle text-muted" data-toggle="dropdown"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></a><ul class="dropdown-menu dropdown-menu-left"><li><a href="https://segmentfault.com/a/1190000006171396#911" data-toggle="modal" data-target="#911" data-action="report">举报</a></li></ul></li></ul>
                    <div class="pull-right">
                        <div class="widget-share__full" data-text="Android 中线程间通信原理分析：Looper, MessageQueue, Handler" data-url="https://segmentfault.com/a/1190000006171396" data-shorturl="http://sfau.lt/b5z3CO"><div class="widget-share-network sharer-0" style="display: block;"><ul class="sn-inline"><li data-network="weibo"><a href="javascript:void(0);" class="entypo-weibo icon-sn-weibo share-1" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至新浪微博">新浪微博</a></li><li data-network="wechart"><a href="javascript:void(0);" class="entypo-wechart icon-sn-weixin share-2" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至微信">微信</a></li><li data-network="twitter"><a href="javascript:void(0);" class="entypo-twitter icon-sn-twitter share-3" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至 Twitter">Twitter</a></li><li data-network="facebook"><a href="javascript:void(0);" class="entypo-facebook icon-sn-facebook share-4" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至 Facebook">Facebook</a></li></ul></div><a type="button" class="btn btn-sm shareMore btn-sn-more" data-toggle="popover" data-placement="top" data-url="https://segmentfault.com/a/1190000006171396" data-shorturl="http://sfau.lt/b5z3CO"><span class="icon-sn-dotted" data-original-title="" title=""></span><strong class="visible-xs-inline">•••</strong></a></div>


                    </div>
                </div>
                <div class="mt10 text-center"><button type="button" data-id="1190000006171396" class="btn btn-danger btn-lg mr15 article__reward-btn">
                                    赞赏支持
                                </button><button type="button" id="mainLike" data-id="1190000006171396" class="btn btn-success btn-lg mr15 "><i class="fa fa-caret-up fa-lg" aria-hidden="true"></i>&nbsp;&nbsp;<span class="seprator">|</span>&nbsp;&nbsp;
                                <span id="mainLikeNum">2 </span></button><button type="button" id="mainBookmark" data-type="article" data-id="1190000006171396" class="btn btn-default btn-lg "><span id="mainBookmarkText">收藏</span>&nbsp;&nbsp;<span class="seprator">|</span>&nbsp;&nbsp;<span id="mainBookmarkNum">7</span></button></div><div class="mt20 text-center article__reward-info"><span class="mr10">如果觉得我的文章对你有用，请随意赞赏</span></div>
                                    <div class="recommend-post pt30 mt40 mb30 border-top">
                        <div class="row">
                            <div class="col-md-8">
                                                                    <h4 class="mt0">你可能感兴趣的文章</h4>
                                    <ul class="widget-links list-unstyled">
                                                                                    <li class="widget-links__item">
                                                <a href="https://segmentfault.com/a/1190000006225646" title="[React Native Android 安利系列]js调用java组件原理">[React Native Android 安利系列]js调用java组件原理</a>
                                                <small class="text-muted">
                                                    2 收藏，946
                                                    浏览
                                                </small>
                                            </li>
                                                                                    <li class="widget-links__item">
                                                <a href="https://segmentfault.com/a/1190000009872206" title="Android设计分辨率">Android设计分辨率</a>
                                                <small class="text-muted">
                                                    391
                                                    浏览
                                                </small>
                                            </li>
                                                                                    <li class="widget-links__item">
                                                <a href="https://segmentfault.com/a/1190000009795443" title="Android 自定义View - 收藏集 - 掘金">Android 自定义View - 收藏集 - 掘金</a>
                                                <small class="text-muted">
                                                    437
                                                    浏览
                                                </small>
                                            </li>
                                                                            </ul>
                                                            </div>
                            <div class="col-md-4">
                                                                    <div class="article-license">
                                                                                                                                                                <div class="license-item text-muted">
                                            本作品 <a href="https://segmentfault.com/tos#sec-licence-4" target="_blank" class="alert-link">保留所有权利</a> 。未获得许可人许可前，不允许他人复制、发行、展览和表演作品。不允许他人基于该作品创作演绎作品
                                            。
                                        </div>
                                        
                                    </div>
                                                            </div>
                        </div>

                    </div>
                                <!-- <ul class="list-unstyled text-muted mt30">
                                        <li>上一篇：<a href="/a/1190000006119157">c++中virtual关键字的作用与Java中多态的一点对比</a></li>
                                                            <li class="mt5">下一篇：<a href="/a/1190000006683607">git bash使用指南</a></li>
                                    </ul> -->

                <h2 class="h4 post-comment-title"></h2>
                        <div class="comments--news comments--default" data-id="1190000006171396" data-user-id="" data-author-id="1030000002405862 " data-is-admin="null">
        <div class="mb10 clearfix">
            <strong class="comments-stat pull-left mr10">3 条评论</strong>

                                        <div class="btn-group btn-group-xs pull-right comments-sort btn-group-menu" role="menu">
                    <a href="javascript:;" class="btn btn-default active" data-sort="default">默认排序</a>
                    <a href="javascript:;" class="btn btn-default" data-sort="desc">时间排序</a>
                </div>
                    </div>
        <div class="comments-container">
                                <div class="comments-list">
                <div class="comments-item" data-id="1050000006175067">
            <div class="pull-left">
                <a href="https://segmentfault.com/u/labmem" target="_blank"><img class="avatar-32 " src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/2566361602-55388925ac682_medium40" alt=""></a>
            </div>
            <div class="comments-content">
                <div class="comment-trigger">
                    <div class="pull-right comment-option">
                        <a href="https://segmentfault.com/a/1190000006171396#911" class="ml10" data-toggle="modal" data-target="#911" data-action="report" data-action-text="举报" data-module="comment" data-id="1050000006175067" data-typetext="评论" data-placement="top" title="举报"><span class="glyphicon glyphicon-flag" aria-hidden="true"></span></a>
                                            </div>
                    <strong><a target="_blank" href="https://segmentfault.com/u/labmem">labmem</a></strong>
                    <span class="comments-isAuthor hide"></span>
                    <span class="comments-date">  ·  2016年08月04日</span>
                </div>

                <div class="fmt mb10"><p>写的非常好，简单易懂</p></div>

                <p class="comment-ops not-reply">
                    <span class="comments-zan ">
                        <i class="fa fa-thumbs-up" aria-hidden="true"></i>
                        <span class="comments-zan-text">赞</span>
                        <span class="comments-zan-value"></span>
                    </span>
                    <span class="ml15 comments-reply-btn">回复</span>
                </p>

                <div class="reply-list reply-list--empty">

                    
                    <div class="reply-item reply-item--ops">
                        <a class="reply-inner-btn" href="javascript:;">添加回复</a>
                        
                    </div>
                </div>


            </div>
        </div>
                <div class="comments-item" data-id="1050000006183700">
            <div class="pull-left">
                <a href="https://segmentfault.com/u/kross" target="_blank"><img class="avatar-32 " src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/1229635323-58bd5e7971f00_medium40" alt=""></a>
            </div>
            <div class="comments-content">
                <div class="comment-trigger">
                    <div class="pull-right comment-option">
                        <a href="https://segmentfault.com/a/1190000006171396#911" class="ml10" data-toggle="modal" data-target="#911" data-action="report" data-action-text="举报" data-module="comment" data-id="1050000006183700" data-typetext="评论" data-placement="top" title="举报"><span class="glyphicon glyphicon-flag" aria-hidden="true"></span></a>
                                            </div>
                    <strong><a target="_blank" href="https://segmentfault.com/u/kross">Kross</a></strong>
                    <span class="comments-isAuthor ">作者</span>
                    <span class="comments-date">  ·  2016年08月05日</span>
                </div>

                <div class="fmt mb10"><p>谢谢~</p></div>

                <p class="comment-ops not-reply">
                    <span class="comments-zan ">
                        <i class="fa fa-thumbs-up" aria-hidden="true"></i>
                        <span class="comments-zan-text">赞</span>
                        <span class="comments-zan-value"></span>
                    </span>
                    <span class="ml15 comments-reply-btn">回复</span>
                </p>

                <div class="reply-list reply-list--empty">

                    
                    <div class="reply-item reply-item--ops">
                        <a class="reply-inner-btn" href="javascript:;">添加回复</a>
                        
                    </div>
                </div>


            </div>
        </div>
                <div class="comments-item" data-id="1050000007914824">
            <div class="pull-left">
                <a href="https://segmentfault.com/u/marlon_585fdc3d56541" target="_blank"><img class="avatar-32 " src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/user-40.png" alt=""></a>
            </div>
            <div class="comments-content">
                <div class="comment-trigger">
                    <div class="pull-right comment-option">
                        <a href="https://segmentfault.com/a/1190000006171396#911" class="ml10" data-toggle="modal" data-target="#911" data-action="report" data-action-text="举报" data-module="comment" data-id="1050000007914824" data-typetext="评论" data-placement="top" title="举报"><span class="glyphicon glyphicon-flag" aria-hidden="true"></span></a>
                                            </div>
                    <strong><a target="_blank" href="https://segmentfault.com/u/marlon_585fdc3d56541">Marlon</a></strong>
                    <span class="comments-isAuthor hide"></span>
                    <span class="comments-date">  ·  2016年12月25日</span>
                </div>

                <div class="fmt mb10"><p>感谢  讲的很清楚明白</p></div>

                <p class="comment-ops not-reply">
                    <span class="comments-zan ">
                        <i class="fa fa-thumbs-up" aria-hidden="true"></i>
                        <span class="comments-zan-text">赞</span>
                        <span class="comments-zan-value"></span>
                    </span>
                    <span class="ml15 comments-reply-btn">回复</span>
                </p>

                <div class="reply-list reply-list--empty">

                    
                    <div class="reply-item reply-item--ops">
                        <a class="reply-inner-btn" href="javascript:;">添加回复</a>
                        
                    </div>
                </div>


            </div>
        </div>
            </div>
    <div class="comments-loading hide">载入中...</div>
    <div class="comments-more hide"><a href="javascript:;">显示更多评论</a></div>

                        <div class="comments-box">
                <div class="pull-left">
                    <img class="avatar-32 " src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/user-128.png" alt="">
                </div>
                <div class="comments-box-content">
                    <form action="https://segmentfault.com/api/article/[id]/comments/add">
                        <div class="form-group mb0">
                                            <textarea name="text" rows="3" class="form-control" placeholder="文明社会，理性评论"></textarea>

                            <div class="mt15 text-right">
                                <button type="button" class="hide"></button>
                                <button class=" btn btn-primary" type="button">发布评论</button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
                    </div>
    </div>


                                    
                
            </div><!-- /.main -->


            <div class="col-xs-12 col-md-3 side">
                <div class="sfad-sidebar">
      <div class="sfad-item">
    <ins><style>
.sfad-item ins {
position: relative;
display: inline-block;
}
.ad-sign {
position: absolute;
right: 8px;
bottom: 8px;
padding: 0 3px;
background: rgba(0,0,0,.15);
color: #fff;
font-size: 12px;
text-decoration: none;
height: 16px;
line-height: 16px;
border-radius: 3px;
}
</style><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=139__zoneid=2__cb=b47ea05777__oadest=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000009781697" target="_blank"><img src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/3b473d4413b81a89eb8d6846474a0722.png" width="255" height="165" alt="" title="" border="0"></a><div id="beacon_b47ea05777" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/lg.php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div><span class="ad-sign">广告</span></ins>
    <button class="close" type="button" aria-hidden="true">×</button>
</div>

  </div>


                <div class="widget-box widget-box--blog-info">
                    <div class="blog__sidebar-author ">
                                                    <button type="button" class="btn btn-sm btn-success follow-user ml10 pull-right" data-do="follow" data-type="user" data-id="1030000002405862">关注作者
                            </button>
                        
                        <div class="article__widget--author">
                            <a href="https://segmentfault.com/u/kross">
                                <img class="avatar-40" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/1229635323-58bd5e7971f00_big64" alt="Kross">
                            </a>
                            <a class="article__widget-author-name" href="https://segmentfault.com/u/kross">
                                <strong>Kross</strong>
                            </a>
                            <p class="article__widget-author-text-muted mb0">
                                <span>90 声望</span>

                            </p>


                        </div>


                    </div>
                                        <div class="blog__sidebar-blog-name">
                        <p class="article__widget-author-text-muted mt15 mb5">发布于专栏</p>

                        <h4 class="fz16"><a href="https://segmentfault.com/blog/kross">kross的专栏</a></h4>
                        <p class="article__widget-author-desc">分享一些有用的知识</p>

                        <p>
                            <span class="article__widget-author-text-muted">2 人关注</span>
                            
                                                                    <button type="button mb20" class="btn btn-sm btn-default follow-article pull-right" data-do="follow" data-type="blog" data-id="1200000005805457">关注专栏
                                    </button>
                                
                                                    </p>

                    </div>
                    

                </div>


                               
                <div class="post-nav hidden-xs side-outline hidden-sm fixed" style="display: block; width: 255px; top: 0px;">
                    <div class="panel panel-default widget-outline">
                        <div class="panel-heading">目录</div>
                        <div class="panel-body">
                            <div class="nav-body" style="top: 0px;">
                                <div class="highlight-title" style="display: block; top: 0px; height: 27px;"></div>
                                <ul class="articleIndex"><li class="active"><a href="https://segmentfault.com/a/1190000006171396#articleHeader0">自问自答的两个问题</a></li><li class=""><a href="https://segmentfault.com/a/1190000006171396#articleHeader1">Android 中的线程间通信方案</a></li><li style="list-style:none;"><ul><li class=""><a href="https://segmentfault.com/a/1190000006171396#articleHeader2">Looper</a></li><li class=""><a href="https://segmentfault.com/a/1190000006171396#articleHeader3">MessageQueue</a></li><li class=""><a href="https://segmentfault.com/a/1190000006171396#articleHeader4">Message</a></li><li class=""><a href="https://segmentfault.com/a/1190000006171396#articleHeader5">Handler</a></li></ul></li><li class=""><a href="https://segmentfault.com/a/1190000006171396#articleHeader6">总结</a></li></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- /.side -->
        </div>
    </div>
</div>

<div id="shareToWeiboModal" class="modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">×</span><span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title">分享</h4>
            </div>
            <div class="modal-body">
                <p class="sfModal-content">
                    分享到微博？
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default dont-likeweibo" data-dismiss="modal">取消</button>
                <a href="https://segmentfault.com/a/1190000006171396" id="shareLink" class="btn btn-primary done-btn" target="_blank" onclick="$(&#39;#shareToWeiboModal&#39;).modal(&#39;hide&#39;)">分享</a>
            </div>
        </div>
    </div>
</div>

    

<script src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/hm.js.下载"></script><script async="" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/analytics.js.下载"></script><script type="text/template" id="regNext">
        <div class="row flex-vertical-center">
        <div class="col-md-12">
            <p class="mb0" style="font-size: 14px; margin-right:50px; font-family: Source Code Pro,Consolas,Menlo,Monaco,Courier New,monospace;">
                    空两格 or 空四格，这里有和你一样有趣的开发者
            </p>
            <button class="btn btn-primary SFLogin mr10"
                    onclick='ga("send", "event", "join button", "clicked", "footer welcome popup");'>投入组织怀抱
            </button>
            <button class="btn  btn-default  tomorrow">我用 Python</button>
        </div>

    </div>
</script>

<div class="widget-register widget-welcome-question mt20 hidden-xs hidden-sm widget-welcome widget-register-slideUp">
    <div class="container">
        <div class="row flex-vertical-center">
            <div class="col-sm-12 col-md-8">
                <p class="mb0">
                                                                你好！看起来你挺喜欢这个内容，但是你还没有注册帐号。 <br><br>当你创建了帐号，我们能准确地追踪你关注的问题，在有新答案或内容的时候收到网页和邮件通知。<br>还能直接向作者咨询更多细节。如果上面的内容有帮助，记得点赞 (♥◠‿◠)ﾉ 表示感谢。
                                    </p>

            </div>
            <div class="col-sm-12 col-lg-3 col-lg-offset-1 col-md-4">
                <button class="btn btn-primary btn-lg SFLogin  mr10" onclick="ga(&quot;send&quot;, &quot;event&quot;, &quot;join button&quot;, &quot;clicked&quot;, &quot;footer welcome popup&quot;);">立即注册
                </button>
                <button class="btn btn-lg btn-default  tomorrow">明天提醒我</button>
            </div>
            <div style="position: absolute;transform: scale(0.5,0.5) translate(300%,-60%);">
                <img src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/welcome@2x.png">
            </div>
        </div>
    </div>
</div>

<div class="modal widget-911" id="911" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" type="button">
          <span aria-hidden="true">×</span>
          <span class="sr-only">Close</span>
        </button>
        <h4 class="modal-title"><span data-model="action"></span><span data-model="type"></span></h4>
      </div>
      <div class="modal-body">
        <form id="reportForm">
          <!-- 后台返回信息 -->
          <p class="alert alert-warning" data-model="returnMsg"></p>
          <div data-role="base">
            <p>
              <strong class="required">我要<span data-model="action"></span>该<span data-model="type"></span>，理由是：</strong>
            </p>
            <ul class="list-unstyled" data-model="list"></ul>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default pull-left" type="button" data-role="back" style="display:none">返回重选</button>
                <button class="btn btn-default" data-dismiss="modal" type="button">取消</button>
        <button class="btn btn-primary" data-role="submit" type="button">提交</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<footer id="footer">
    <div class="container">
        <div class="row hidden-xs">
            <dl class="col-sm-2 site-link">
                <dt>网站相关</dt>
                <dd><a href="https://segmentfault.com/about">关于我们</a></dd>
                <dd><a href="https://segmentfault.com/tos">服务条款</a></dd>
                <dd><a href="https://segmentfault.com/faq">帮助中心</a></dd>
                <dd><a href="https://segmentfault.com/repu">声望与权限</a></dd>
                <dd><a href="https://segmentfault.com/markdown">编辑器语法</a></dd>
                <dd><a href="https://weekly.segmentfault.com/">每周精选</a></dd>
                <dd><a href="https://segmentfault.com/app">App 下载</a></dd>
                <dd><a href="https://segmentfault.com/community">社区服务中心</a></dd>
            </dl>
            <dl class="col-sm-2 site-link">
                <dt>联系合作</dt>
                <dd><a href="https://segmentfault.com/contact">联系我们</a></dd>
                <dd><a href="https://segmentfault.com/hiring">加入我们</a></dd>
                <dd><a href="https://segmentfault.com/link">合作伙伴</a></dd>
                <dd><a href="https://segmentfault.com/press">媒体报道</a></dd>
                <dd><a href="https://segmentfault.com/g/1570000009280187">建议反馈</a></dd>
                                            </dl>
            <dl class="col-sm-2 site-link">
                <dt>常用链接</dt>
                                                <dd><a href="https://chrome.google.com/webstore/detail/segmentfault-%E7%AC%94%E8%AE%B0/pjklfdmleagfaekibdccmhlhellefcfo" target="_blank">笔记插件: Chrome</a></dd>
                                                                <dd><a href="https://addons.mozilla.org/zh-CN/firefox/addon/sf-note-ext/" target="_blank">笔记插件: Firefox</a></dd>
                                                                <dd>订阅：<a href="https://segmentfault.com/feeds">问答</a> / <a href="https://segmentfault.com/feeds/blogs">文章</a></dd>
                                                                <dd><a href="https://mirrors.segmentfault.com/" target="_blank">文档镜像</a></dd>
                                                                <dd><a href="https://segmentfault.com/blog/interview" target="_blank">社区访谈</a></dd>
                                                                <dd><a href="https://segmentfault.com/d-day" target="_blank">D-DAY 技术沙龙</a></dd>
                                                                <dd><a href="https://segmentfault.com/hackathon" target="_blank">黑客马拉松 Hackathon</a></dd>
                                                                <dd><a href="https://namebeta.com/" target="_blank">域名搜索注册</a></dd>
                                                                <dd><a href="https://shop165859711.taobao.com/" target="_blank">周边店铺</a></dd>
                                            </dl>
            <dl class="col-sm-2 site-link">
                <dt>关注我们</dt>
                                <dd><a href="https://github.com/SegmentFault" target="_blank">Github</a></dd>
                                <dd><a href="https://twitter.com/segment_fault" target="_blank">Twitter</a></dd>
                                <dd><a href="http://weibo.com/segmentfault" target="_blank">新浪微博</a></dd>
                                <dd><a href="https://segmentfault.com/blog/segmentfault_team" target="_blank">团队日志</a></dd>
                                <dd><a href="https://segmentfault.com/blog/segmentfault" target="_blank">产品技术日志</a></dd>
                                <dd><a href="https://segmentfault.com/blog/community_admin" target="_blank">社区运营日志</a></dd>
                                <dd><a href="https://segmentfault.com/blog/segmentfault_news" target="_blank">市场运营日志</a></dd>
                            </dl>
            <dl class="col-sm-4 site-link" id="license">
                <dt>内容许可</dt>
                <dd>除特别说明外，用户内容均采用 <a rel="license" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 进行许可
                </dd>
                <dd>本站由 <a target="_blank" href="https://www.upyun.com/?utm_source=segmentfault&amp;utm_medium=link&amp;utm_campaign=upyun&amp;md=segmentfault">又拍云</a> 提供 CDN 存储服务
                </dd>
            </dl>
        </div>
        <div class="copyright">
            Copyright © 2011-2017 SegmentFault. 当前呈现版本 17.06.16<br>
            <a href="http://www.miibeian.gov.cn/" rel="nofollow">浙ICP备 15005796号-2</a> &nbsp;
            <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602002000" rel="nofollow">浙公网安备 33010602002000号</a>
        </div>
        <p class="text-center">
            <a class="js__view--selector hidden-sm hidden-md hidden-lg" data-action="mobile" href="javascript:;">移动版</a>
            <a class="js__view--selector hidden-sm hidden-md hidden-lg" data-action="desktop" href="javascript:;">桌面版</a>
        </p>
    </div>
</footer>

<div id="fixedTools" class="hidden-xs hidden-sm">
    <a id="backtop" class="border-bottom" href="https://segmentfault.com/a/1190000006171396#">回顶部</a>

    <div class="qrcodeWraper">
        <a href="https://segmentfault.com/app#qrcode"><span class="glyphicon glyphicon-qrcode"></span></a>
        <img id="qrcode" class="border" alt="sf-wechat" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/appQrcode.png">

        <p class="qrcode-text">扫扫下载 App</p>
    </div>
</div>

<script id="loginModal" type="text/template">
    <div class="row bg-white login-modal">
        <div class="col-md-4 col-sm-12 col-md-push-7 login-wrap">
            <h1 class="h4 text-muted login-title">用户登录</h1>
            <form action="/api/user/login" method="POST" role="form" class="mt30">
                <div class="form-group">
                    <label for="username" class="control-label">手机号 或 Email</label>
                    <input type="text" class="form-control" name="username" required placeholder="11 位手机号 或 Email"
                           autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="control-label">密码</label><span class="pull-right"><a
                                href="/user/forgot">忘记密码</a></span>
                    <input type="password" class="form-control" name="password" required placeholder="密码">
                </div>
                <div class="form-group clearfix">
                    <div class="checkbox pull-left">
                        <label><input name="remember" type="checkbox" value="1" checked> 记住登录状态</label>
                    </div>
                    <button type="submit" class="btn btn-primary pull-right pl20 pr20"
                            onclick='ga("send", "event", "email login button", "clicked", "login modal");'>登录
                    </button>
                </div>
            </form>
            <p class="h4 text-muted visible-xs-block h4">快速登录</p>
            <div class="widget-login mt30">
                <p class="text-muted mt5 mr10 pull-left hidden-xs">快速登录</p>
                <a href="/user/oauth/google" class=""
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "google"});'><span
                            class="icon-sn-google"></span> <strong class="visible-xs-inline">Google 账号</strong></a>
                <a href="/user/oauth/github" class=""
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "github"});");'><span
                            class="icon-sn-github"></span> <strong class="visible-xs-inline">Github 账号</strong></a>
                <a href="/user/oauth/weibo" class=""
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "weibo"});'><span
                            class="icon-sn-weibo"></span> <strong class="visible-xs-inline">新浪微博账号</strong></a>
                <a href="/user/oauth/qq" class=""
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "qq"});'><span
                            class="icon-sn-qq"></span> <strong class="visible-xs-inline">QQ 账号</strong></a>
                <a href="/user/oauth/weixin" class=""
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "qq"});'><span
                            class="icon-sn-weixin"></span> <strong class="visible-xs-inline">微信账号</strong></a>
                <a href="/user/oauth/linkedin" class=""
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "linkedin"});'><span
                            class="icon-sn-linkedin"></span> <strong class="visible-xs-inline">LinkedIn 账号</strong></a>
                <span id="loginShowMore" style="cursor: pointer" class="mb5"><span class="icon-sn-dotted"></span><strong
                            class="visible-xs-inline">•••</strong></span>
                <a href="/user/oauth/twitter" class=" hidden"
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "twitter"});'><span
                            class="icon-sn-twitter"></span> <strong class="visible-xs-inline">Twitter 账号</strong></a>
                <a href="/user/oauth/facebook" class=" hidden"
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "facebook"});'><span
                            class="icon-sn-facebook"></span> <strong class="visible-xs-inline">Facebook 账号</strong></a>
                <a href="/user/oauth/douban" class=" hidden"
                   onclick='ga("send", "event", "3rd login button", "clicked", "login modal", {media: "douban"});'><span
                            class="icon-sn-douban"></span> <strong class="visible-xs-inline">豆瓣账号</strong></a>
            </div>
        </div>
        <div class="login-vline hidden-xs hidden-sm"></div>
        <div class="col-md-4 col-md-pull-3 col-sm-12 login-wrap">
            <h1 class="h4 text-muted login-title">注册新账号</h1>
            <form action="/api/user/phone/register" method="POST" role="form" class="mt30">
                <div class="form-group">
                    <label for="name" class="control-label">名字</label>
                    <input type="text" class="form-control" name="name" required placeholder="真实姓名或常用昵称">
                </div>


                <div class="form-group js-register-switch-box">
                    <div class="mb10">
                        <label class="radio-inline">
                            <input type="radio" name="register_type" value="phone" checked> 用手机号注册
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="register_type" value="mail"> 用 Email 注册
                        </label>
                    </div>
                    <div class="js-register-switch-content">
                        <input type="phone" class="form-control mb15" name="phone" required placeholder="仅支持大陆手机号"
                               autocomplete="off">
                        <div class="input-group"><input name="code" type="text"
                                                        class="form-control js-user-login__phone-code-value"
                                                        placeholder="短信验证码">
                            <span class="input-group-btn"><button class="btn btn-default js-user-login__phone-vaild-btn"
                                                                  style="width:96px;" type="button">获取验证码</button></span>
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <label for="password" class="control-label">密码</label>
                    <input type="password" class="form-control" name="password" required placeholder="不少于 6 位">
                </div>
                <div class="form-group" style="display:none;">
                    <label class="required control-label">验证码</label>
                    <input type="text" class="form-control" id="captcha" name="captcha" placeholder="请输入下方的验证码">
                    <div class="mt10"><a id="loginReloadCaptcha" href="javascript:void(0)"><img
                                    data-src="/user/captcha?w=240&h=50" class="captcha" width="240" height="50"/></a>
                    </div>
                </div>
                <div class="form-group clearfix">
                    <div class="checkbox pull-left">
                        同意并接受<a href="/tos" target="_blank">《服务条款》</a>
                    </div>
                    <button type="submit" class="btn btn-primary pl20 pr20 pull-right"
                            onclick='ga("send", "event", "email register button", "clicked", "login modal");'>注册
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div style="position: absolute;transform: scale(0.5,0.5) translate(136%,-114%); left: -3px;" class="hidden-xs">
        <img src="https://static.segmentfault.com/v-5954c7a4/global/img/fool/login@2x.png">
    </div>

    <div class="text-center text-muted mt30">
    </div>
</script>
<script id="bindPhoneModal" type="text/template">
    <div class="row bg-white bindphone-model">
        <div class="col-md-12">
            <div class="alert alert-warning" role="alert">
                为了保证账号安全，请先绑定手机
            </div>
            <div>
                <form class="form-horizontal form__bindphone-apply" style="background-color:#fff;padding:0;">
                    <div class="form-group ">
                        <label for="phoneNumber" class="col-sm-3 control-label required" >手机号码</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control bindphone--phone" id="phoneNumber" name="phone" placeholder="仅只支持大陆手机号">
                        </div>
                        <div class="col-sm-3"></div>
                    </div>
                    <div class="form-group">
                        <label for="authCode" class="col-sm-3 control-label required">验证码</label>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <input type="text" class="form-control bindphone--code" name="code" placeholder="短信验证码">
                                <span class="input-group-btn">
                                    <button class="btn btn-default user-bind__phone-vaild-btn" type="button">获取验证码</button>
                                </span>
                            </div>
                        </div>
                        <div class="col-sm-3"></div>
                    </div>
                </form>
            </div>
        </div>

    </div>
</script>



<script>
    (function (w) {
        w.SF = {
            staticUrl: "https://static.segmentfault.com/v-5954c7a4"
        };
        w.SF.token = (function () {
    var _ETs = //'C'
'1'+//'80'
'a5'+'47'//'Z6'
+'d'//'zn5'
+//'P'
'4e'+'1'//'R'
+//'7I'
'7'+//'sW'
'2'+//'cV'
'cV'+''///*'RM9'*/'RM9'
+//'Gxj'
'c7'+//'8K'
'8K'+''///*'eFF'*/'eFF'
+''///*'zK'*/'zK'
+'a'//'o'
+//'8'
'df8'+'f5'//'4s'
+//'b'
'2'+//'q'
'bf7'+'a6'//'Dx4'
+//'Sz'
'eaa'+/* 'qb'//'qb' */''+//'L'
'b28'+//'6'
'7', _LcHeAC = [[11,13],[13,15]];

    for (var i = 0; i < _LcHeAC.length; i ++) {
        _ETs = _ETs.substring(0, _LcHeAC[i][0]) + _ETs.substring(_LcHeAC[i][1]);
    }

    return _ETs;
})();;
    })(window);

                var lock = {
        type: "",
        text: '',
        table: {"ban_post":[1,"\u4f60\u5df2\u7ecf\u88ab\u7981\u8a00, \u65e0\u6cd5\u8fdb\u884c\u6b64\u64cd\u4f5c, \u5982\u6709\u7591\u4e49\u8bf7\u63d0\u4ea4\u7533\u8bc9, \u6216\u8005\u53d1\u90ae\u4ef6\u5230pr@segmentfault.com"]}
    };
</script>
    <script crossorigin="" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/assets.js.下载"></script>
    <script crossorigin="" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/post.min.js.下载"></script>

<script async="" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/asyncjs.php"></script>

<script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-918487-8']);
    _gaq.push(['_trackPageview']);
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            
        

            

    ga('create', 'UA-918487-8', 'auto', {
        'userID'
    : 0,
        'createdTime'
    : 0,
        'now'
    : 1498918243 });
    ga('set', 'dimension1', 'guest');
    ga('send', 'pageview');

</script>

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?e23800c454aa573c0ccb16b52665ac26";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>





<iframe id="p_analyse_iframe" src="./Android 中线程间通信原理分析：Looper, MessageQueue, Handler - kross的专栏 - SegmentFault_files/saved_resource.html" style="display: none;"></iframe><div id="noteWidget" class="noteWidget hidden hidden-xs">
    <div class="noteWidget-header clearfix">
        <h2 class="h4 pull-left">记笔记</h2>
        <ul class="list-inline pull-right mb0">
            <li id="noteWidgetMinimize"><span class="icon-minimize"></span></li><li id="noteWidgetZoom"><span class="icon-zoom"></span></li><li id="noteWidgetClose"><span class="icon-close"></span></li>
        </ul>
    </div>
    <form method="POST" action="https://segmentfault.com/api/notes/add" role="form">
        <div class="form-group">
            <label for="title" class="sr-only">标题</label>
            <input type="hidden" value="" id="draftId">
            <input type="text" name="title" data-error="" autocomplete="off" class="form-control" placeholder="笔记描述" value="">
        </div>
        <div class="editor-config clearfix">
            <select name="lang" class="form-control pull-left input-sm">
                <optgroup label="文本语法">
                    <option value="text" data-mode="text">纯文本</option>
                    <option value="markdown" data-mode="markdown">Markdown</option>
                    <option value="javascript" data-mode="javascript">Javascript</option>
                    <option value="css" data-mode="css">CSS</option>
                    <option value="html5" data-mode="htmlmixed">HTML</option>
                    <option value="php" data-mode="php">PHP</option>
                    <option value="python" data-mode="python">Python</option>
                    <option value="ruby" data-mode="ruby">Ruby</option>
                    <option value="go" data-mode="go">Go</option>
                    <option value="c" data-mode="clike">C/C++</option>
                    <option value="java" data-mode="java">Java</option>
                    <option value="bash" data-mode="shell">Shell/Bash</option>
                </optgroup>
            </select>
            <div class="pull-right hidden-xs">
                <select name="indentWithTabs" class="form-control inline-block input-sm">
                    <optgroup label="缩进模式">
                        <option value="false">空格缩进</option>
                        <option value="true">Tabs 缩进</option>
                    </optgroup>
                </select>
                <select name="tabSize" class="form-control inline-block input-sm">
                    <optgroup label="缩进大小">
                        <option value="2">2</option>
                        <option value="4" selected="">4</option>
                    </optgroup>
                </select>
                <select name="lineWrap" class="form-control inline-block input-sm">
                    <optgroup label="换行方式">
                        <option value="true">自动换行</option>
                        <option value="false">不换行</option>
                    </optgroup>
                </select>
            </div>
        </div>
        <textarea id="codeMirror" class="form-control" style="display: none;"></textarea><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px;"><div style="position: relative;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px;"></div><div class="CodeMirror-gutters"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 1px;"></div></div></div></div>
        <div class="mt20 clearfix">
            <div class="pull-right">
                <span class="text-muted hidden" id="editorStatus">已保存</span>
                <a id="dropIt" href="javascript:void(0);" class="mr10 hidden">[舍弃]</a>
                <button data-type="note" id="publishIt2" class="btn btn-default ml10" data-id="" data-do="add" data-url="" data-text="保存私密笔记" data-name="">保存私密笔记</button>
                <button data-type="note" id="publishIt" class="btn btn-primary ml10" data-id="" data-do="add" data-url="" data-text="保存公开笔记" data-name="">保存公开笔记</button>
                </div>
            </div>
        </form></div>
    
<div id="atwho-container"><div id="atwho-ground-85acdcf91498918245028"><div class="atwho-view" id="at-view-64"><ul class="atwho-view-ul"></ul></div></div></div></body></html>