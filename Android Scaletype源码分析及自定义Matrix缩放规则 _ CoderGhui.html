<!DOCTYPE html>
<!-- saved from url=(0046)https://ghui.me/post/2017/02/scaletype-matrix/ -->
<html lang="zh-CN" class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="about a coder."><title>Android Scaletype源码分析及自定义Matrix缩放规则 | CoderGhui</title><link rel="stylesheet" type="text/css" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/style.css"><link rel="stylesheet" type="text/css" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/normalize.min.css"><link rel="stylesheet" type="text/css" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/pure-min.css"><link rel="stylesheet" type="text/css" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/grids-responsive-min.css"><link rel="stylesheet" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/font-awesome.min.css"><script src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/hm.js.下载"></script><script async="" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/analytics.js.下载"></script><script src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/ca-pub-1828197346034266.js.下载"></script><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/jquery.min.js.下载"></script><link rel="Shortcut Icon" type="image/x-icon" href="https://ghui.me/favicon.ico"><link rel="apple-touch-icon" href="https://ghui.me/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="https://ghui.me/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="https://ghui.me/atom.xml"><script type="text/javascript" async="" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/embed.js.下载"></script><link rel="preload" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/integrator.js.下载" as="script"><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/integrator.js.下载"></script><link rel="preload" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/integrator.js(1).下载" as="script"><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/integrator.js(1).下载"></script><style type="text/css">.fancybox-margin{margin-right:17px;}</style><script src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/count-data.js.下载"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.1c973af76c6535955110c0c9d8551865.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.8edffe1405dcc2d5eb5ee9d96a2866d1.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.8d07a4869c3ec17ee1881ae6bd353027.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android Scaletype源码分析及自定义Matrix缩放规则</h1><a id="logo" href="https://ghui.me/">CoderGhui</a><p class="description">学习｜分享｜进步</p></div><div id="nav-menu"><a href="https://ghui.me/" class="current"><i class="fa fa-home"> 首页</i></a><a href="https://ghui.me/archives/"><i class="fa fa-archive"> 归档</i></a><a href="https://ghui.me/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="https://ghui.me/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android Scaletype源码分析及自定义Matrix缩放规则</h1><div class="post-meta">Feb 28, 2017<span> | </span><span class="category"><a href="https://ghui.me/categories/dev/">技术</a></span><span id="busuanzi_container_page_pv" style="display: inline;"> | <span id="busuanzi_value_page_pv">582</span><span> Hits</span></span></div><a data-disqus-identifier="post/2017/02/scaletype-matrix/" href="https://ghui.me/post/2017/02/scaletype-matrix/#disqus_thread" class="disqus-comment-count">0 Comments</a><div class="post-content"><p>在<a href="https://ghui.me/post/2017/02/imageview-scale/">上一篇</a>中，我详细的总结了ImageView各种ScaleType对应的缩放效果。对于Matrix这种强大的缩放方式并没有详细介绍，在这一篇中会主要说一下这种缩放方式。<a id="more"></a></p>
<p>让我们先从源码中看一下上一篇中介绍的几种缩放方式都是怎么实现的，然后再通过Matrix的方式来实现一下上一篇最后没有实现的3种自定义缩放规则(<em>宽度撑满并居下、高度撑满居左、高度撑满居右</em>)</p>
<h2 id="源码分析"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90" class="headerlink" title="源码分析"></a>源码分析</h2><p>打开ImageView的源码，找到如下方法：<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code" style="width: 655px;"><pre style="width: 655px;"><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">setFrame</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> changed = <span class="keyword">super</span>.setFrame(l, t, r, b);</span><br><span class="line">    mHaveFrame = <span class="keyword">true</span>;</span><br><span class="line">    configureBounds();</span><br><span class="line">    <span class="keyword">return</span> changed;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>其中有一个configureBounds()方法。我们需要的代码就在这个方法里面。首先看一下<strong>FIT_XY</strong>这种方式是如何实现的</p>
<h3 id="1-FIT-XY源码实现"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#1-FIT-XY%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0" class="headerlink" title="1. FIT_XY源码实现"></a>1. FIT_XY源码实现</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code" style="width: 655px;"><pre style="width: 655px;"><span class="line"><span class="keyword">if</span> (dwidth &lt;= <span class="number">0</span> || dheight &lt;= <span class="number">0</span> || ScaleType.FIT_XY == mScaleType) {</span><br><span class="line">    <span class="comment">// If the drawable has no intrinsic size, or we're told to</span></span><br><span class="line">   <span class="comment">//  scaletofit, then we just fill our entire view.</span></span><br><span class="line">    mDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, vwidth, vheight);</span><br><span class="line">    mDrawMatrix = <span class="keyword">null</span>;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>上述代码中的<code>vwidth与vheight</code>是ImageView控件大小减去padding后剩下的值即可容纳内容的最大空间。可以看到这种缩放方式非常简单粗暴，直接通过改变Drawable的绘制区域来达到，并未进行任何的Matrix操作。</p>
<h3 id="2-FIT-START-FIT-CENTER-FIT-END源码实现"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#2-FIT-START-FIT-CENTER-FIT-END%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0" class="headerlink" title="2. FIT_START/FIT_CENTER/FIT_END源码实现"></a>2. FIT_START/FIT_CENTER/FIT_END源码实现</h3><p>之所以把它们3个的放在一起说，是因为它们的实现逻辑是一样,在configureBounds()方法中有如下代码如下：<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code" style="width: 655px;"><pre style="width: 655px;"><span class="line"><span class="comment">// Generate the required transform.</span></span><br><span class="line"> mTempSrc.set(<span class="number">0</span>, <span class="number">0</span>, dwidth, dheight);</span><br><span class="line"> mTempDst.set(<span class="number">0</span>, <span class="number">0</span>, vwidth, vheight);</span><br><span class="line"> mDrawMatrix = mMatrix;</span><br><span class="line"> mDrawMatrix.setRectToRect(mTempSrc, mTempDst, scaleTypeToScaleToFit(mScaleType));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>可以看到这里用到了<code>setRectToRect</code>方法，这个方法可以根据变换前后的两个矩形得到对应的变换矩阵。上面代码中mTempSrc即是内容矩形大小也是变换的源矩形大小，mTempDst是ImageView控件矩形大小也是目标矩形大小。<br>这个方法还有一个参数 Matrix.ScaleToFit 它用来指定缩放选项,一共有4个选项：</p>
<blockquote>
<ol>
<li>FILL: 独立的缩放X,Y，所以这个选项可能会改变图片的长宽比（其实效果与FIT_XY一样）</li>
<li>START: 这种缩放方式的效果对应ImageView的FIT_START</li>
<li>CENTER: 这种缩放方式的效果对应ImageView的FIT_CENTER</li>
<li>END: 这种缩放方式的效果对应ImageView的FIT_END</li>
</ol>
</blockquote>
<p>也即是ImageView的这3种缩放规则直接使用的Matrix内置的这几种变换规则实现。你也可以自己用如下代码验证一下：<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code" style="width: 647px;"><pre style="width: 647px;"><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">setFrame</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">		<span class="keyword">boolean</span> changed = <span class="keyword">super</span>.setFrame(l, t, r, b);</span><br><span class="line">		test();</span><br><span class="line">		<span class="keyword">return</span> changed;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> dw= getDrawable().getIntrinsicWidth();</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> dh= getDrawable().getIntrinsicHeight();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">float</span> vw= getWidth() - getPaddingLeft() - getPaddingRight();</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">float</span> vh= getHeight() - getPaddingTop() - getPaddingBottom();</span><br><span class="line"></span><br><span class="line">		mTempSrc.set(<span class="number">0</span>, <span class="number">0</span>, dw, dh);</span><br><span class="line">		mTempDst.set(<span class="number">0</span>, <span class="number">0</span>, vw, vh);</span><br><span class="line">		Log.e(<span class="string">"ghui"</span>, <span class="string">"mTempSrc: "</span> + mTempSrc.toShortString());</span><br><span class="line">		Log.e(<span class="string">"ghui"</span>, <span class="string">"mTempDst: "</span> + mTempDst.toShortString());</span><br><span class="line">		Matrix matrix = getImageMatrix();</span><br><span class="line">		matrix.reset();</span><br><span class="line">		Log.e(<span class="string">"ghui"</span>, <span class="string">"before: "</span> + matrix.toShortString());</span><br><span class="line">		matrix.setRectToRect(mTempSrc, mTempDst, Matrix.ScaleToFit.START);</span><br><span class="line">		Log.e(<span class="string">"ghui"</span>, <span class="string">"after: "</span> + matrix.toShortString());</span><br><span class="line">		setImageMatrix(matrix);</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里不再赘述。</p>
<h3 id="3-CENTER"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#3-CENTER" class="headerlink" title="3.CENTER"></a>3.CENTER</h3><p>CENTER的源码实现对应如下代码:<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code" style="width: 655px;"><pre style="width: 655px;"><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ScaleType.CENTER == mScaleType) {</span><br><span class="line"><span class="comment">// Center bitmap in view, no scaling.</span></span><br><span class="line">  mDrawMatrix = mMatrix;</span><br><span class="line">  mDrawMatrix.setTranslate(Math.round((vwidth - dwidth) * <span class="number">0.5f</span>),</span><br><span class="line">  Math.round((vheight - dheight) * <span class="number">0.5f</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>可以看到这里是直接通过改变Matrix的Translate将内容从左上角移动到了控件的中心，使内容的中心与控件的中心对齐。并未做任何的缩放操作，<br>和我们上一篇中总结的效果一致。</p>
<h3 id="4-CENTER-CROP"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#4-CENTER-CROP" class="headerlink" title="4.CENTER_CROP"></a>4.CENTER_CROP</h3><p>这种方式的对应的源码如下:<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code" style="width: 647px;"><pre style="width: 647px;"><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ScaleType.CENTER_CROP == mScaleType) {</span><br><span class="line">  mDrawMatrix = mMatrix;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">float</span> scale;</span><br><span class="line">  <span class="keyword">float</span> dx = <span class="number">0</span>, dy = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (dwidth * vheight &gt; vwidth * dheight) {</span><br><span class="line">      scale = (<span class="keyword">float</span>) vheight / (<span class="keyword">float</span>) dheight;</span><br><span class="line">      dx = (vwidth - dwidth * scale) * <span class="number">0.5f</span>;</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">      scale = (<span class="keyword">float</span>) vwidth / (<span class="keyword">float</span>) dwidth;</span><br><span class="line">      dy = (vheight - dheight * scale) * <span class="number">0.5f</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  mDrawMatrix.setScale(scale, scale);</span><br><span class="line">  mDrawMatrix.postTranslate(Math.round(dx), Math.round(dy));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里会首先比较内容的宽高比与控件的宽高比的大小，若内容的宽高比更大（内容更宽）则以控件高度与内容高度的比作为缩放比例。反之则会将控件宽度与内容宽度的比作为缩放的比例。这样实现的效果即是将内容中更小的一者（宽或高）缩放到与控件对应的一方一样。也与上一篇中总结的效果一样。<br>接着会通过postTranslate方法将内容移动到控件中心，计算方法与CENTER中的一样。</p>
<h3 id="5-CENTER-INSID"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#5-CENTER-INSID" class="headerlink" title="5. CENTER_INSID"></a>5. CENTER_INSID</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code" style="width: 647px;"><pre style="width: 647px;"><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ScaleType.CENTER_INSIDE == mScaleType) {</span><br><span class="line">  mDrawMatrix = mMatrix;</span><br><span class="line">  <span class="keyword">float</span> scale;</span><br><span class="line">  <span class="keyword">float</span> dx;</span><br><span class="line">  <span class="keyword">float</span> dy;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (dwidth &lt;= vwidth &amp;&amp; dheight &lt;= vheight) {</span><br><span class="line">      scale = <span class="number">1.0f</span>;</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">      scale = Math.min((<span class="keyword">float</span>) vwidth / (<span class="keyword">float</span>) dwidth,</span><br><span class="line">              (<span class="keyword">float</span>) vheight / (<span class="keyword">float</span>) dheight);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  dx = Math.round((vwidth - dwidth * scale) * <span class="number">0.5f</span>);</span><br><span class="line">  dy = Math.round((vheight - dheight * scale) * <span class="number">0.5f</span>);</span><br><span class="line"></span><br><span class="line">  mDrawMatrix.setScale(scale, scale);</span><br><span class="line">  mDrawMatrix.postTranslate(dx, dy);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>可以看到若内容的宽高都小于控件的宽高，这种方式的Scale为1，即不会去缩放。否则的话则会去选择一个更小的缩放比例（控件的宽高与内容的宽高比，取其中较小的一个 ）<br>效果也与上一篇中总结的一致。</p>
<h2 id="Matrix-实现自定义的缩放效果。"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#Matrix-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E7%BC%A9%E6%94%BE%E6%95%88%E6%9E%9C%E3%80%82" class="headerlink" title="Matrix-实现自定义的缩放效果。"></a>Matrix-实现自定义的缩放效果。</h2><p>其实通过学习上面的源码，自定义实现 <em>宽度撑满并居上、宽度撑满并居下、高度撑满居左、高度撑满居右</em>这几种效果也是很简单的。先把代码贴出来：<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code" style="width: 647px;"><pre style="width: 647px;"><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">setFrame</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">		<span class="keyword">boolean</span> changed = <span class="keyword">super</span>.setFrame(l, t, r, b);</span><br><span class="line">		<span class="keyword">if</span> (getScaleType() == ScaleType.MATRIX) transformMatrix();</span><br><span class="line">		<span class="keyword">return</span> changed;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">transformMatrix</span><span class="params">()</span> </span>{</span><br><span class="line">		Matrix matrix = getImageMatrix();</span><br><span class="line">		matrix.reset();</span><br><span class="line">		<span class="keyword">float</span> h = getHeight();</span><br><span class="line">		<span class="keyword">float</span> w = getWidth();</span><br><span class="line">		<span class="keyword">float</span> ch = getDrawable().getIntrinsicHeight();</span><br><span class="line">		<span class="keyword">float</span> cw = getDrawable().getIntrinsicWidth();</span><br><span class="line">		<span class="keyword">float</span> widthScaleFactor = w / cw;</span><br><span class="line">		<span class="keyword">float</span> heightScaleFactor = h / ch;</span><br><span class="line">		<span class="keyword">if</span> (alignType == AlignType.LEFT) {</span><br><span class="line">			matrix.postScale(heightScaleFactor, heightScaleFactor, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">		} <span class="keyword">else</span> <span class="keyword">if</span> (alignType == AlignType.RIGHT) {</span><br><span class="line">			matrix.postTranslate(w - cw, <span class="number">0</span>);</span><br><span class="line">			matrix.postScale(heightScaleFactor, heightScaleFactor, w, <span class="number">0</span>);</span><br><span class="line">		} <span class="keyword">else</span> <span class="keyword">if</span> (alignType == AlignType.BOTTOM) {</span><br><span class="line">			matrix.postTranslate(<span class="number">0</span>, h - ch);</span><br><span class="line">			matrix.postScale(widthScaleFactor, widthScaleFactor, <span class="number">0</span>, h);</span><br><span class="line">		} <span class="keyword">else</span> { <span class="comment">//default is top</span></span><br><span class="line">			matrix.postScale(widthScaleFactor, widthScaleFactor, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">		}</span><br><span class="line">		setImageMatrix(matrix);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">enum</span> AlignType {</span><br><span class="line">		LEFT(<span class="number">0</span>),</span><br><span class="line">		TOP(<span class="number">1</span>),</span><br><span class="line">		RIGHT(<span class="number">2</span>),</span><br><span class="line">		BOTTOM(<span class="number">3</span>);</span><br><span class="line">		AlignType(<span class="keyword">int</span> ni) {</span><br><span class="line">			nativeInt = ni;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> nativeInt;</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>首先看第一种缩放方式：<br><strong>1.高度撑满居左</strong><br>因为ImageView的内容默认会居左上，所以这里可以直接对matrix执行缩放操作，将高度缩放到撑满控件。如下图所示:<br><a href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/imgscale1.png-sm" title="" class="fancybox" rel="article"><img src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/imgscale1.png-sm" alt=""></a><br><strong>2.高度撑满居右</strong><br>因为要居右，所以首先将内容移动到右上角，然后再以右上角为中心执行缩放操作。如下图所示：<br><a href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/imgscale2.png-sm" title="" class="fancybox" rel="article"><img src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/imgscale2.png-sm" alt=""></a><br><strong>3.宽度撑满并居下</strong><br>因为要居下，所以首先将内容移动到左下角，然后再以左下角为中心执行缩放操作。<br><a href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/imgscale3.png-sm" title="" class="fancybox" rel="article"><img src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/imgscale3.png-sm" alt=""></a><br><strong>4.宽度撑满并居上</strong><br>这种方式更简单，因为内容默认在左上角，所以这里可以直接执行缩放操作即可。</p>
<h2 id="源码"><a href="https://ghui.me/post/2017/02/scaletype-matrix/#%E6%BA%90%E7%A0%81" class="headerlink" title="源码"></a>源码</h2><p><a href="https://github.com/ghuiii/ImageScaleTutorial" target="_blank" rel="external">ImageScaleTutorial</a></p>
<hr>
<p><strong>版权声明</strong></p>
<blockquote>
<p>文章版权归本人所有，如需转载需在明显位置处保留作者信息及原文链接 !</p>
</blockquote>
</div><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/share.js.下载" async=""></script><a data-url="http://ghui.me/post/2017/02/scaletype-matrix/" data-id="cj9rvm760003go49kp9gyuk2z" class="article-share-link">分享到</a><div class="tags"><a href="https://ghui.me/tags/Android/">Android</a></div><div class="post-nav"><a href="https://ghui.me/post/2017/09/v2er-free-version/" class="pre">V2er免费版发布啦</a><a href="https://ghui.me/post/2017/02/imageview-scale/" class="next">对于Android中ImageView的ScaleType你的理解可能是错的</a></div><script async="" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/adsbygoogle.js.下载"></script><ins style="display: block; height: 60px;" data-ad-client="ca-pub-1828197346034266" data-ad-slot="8001483030" data-ad-format="auto" class="adsbygoogle" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:60px;margin:0;padding:0;position:relative;visibility:visible;width:723px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:60px;margin:0;padding:0;position:relative;visibility:visible;width:723px;background-color:transparent;"><iframe width="723" height="60" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:723px;height:60px;" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/saved_resource.html"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script><div id="disqus_thread"><iframe id="dsq-app927" name="dsq-app927" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/saved_resource(2).html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 624px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="https://www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://ghui.me"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="https://ghui.me/categories/dev/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="https://ghui.me/categories/%E6%80%9D%E8%80%83/">思考</a></li><li class="category-list-item"><a class="category-list-link" href="https://ghui.me/categories/others/">其它</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="https://ghui.me/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="https://ghui.me/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="https://ghui.me/tags/Android/" style="font-size: 15px;">Android</a> <a href="https://ghui.me/tags/Java/" style="font-size: 15px;">Java</a> <a href="https://ghui.me/tags/Graphics/" style="font-size: 15px;">Graphics</a> <a href="https://ghui.me/tags/Git/" style="font-size: 15px;">Git</a> <a href="https://ghui.me/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="https://ghui.me/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="https://ghui.me/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="https://ghui.me/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="https://ghui.me/tags/Algorithms/" style="font-size: 15px;">Algorithms</a> <a href="https://ghui.me/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="https://ghui.me/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="https://ghui.me/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="https://ghui.me/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="https://ghui.me/tags/Read/" style="font-size: 15px;">Read</a> <a href="https://ghui.me/tags/Python/" style="font-size: 15px;">Python</a> <a href="https://ghui.me/tags/%E8%AF%91/" style="font-size: 15px;">译</a> <a href="https://ghui.me/tags/Alfred/" style="font-size: 15px;">Alfred</a> <a href="https://ghui.me/tags/Https/" style="font-size: 15px;">Https</a> <a href="https://ghui.me/tags/V2er/" style="font-size: 15px;">V2er</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2017/10/parse-html-gson-way/">Fruit - 让你像解析Json一样解析Html</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2017/09/android-shortcuts-compact/">Android Shortcuts的一些坑</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2017/09/v2er-free-version/">V2er免费版发布啦</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2017/02/scaletype-matrix/">Android Scaletype源码分析及自定义Matrix缩放规则</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2017/02/imageview-scale/">对于Android中ImageView的ScaleType你的理解可能是错的</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2017/01/ishanbay/">iShanbay(如果你也是一个在用Alfred的扇贝网用户)</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2016/11/thread-pool-in-android/">【译】Android中的线程池使用</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2016/11/http_to_https/">拥抱HTTPS</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2016/10/my-first-alfred-workflow/">一个方便计算透明度十六进制值的Alfred WorkFlow</a></li><li class="post-list-item"><a class="post-list-link" href="https://ghui.me/post/2016/10/vectordrawable_pathData_advanced/">理解Android VectorDrawable中的pathData命令【续】</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/recent_comments_widget.js.下载"></script> <style type="text/css" media="screen">	 .dsq-widget ul.dsq-widget-list {	 padding: 0;	 margin: 0;	 text-align: left;	 }	 img.dsq-widget-avatar {	 width: 32px;	 height: 32px;	 border: 0px;	 margin: 0px;	 padding: 0px 3px 3px 0px;	 float: left;	 }	 a.dsq-widget-user {	 font-weight: bold;	 }	 a.dsq-widget-thread {	 font-weight: bold;	 }	 p.dsq-widget-meta {	 clear: both;	 font-size: 80%;	 padding: 0;	 margin: 0;	 }	 li.dsq-widget-item {	 margin: 15px 0;	 list-style-type: none;	 clear: both;	 }	 span.dsq-widget-clout {	 padding: 0 2px;	 background-color: #ff7300;	 color: #fff;	 }	 table.dsq-widget-horiz td {	 padding-right: 15px;	 }	 .dsq-widget-comment p {	 display: inline;	 }	 </style>	 <ul class="dsq-widget-list">	 <li class="dsq-widget-item">	 <a class="dsq-widget-user" href="https://disqus.com/by/disqus_jknHHVUXes/">侯博维</a>	 <span class="dsq-widget-comment"><p>查词显示的速度有点慢,...</p></span>	 <p class="dsq-widget-meta"><a href="http://ghui.me/post/2017/01/ishanbay/">iShanbay(如果你也是一个在用Alfred的扇贝网用户)</a>&nbsp;·&nbsp;<a href="http://ghui.me/post/2017/01/ishanbay/#comment-3653640768">1 week ago</a></p>	 </li>	 <li class="dsq-widget-item">	 <a class="dsq-widget-user" href="https://disqus.com/by/disqus_aCubxVsN5b/">李博</a>	 <span class="dsq-widget-comment"><p>Android爬虫？</p></span>	 <p class="dsq-widget-meta"><a href="http://ghui.me/post/2017/10/parse-html-gson-way/">Fruit - 让你像解析Json一样解析Html</a>&nbsp;·&nbsp;<a href="http://ghui.me/post/2017/10/parse-html-gson-way/#comment-3580091962">1 month ago</a></p>	 </li>	 <li class="dsq-widget-item">	 <a class="dsq-widget-user" href="https://disqus.com/by/billismeCheung/">billisme</a>	 <span class="dsq-widget-comment"><p>很棒，赞</p></span>	 <p class="dsq-widget-meta"><a href="http://ghui.me/post/2015/10/view-measure/">View的MeasureSpec确定过程</a>&nbsp;·&nbsp;<a href="http://ghui.me/post/2015/10/view-measure/#comment-3493733583">3 months ago</a></p>	 </li>	 <li class="dsq-widget-item">	 <a class="dsq-widget-user" href="https://disqus.com/by/joeytat/">Joeytat</a>	 <span class="dsq-widget-comment"><p>Thank you!!!</p></span>	 <p class="dsq-widget-meta"><a href="http://ghui.me/post/2017/01/ishanbay/">iShanbay(如果你也是一个在用Alfred的扇贝网用户)</a>&nbsp;·&nbsp;<a href="http://ghui.me/post/2017/01/ishanbay/#comment-3309876199">7 months ago</a></p>	 </li>	 <li class="dsq-widget-item">	 <a class="dsq-widget-user" href="https://disqus.com/by/disqus_1tobcG38lE/">hamartia</a>	 <span class="dsq-widget-comment"><p>非常有用，留言支持，谢谢你</p></span>	 <p class="dsq-widget-meta"><a href="http://ghui.me/post/2017/01/ishanbay/">iShanbay(如果你也是一个在用Alfred的扇贝网用户)</a>&nbsp;·&nbsp;<a href="http://ghui.me/post/2017/01/ishanbay/#comment-3229751071">8 months ago</a></p>	 </li>	 </ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://kyleduo.com/" title="Kyle&#39;s blog" target="_blank">Kyle's blog</a><ul></ul><a href="https://blog.jamespan.me/" title="James Pan&#39;s Blog" target="_blank">James Pan's Blog</a><ul></ul><a href="http://blog.coderzh.com/" title="CoderZh Blog" target="_blank">CoderZh Blog</a><ul></ul><a href="https://zilongshanren.com/" title="子龙山人" target="_blank">子龙山人</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="http://weibo.com/ghuiii" rel="nofollow">ghui | </a><script src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/busuanzi.pure.mini.js.下载" async="async"></script><span id="busuanzi_container_site_uv" style="display: inline;">Visitor: </span><span id="busuanzi_value_site_uv">42602</span></div></div></div><a id="rocket" href="https://ghui.me/post/2017/02/scaletype-matrix/#top" class="show"></a><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/totop.js.下载" async=""></script><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/jquery.fancybox.pack.js.下载" async=""></script><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/fancybox.js.下载" async=""></script><link rel="stylesheet" type="text/css" href="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/jquery.fancybox.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-78905241-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?6f9354c1ee86c2f8863e7453cf8417af";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/codeblock-resizer.js.下载"></script><script type="text/javascript" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/smartresize.js.下载"></script></div><iframe style="display: none;" src="./Android Scaletype源码分析及自定义Matrix缩放规则 _ CoderGhui_files/saved_resource(3).html"></iframe></body></html>